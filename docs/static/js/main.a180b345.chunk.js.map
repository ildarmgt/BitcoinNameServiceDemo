{"version":3,"sources":["components/CreateNavigator/CreateNavigator.module.css","components/Navbar/Navbar.module.css","helpers/bns/calcBidDomainTx.tsx","components/CreateSteps/P5CustomForwards/P5CustomForwards.module.css","helpers/bns/constants.tsx","components/AboutContent/AboutContent.module.css","components/CreateSteps/P1RestoreOrBackup/P1RestoreOrBackup.module.css","components/CreateSteps/P4ActionChoice/P4ActionChoice.module.css","components/CreateSteps/P3DomainAndWallet/P3DomainAndWallet.module.css","components/SearchResults/SearchResults.module.css","helpers/bns/formathelpers.tsx","components/HomeContent/HomeContent.module.css","interfaces/index.tsx","components/general/RoundButton/RoundButton.tsx","store/reducers/Reducer.tsx","store/index.tsx","helpers/sanitize.js","store/actions/changeAliasAction.tsx","helpers/bns/actions/actions.tsx","helpers/bns/calcBnsState.tsx","helpers/bns/actions/batch.tsx","helpers/bns/stringByteCount.tsx","api/blockstream.tsx","store/actions/searchAction.tsx","helpers/bitcoin.tsx","store/actions/createNewWalletAction.tsx","store/actions/changePageInfoAction.tsx","store/actions/scanAddressFullyAction.tsx","components/SearchResults/SearchResults.tsx","helpers/timediff.tsx","helpers/bns/findLatestForwards.tsx","helpers/bns/interpretFw.tsx","components/HomeContent/HomeContent.tsx","pages/Home.tsx","components/AboutContent/AboutContent.tsx","pages/About.tsx","components/CreateSteps/P1RestoreOrBackup/P1RestoreOrBackup.tsx","components/CreateSteps/CreateHeader/CreateHeader.tsx","components/CreateSteps/P2LoadWallet/P2LoadWallet.tsx","components/CreateSteps/P3DomainAndWallet/P3DomainAndWallet.tsx","components/CreateSteps/P4ActionChoice/P4ActionChoice.tsx","components/CreateSteps/P5CustomForwards/P5CustomForwards.tsx","components/CreateSteps/P6Broadcast/P6Broadcast.tsx","components/CreateNavigator/CreateNavigator.tsx","pages/Create.tsx","components/Navbar/Navbar.tsx","App.tsx","components/DevPanel/DevPanel.tsx","index.tsx","helpers/bns/cryptography.tsx","components/DevPanel/DevPanel.module.css","components/CreateSteps/CreateHeader/CreateHeader.module.css","helpers/bns/calcP2WSH.tsx","components/CreateSteps/P2LoadWallet/P2LoadWallet.module.css","helpers/bns/initialState.tsx","components/general/RoundButton/RoundButton.module.css"],"names":["module","exports","calcBidDomainTx","stringToEmbed","wallet","domain","feeRate","networkChoice","vBytes","user","getUser","address","network","bitcoin","calcP2WSH","domainName","notificationsAddress","fee","Math","ceil","valueNeeded","MIN_BURN","MIN_NOTIFY","usedUtxoOfPayer","totalGathered","utxoList","forEach","utxo","push","value","Error","change","keyPair","fromWIF","WIF","psbt","setVersion","setLocktime","addInput","hash","txid","index","vout","sequence","nonWitnessUtxo","Buffer","from","hex","nonce","toString","encryptionKey","data","encrypt","embed","addOutput","script","output","signInput","validateSignaturesOfInput","finalizeAllInputs","tx","extractTransaction","thisVirtualSize","virtualSize","getId","toHex","console","log","byteLength","warn","BYTES_MAX","OWNERSHIP_DURATION_BY_BLOCKS","existsCurrentOwner","st","currentOwner","getOwnerAddress","setOwner","newOwnerAddress","users","getOwner","ownerAddress","updateOwnerHistory","ownersHistory","JSON","parse","stringify","newUser","clearOwner","getCurrentHeight","chain","currentHeight","getParsedHeight","parsedHeight","setParsedHeight","height","getLastOwnerBurnedValue","burnAmount","isOwnerExpired","owner","winHeight","getTxTimestamp","status","block_time","getTxHeight","block_height","getTxOutput0BurnValue","getTxInput0SourceUserAddress","vin","prevout","scriptpubkey_address","updateSourceUserFromTx","fromAddress","updateHeight","readEmbeddedData","isOpreturnOutput0","embeddedDataHex","scriptpubkey_asm","split","slice","join","getTxOutput0Data","embeddedDataBuffer","decryptionKey","embeddedDataUtf8","decrypt","embeddedDataUtf8Array","forwardsInThisTx","word","thisForward","updateTimestamp","forwards","addToUserForwards","atLeastTwoOutputs","length","isNotify","getTxOutput1NotifyAddress","notificationAddress","getNotificationAddress","didNotifyMin","getTxOutput1NotifyValue","isAddressTheCurrentOwner","didBurnMin","burnedPreviousRateMin","ActionTypes","RoundButton","props","style","display","show","colorbutton","colorbuttontext","sizebutton","className","styles","roundButtonWrap","roundButton","back","backArrow","undefined","next","nextArrow","children","STORE_SEARCH_RESULTS_FAIL","STORE_SEARCH_RESULTS","TYPING","NEW_WALLET","CHANGE_PAGE_INFO","UPDATE_WALLET","UPDATE_DOMAIN","ACTION_FAIL","LOAD_STATE","reducer","state","action","payload","type","txHistory","checkedHistory","checkedUtxo","lastTimeStamp","Date","now","pageInfo","initialState","mnemonic","alias","extension","bidding","current","settings","Store","React","createContext","sanitize","inputString","stringOrArray","choices","Array","isArray","filter","logicFilters","choice","str","letter","reduce","resultingString","warning","outputString","indexOf","fn","OUTS_2","info","OUT_0","OUT_1","NOTIFIED_MIN","BURNED_MIN","special","output0value","NO_OWNER","EXISTS_OWNER","BURN_LAST_WIN","USER_IS_OWNER","IS_OWNER_EXPIRED","claimOwnershipAction","args","permissions","conditions","execute","senderAddress","winTimestamp","currentOwnerRenewAction","updateForwardingInfoAction","autoCheckForOwnerExpired","calcBnsState","notificationsHistory","newState","reverse","sort","prev","areAllConditionsMet","eaCondition","actions","okConditions","okPermissions","areAllPermissionsMet","eaPermission","stringByteCount","API_PATH_TESTNET","API_PATH_BITCOIN","getHeight","strNetwork","a","async","API_PATH","axios","get","res","rateLimit","addRawTxToArray","arrayUtxo","erroredOutputs","error","arrayUtxoWithHex","Object","entries","indexString","parseInt","tries","getUTXOList","getAddressHistory","Promise","r","setTimeout","searchAction","dispatch","router","notificationsTxHistory","createNewWallet","bip39","generateMnemonic","seedBuffer","mnemonicToSeed","fromSeed","derivePath","toWIF","p2wpkh","pubkey","publicKey","loadWallet","strMnemonic","createNewWalletAction","changePageInfoAction","page","scanAddressFullyAction","addressType","walletAddress","walletTxHistory","utxoListWalletAddress","utxoListNotificationAddress","SearchResults","useContext","diff","isExpired","dh","blocksUntilExpires","timestampMsec","referenceTimestampMsec","abs","d","floor","h","m","dhm","msDiff","timeDiff","latestForwards","sortedForwards","currentNetworks","eaForward","values","findLatestForwards","wrapper","describe","notisExpired","listContainer","to","createLink","map","fw","ifw","render","where","what","link","interpretFw","key","listItem","href","encodeURI","target","rel","HomeContent","match","params","history","isSearchDone","inputEl","useRef","useEffect","selectionEnd","selectionStart","focus","lblMainTitle","lblMainTitleAfter","noselect","divSearch","divSearchAfter","id","txtSearch","cols","rows","spellCheck","placeholder","ref","onChange","e","sanitizedString","changeAliasAction","onKeyPress","onClick","Home","AboutContent","About","pages","CreateHeader","useState","window","innerWidth","width","setWidth","resize","addEventListener","removeEventListener","fontScale","min","barHeight","aliasMarginTop","marginTop","aliasFontSize","fontSize","cutOverflow","bar","ext","spacer","P1RestoreOrBackup","ROOT","setPage","backup","setBackup","wordCount","v","title","Orange","buttonWrapper","LOAD_BACKUP","contentWrapper","thisDiv","document","getElementById","getSelection","selectAllChildren","restoreBackup","cleanString","toLowerCase","trimLeft","trim","P2LoadWallet","qrCode","setQrCode","qr","toDataURL","err","url","imgQr","src","alt","open","pathEdit","P3DomainAndWallet","apiStatus","setApiStatus","utxoArray","readyStatus","isReady","isWalletAddress","isDomainAvailable","isWalletTheOwner","domainInfo","domainButton","walletInfo","walletButton","unspent","balance","sum","toFixed","ownership","P4ActionChoice","checkActions","allActions","checkedActions","checkedPermissions","permission","isAllowed","specialTxDirections","rule","condition","isUsable","every","permissionList","runAllActionPermissionChecks","availableActions","unavailableActions","unavailableActions__title","unavailableActions__actionList","unavailableActions__actionList__action","unavailableActions__actionList__action__title","unavailableActions__actionList__action__permissionList","unavailableActions__actionList__action__permissionList__permission","P5CustomForwards","customAdd","setCustomAdd","plannedChanges","setPlannedChanges","setTx","combineForwards","objForwards","forwardsString","keys","fwNetwork","bytesOfChanges","changes","bytesLeft","bytesOver","updateItem","updateInfo","updateCancel","newData","stopPropagation","editor","btnDelete","editorNetwork","cleanText","editorAddress","btnAdd","pastList","i","pastPair","pastNetwork","pastAddress","P6Broadcast","feeSelection","Rate","usdAPI","feeAPI","txSummary","CreateNavigator","horizontalScaler","Create","Navbar","root","App","searchParam","URLSearchParams","location","search","pushState","pathname","path","component","exact","json","require","ReactDOM","useReducer","Provider","hidden","setHidden","onDevKey","activeElement","divDev","button","encodeURIComponent","createElement","download","innerHTML","container","appendChild","click","remove","dlState","btnOutline","sheet","parentNode","removeChild","createTextNode","head","stringText","stringForKey","stringForIV","crypto","createHash","update","digest","iv","cipher","createCipheriv","encrypted","concat","final","bufferCypher","decipher","createDecipheriv","decrypted","op","hash160","bufferData","witnessScript","compile","OP_DROP","p2wsh","redeem"],"mappings":"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","file":"static/js/main.a180b345.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"CreateNavigator_wrapper__24rTe\",\"horizontalScaler\":\"CreateNavigator_horizontalScaler__2qmoi\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Navbar_root__2XES1\",\"warning\":\"Navbar_warning__1HOBZ\"};","import * as bitcoin from 'bitcoinjs-lib'\nimport { calcP2WSH } from './calcP2WSH'\nimport { MIN_BURN, MIN_NOTIFY } from './constants'\nimport { encrypt } from './cryptography'\nimport { IDomain } from './types/'\nimport { getUser } from './formathelpers'\n\n/**\n * Creates hex of tx to bid on domain.\n * Throws error if not enough funds.\n * Leave vBytes blank, it will call itself via recursion until it derives needed size.\n * @param   {string}      stringToEmbed           - string of forwarding information to embed in tx.\n * @param   {object}      wallet                  - { WIF, address, txHistory, utxoList, ... }.\n * @param   {object}      domain                  - all domain info\n * @param   {number}      feeRate                 - fee rate in satoshi/vBytes.\n * @param   {string}      networkChoice           - 'testnet' or 'bitcoin' (matches bitcoinjs-lib).\n * @param   {number=}     [vBytes=0]              - size of transaction in vBytes. *\n * @returns {object}                              - { thisVirtualSize, txid, hex, valueNeeded, fee, change }.\n */\nexport const calcBidDomainTx = (\n  stringToEmbed: string,\n  wallet: any,\n  domain: IDomain,\n  feeRate: number,\n  networkChoice: string,\n  vBytes: number = 0\n): any => {\n\n  const user = getUser({ domain }, wallet.address)\n\n  const network = bitcoin.networks[networkChoice]\n  const { notificationsAddress } = calcP2WSH(domain.domainName, networkChoice)\n\n  // calculate funds necessary for this tx, more than needed better than less.\n  const fee = Math.ceil(vBytes * feeRate)\n  const valueNeeded = MIN_BURN + MIN_NOTIFY + fee; // sat\n  // gather necessary utxo to use until enough to cover costs\n  let usedUtxoOfPayer: Array<any> = []\n  let totalGathered = 0 // sat\n  wallet.utxoList?.forEach((utxo: any) => {\n    // while not enough funds\n    if (totalGathered < valueNeeded) {\n      usedUtxoOfPayer.push(utxo)\n      totalGathered += utxo.value\n    }\n  })\n  // if still not enough funds\n  if (totalGathered < valueNeeded) {\n    throw new Error('Not enough funds in all the utxo')\n  }\n  const change = totalGathered - valueNeeded\n\n  // calculate keys from wallet import format key\n  const keyPair = bitcoin.ECPair.fromWIF(wallet.WIF, network)\n  // create Partially Signed Bitcoin Transaction object to build tx\n  const psbt = new bitcoin.Psbt({ network })\n  psbt.setVersion(2)    // default\n  psbt.setLocktime(0)   // default\n\n  // add all inputs (owner address must always be at index 0)\n  usedUtxoOfPayer.forEach(utxo => {\n    psbt.addInput({\n      hash: utxo.txid,\n      index: utxo.vout,\n      sequence: 0xfffffffe,\n      nonWitnessUtxo: Buffer.from(utxo.hex, 'hex') // should work for segwit and nonsegwit inputs\n    })\n  })\n\n  // add inputs of all ACS UTXO from this owner or it doesn't count (TODO)\n\n\n  // add the op_return output (always index 0)\n  // if first time sending, nonce is '0', otherwise the last blockheight when notification was sent from this owner address\n  // TODO calculate nonce in case this owner has unspent acs utxo left at notification address\n  // const nonce = getLastMessageHeight(wallet.address, notificationsAddress, notificationTxHistory)\n  const nonce = user.nonce.toString()\n  const encryptionKey =  domain.domainName + wallet.address + nonce\n  const data = encrypt(stringToEmbed, encryptionKey)\n  const embed = bitcoin.payments.embed({ data: [data] })\n  psbt.addOutput({\n    script: embed.output,\n    value: MIN_BURN,\n  })\n\n  // add notification output (always index 1)\n  psbt.addOutput({\n    address: notificationsAddress, // calculated from domainName provided\n    value: MIN_NOTIFY\n  })\n\n  // add change output (anything is fine for index 2 or higher outputs)\n  psbt.addOutput({\n    address: wallet.address,\n    value: change\n  })\n\n  // at this point all inputs & outputs added so ready to sign\n\n  usedUtxoOfPayer.forEach((utxo, index) => {\n    // sign p2wpkh of controlling\n    psbt.signInput(index, keyPair)\n    // (TODO) signing ACS inputs will need script\n\n    if (!psbt.validateSignaturesOfInput(index)) {\n      throw new Error('Signature validation failed for input index ' + index.toString())\n    }\n  })\n\n  psbt.finalizeAllInputs()\n\n  const tx = psbt.extractTransaction()\n  const thisVirtualSize = tx.virtualSize()\n  const txid = tx.getId()\n  const hex = tx.toHex()\n\n  if (vBytes >= thisVirtualSize) {\n    // If this tx fee was calculated for a vBytes size equal to or larger than the resulting derived tx (thisVirtualSize),\n    // fee should be safe by being equal to or larger than necessary at required feeRate.\n    // Obviously vBytes = 0 will never give the correct fee minimum the first time through.\n    console.log('virtualSize', tx.virtualSize())\n    console.log('byteLength', tx.byteLength())\n    console.log('getId', tx.getId())\n    console.log('hex', tx.toHex())\n    console.log('')\n    return { thisVirtualSize, txid, hex, valueNeeded, fee, change }\n  } else {\n    // Redo this tx calculation using the virtual size we just calculated for vByte optional parameter.\n    return calcBidDomainTx(stringToEmbed, wallet, domain, feeRate, networkChoice, thisVirtualSize)\n  }\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P5CustomForwards_wrapper__2kAy2\",\"title\":\"P5CustomForwards_title__29aFH\",\"changes\":\"P5CustomForwards_changes__23bYg\",\"pastList\":\"P5CustomForwards_pastList__3rXdy\",\"buttonWrapper\":\"P5CustomForwards_buttonWrapper__3hvwB\",\"editor\":\"P5CustomForwards_editor__1ZVVF\",\"updateItem\":\"P5CustomForwards_updateItem__1wAhx\",\"updateCancel\":\"P5CustomForwards_updateCancel__3b5bW\",\"updateInfo\":\"P5CustomForwards_updateInfo__2OBcF\",\"editorNetwork\":\"P5CustomForwards_editorNetwork__1L6UB\",\"editorAddress\":\"P5CustomForwards_editorAddress__1N25M\",\"btnAdd\":\"P5CustomForwards_btnAdd__1tiSg\",\"btnDelete\":\"P5CustomForwards_btnDelete__3NCte\",\"pastPair\":\"P5CustomForwards_pastPair__3YvIk\",\"pastNetwork\":\"P5CustomForwards_pastNetwork__35eVe\",\"pastAddress\":\"P5CustomForwards_pastAddress__3-W_H\",\"bytesLeft\":\"P5CustomForwards_bytesLeft__2zySr\",\"bytesOver\":\"P5CustomForwards_bytesOver__ysfMq\"};","/**\n * Constants used to determine rules on BNS\n */\n\n// testing mode true/false to reduce waiting time for tests\nconst TESTING = true\nTESTING && console.warn('Testing mode ON')\n\n// max data safe to embed in OP_RETURN type tx (bytes)\nconst BYTES_MAX = 80\n\n// Satoshis to burn minimum for attempting ownership (satoshi)\nconst MIN_BURN = 1000\n\n//  Minimum to use for notification output (satoshi)\nconst MIN_NOTIFY  = 1000\n\n// Ownership duration after victory (blocks)\nconst OWNERSHIP_DURATION_BY_BLOCKS = !TESTING ? 52560 : 1000\n// ^ (real) 52560 blocks ~365 days.\n// (testing) 288 blocks ~48 hours. 1000 blocks ~ a week\n// Block times can vary from 10 minutes.\n// const CHALLENGE_PERIOD_DURATION_BY_BLOCKS = 3456\n// ^ ~24 hours. Only matters if someone is monitoring specific domainName, otherwise they won't know what domainName the bids are for.\n\nexport {\n  TESTING,\n  MIN_BURN,\n  MIN_NOTIFY,\n  OWNERSHIP_DURATION_BY_BLOCKS,\n  BYTES_MAX\n}","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"AboutContent_wrapper__1kfnm\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P1RestoreOrBackup_wrapper__32TQJ\",\"title\":\"P1RestoreOrBackup_title__2rH-6\",\"contentWrapper\":\"P1RestoreOrBackup_contentWrapper__1NT85\",\"buttonWrapper\":\"P1RestoreOrBackup_buttonWrapper__2ryAq\",\"describe\":\"P1RestoreOrBackup_describe__1RMqs\",\"Orange\":\"P1RestoreOrBackup_Orange__2IaJN\",\"spacer\":\"P1RestoreOrBackup_spacer__3luud\",\"backup\":\"P1RestoreOrBackup_backup__357rd\",\"restoreBackup\":\"P1RestoreOrBackup_restoreBackup__VUHgs\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P4ActionChoice_wrapper__2u2J5\",\"title\":\"P4ActionChoice_title__2PdRs\",\"availableActions\":\"P4ActionChoice_availableActions__1O5aS\",\"unavailableActions\":\"P4ActionChoice_unavailableActions__3rEYI\",\"buttonWrapper\":\"P4ActionChoice_buttonWrapper__3Sx3Y\",\"unavailableActions__title\":\"P4ActionChoice_unavailableActions__title__2EQ4_\",\"unavailableActions__actionList\":\"P4ActionChoice_unavailableActions__actionList__1VAc_\",\"unavailableActions__actionList__action\":\"P4ActionChoice_unavailableActions__actionList__action__GMwoW\",\"unavailableActions__actionList__action__title\":\"P4ActionChoice_unavailableActions__actionList__action__title__3ljZU\",\"unavailableActions__actionList__action__permissionList\":\"P4ActionChoice_unavailableActions__actionList__action__permissionList__2pKeq\",\"unavailableActions__actionList__action__permissionList__permission\":\"P4ActionChoice_unavailableActions__actionList__action__permissionList__permission__2eF7F\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P3DomainAndWallet_wrapper__1ElFg\",\"contentWrapper\":\"P3DomainAndWallet_contentWrapper__vm5qp\",\"title\":\"P3DomainAndWallet_title__3ing2\",\"domainInfo\":\"P3DomainAndWallet_domainInfo__3p2aJ\",\"domainButton\":\"P3DomainAndWallet_domainButton__2PIDz\",\"walletInfo\":\"P3DomainAndWallet_walletInfo__2cQY0\",\"walletButton\":\"P3DomainAndWallet_walletButton__MmLZ3\",\"unspent\":\"P3DomainAndWallet_unspent__bUWZW\",\"buttonWrapper\":\"P3DomainAndWallet_buttonWrapper__djJkL\",\"ownership\":\"P3DomainAndWallet_ownership__lSY6a\",\"balance\":\"P3DomainAndWallet_balance__2fns7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"SearchResults_wrapper__VvaYk\",\"listContainer\":\"SearchResults_listContainer__12vQE\",\"listItem\":\"SearchResults_listItem__3Udwx\",\"key\":\"SearchResults_key__358jo\",\"describe\":\"SearchResults_describe__3HACm\",\"expired\":\"SearchResults_expired__2ptnD\",\"notExpired\":\"SearchResults_notExpired__2m4VI\",\"createLink\":\"SearchResults_createLink__13Wez\"};","import { newUser } from './initialState'\nimport { OWNERSHIP_DURATION_BY_BLOCKS, MIN_BURN, MIN_NOTIFY } from './constants'\nimport { IUser, Iforward, IBnsState } from './types/'\nimport { decrypt } from './cryptography'\n\n// ========== helper functions =====================\n\nexport const existsCurrentOwner = (st: IBnsState): boolean => st.domain.currentOwner !== ''\n\nexport const getOwnerAddress = (st: IBnsState): string => st.domain.currentOwner || ''\n\nexport const setOwner = (st: IBnsState, newOwnerAddress: string) => {\n  st.domain.currentOwner = newOwnerAddress\n}\n\nexport const getUser = (st: IBnsState, address: string): IUser => st.domain.users[address]\n\nexport const getOwner = (st: IBnsState) => {\n  const ownerAddress = getOwnerAddress(st)\n  if (!ownerAddress) return undefined\n  return getUser(st, ownerAddress)\n}\n\nexport const updateOwnerHistory = (st: IBnsState): void => {\n  st.domain.ownersHistory.push(getOwner(st) || JSON.parse(JSON.stringify(newUser)))\n}\n\nexport const clearOwner = (st: IBnsState): void => { st.domain.currentOwner = '' }\n\nexport const getCurrentHeight = (st: IBnsState): number => st.chain?.currentHeight || 0\nexport const getParsedHeight = (st: IBnsState): number => st.chain?.parsedHeight || 0\nexport const setParsedHeight = (st: IBnsState, height: number): void => {\n  st.chain && (st.chain.parsedHeight = height)\n}\n\nexport const getNotificationAddress = (st: IBnsState): string => st.domain.notificationAddress || ''\n\nexport const getLastOwnerBurnedValue = (st: IBnsState): number => getOwner(st)?.burnAmount || 0\n\nexport const isOwnerExpired = (st: IBnsState): boolean => {\n  if (existsCurrentOwner(st)) return true\n  const owner = getOwner(st)\n  if (!owner) return true\n  const blocksSinceUpdate = getParsedHeight(st) - owner.winHeight\n  return blocksSinceUpdate > OWNERSHIP_DURATION_BY_BLOCKS\n}\n\n// ===== tx functions (getters) =====================\n\nexport const getTxTimestamp = (tx: any): number => tx.status.block_time || 0\nexport const getTxHeight = (tx: any): number => tx.status.block_height || 0\n\nexport const getTxOutput0BurnValue = (tx: any): number => tx.vout[0]?.value || 0\nexport const getTxOutput0Data = (tx: any):string => {\n  if (isOpreturnOutput0(tx)) {\n    // remove 'OP_RETURN OP_PUSHBYTES_5 ' from it and return the rest\n    return tx.vout[0].scriptpubkey_asm.split(' ').slice(2).join('')\n  }\n  return ''\n}\n\nexport const getTxOutput1NotifyValue = (tx: any): number => tx.vout[1]?.value || 0\nexport const getTxOutput1NotifyAddress = (tx: any): string => tx.vout[1]?.scriptpubkey_address || ''\n\nexport const getTxInput0SourceUserAddress = (tx: any): string => (\n  tx.vin[0]?.prevout.scriptpubkey_address || ''\n)\n\n\n// ======= update state from tx (setters) ========\n\n// update the info for the source user of the tx within bns state\nexport const updateSourceUserFromTx = (st: IBnsState, tx: any): void => {\n  const fromAddress = getTxInput0SourceUserAddress(tx)\n\n  // create new user if not already one of users\n  if (!(fromAddress in st.domain.users)) {\n    // create new user object by copying values of newUser object\n    st.domain.users[fromAddress] = JSON.parse(JSON.stringify(newUser))\n    console.log('new source created:')\n  }\n\n  // update user\n  const user = st.domain.users[fromAddress]\n  user.address = fromAddress\n  user.nonce = user.updateHeight\n  user.updateHeight = getTxHeight(tx)\n  console.log('source:', user)\n}\n\nexport const addToUserForwards = (\n  st: IBnsState,\n  fromAddress: string,\n  forwardsInThisTx: Array<Iforward>\n) => {\n  const user = getUser(st, fromAddress)\n  user.forwards = [...user.forwards, ...forwardsInThisTx]\n}\n\nexport const readEmbeddedData = (st: IBnsState, tx: any):void => {\n  // only go on if there is op_return with embedded data on output 0\n  if (!isOpreturnOutput0(tx)) {\n    console.log(getTxHeight(tx), ': no op_return found for txid')\n    return undefined\n  }\n\n  // get useful object references\n  const fromAddress = getTxInput0SourceUserAddress(tx)\n  const user = getUser(st, fromAddress)\n  const nonce = user.nonce.toString()\n\n  const embeddedDataHex = getTxOutput0Data(tx)\n  const embeddedDataBuffer = Buffer.from(embeddedDataHex, 'hex')\n\n  const decryptionKey = st.domain.domainName + user.address + nonce\n  const embeddedDataUtf8 = decrypt(embeddedDataBuffer, decryptionKey)\n  console.log(getTxHeight(tx), ': found embedded data:', embeddedDataUtf8)\n\n  // split by spaces into array\n  const embeddedDataUtf8Array = embeddedDataUtf8.split(' ')\n\n  // collect all forwards in this tx\n  const forwardsInThisTx: Array<Iforward> = []\n\n  embeddedDataUtf8Array.forEach((word: string, index: number) => {\n    // everything must be space separated in pairs\n    // so single block might mean failed decryption or\n    // last unpaired block might be padding or future versioning\n    // grabbing only odd and 1 before it values, only grabbing pairs\n    if (index % 2 === 1) {\n      const networkPiece = embeddedDataUtf8Array[index - 1]\n      const forwardingAddressPiece = word\n      const thisForward = {\n        network:          networkPiece,\n        address:          forwardingAddressPiece,\n        updateHeight:     getTxHeight(tx),\n        updateTimestamp:  getTxTimestamp(tx)\n      }\n      forwardsInThisTx.push(thisForward)\n    }\n  })\n\n  // update forwards on the user\n  addToUserForwards(st, fromAddress, forwardsInThisTx)\n}\n\n// ===== rule checks (getters) =====\n\n// Describe:    2 outputs minimum\n// Required:    ALL\nexport const atLeastTwoOutputs = (tx: any): boolean => tx.vout.length >= 2\n\n// Describe:    Is [0] output OP_RETURN type\n// Required:    ALL\nexport const isOpreturnOutput0 = (tx: any): boolean => (\n  tx.vout[0].scriptpubkey_asm.split(' ')[0] === 'OP_RETURN'\n)\n\n// Describe:    Is [1] output this domain's notification address?\n// Required:    ALL\nexport const isNotify =  (st: IBnsState, tx: any): boolean => (\n  getTxOutput1NotifyAddress(tx) === getNotificationAddress(st)\n)\n\n// Describe:    At least minimum amount used in notification output? (Dust level is main danger)\n// Required:    ALL\nexport const didNotifyMin = (tx: any): boolean => getTxOutput1NotifyValue(tx) >= MIN_NOTIFY\n\n// Describe:    Is sender the current domain owner (input [0], id'ed by address)?\n// Required:    renew lease\n// Irrelevant:  available domain claim, forwarding information updates (warn)\nexport const isAddressTheCurrentOwner = (st: IBnsState, address: string): boolean =>  getOwnerAddress(st) === address\n\n// Describe:    At least minimum amount burned?\n// Required:    available domain claim, renew lease\n// Irrelevant:  forwarding information updates\nexport const didBurnMin = (tx: any): boolean => getTxOutput0BurnValue(tx) >= MIN_BURN\n\n// Describe:    Burned at least as much as previously burnt\nexport const burnedPreviousRateMin = (st: IBnsState, tx: any): boolean => (\n  getTxOutput0BurnValue(tx) >= getLastOwnerBurnedValue(st)\n)\n\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"lblMainTitle\":\"HomeContent_lblMainTitle__1LqCG\",\"lblMainTitleAfter\":\"HomeContent_lblMainTitleAfter__J9CsB\",\"divSearch\":\"HomeContent_divSearch__3dKw5\",\"divSearchAfter\":\"HomeContent_divSearchAfter__2MAMf\",\"txtSearch\":\"HomeContent_txtSearch__3HpSp\"};","/**\n * All the interfaces & enums\n */\n\nexport enum ActionTypes {\n  STORE_SEARCH_RESULTS = 'STORE_SEARCH_RESULTS',\n  STORE_SEARCH_RESULTS_FAIL = 'STORE_SEARCH_RESULTS_FAIL',\n  TYPING = 'TYPING',\n  NEW_WALLET = 'NEW_WALLET',\n  CHANGE_PAGE_INFO = 'CHANGE_PAGE_INFO',\n  UPDATE_WALLET = 'UPDATE_WALLET',\n  UPDATE_DOMAIN = 'UPDATE_DOMAIN',\n  ACTION_FAIL = 'ACTION_FAIL',\n  LOAD_STATE = 'LOAD_STATE'\n}\n\nexport type Dispatch = React.Dispatch<IAction>\n\nexport interface IAction {\n  type: ActionTypes\n  payload: any\n}\n\nexport interface Iforward {\n  network: string\n  address: string\n  updateHeight: number\n  updateTimestamp: number\n}\n\nexport interface IUser {\n  address:      string\n  forwards:     Array<Iforward>\n  burnAmount:   number\n  winHeight:    number\n  winTimestamp: number\n  nonce:        number\n  updateHeight: number\n}\n\nexport interface IState {\n  network: string\n  alias: string\n  extension: string\n  domain: {\n    domainName: string\n    notificationAddress: string\n    txHistory: Array<any>\n    utxoList: Array<any>\n    users: {\n      [key: string]: IUser\n    }\n    currentOwner: string\n    bidding: {}\n    checkedHistory: boolean\n    checkedUtxo: boolean\n  }\n  wallet: {\n    address: string\n    mnemonic: string\n    WIF: string\n    txHistory: Array<any>\n    utxoList: Array<any>\n    checkedHistory: boolean\n    checkedUtxo: boolean\n  }\n  chain: {\n    height: number\n  }\n  pageInfo: {\n    current: number\n  }\n  settings: {\n    feeRate: number\n  }\n  lastTimeStamp: number\n}","import React from 'react'\nimport styles from './RoundButton.module.css'\n\n/**\n * Standard button for this app.\n *\n * Pass the following props to customize it.\n *\n * next='true' to add next arrow at right.\n *\n * back='true' to add back arrow on left.\n *\n * show='true' to display element vs show='false' to set display to none (dom still exists).\n *\n * sizebutton='2.9' to make the button size 2.9x standard var(--s) size used (defined in global global.css).\n *\n * colorbutton='var(--colorBitcoinOrange)' to customize color.\n *\n * colorbuttonText='var(--colorButtonText)' to customize text color.\n *\n * Defaults (vars defined in global global.css):\n *\n * sizebutton = 2.5. ( means font size calc(2.5/2.9 * var(--s)) )\n *\n * colorbutton = var(--colorBitcoinOrange).\n *\n * colorbuttontext = var(--colorButtonText).\n */\nexport const RoundButton = (props:any): JSX.Element => {\n  return (\n    <div\n      // variables defined by string will be available to button & its children for scope\n      style={{\n        display: (\n          (props?.show === 'false') ? 'none' : 'inline-block'\n        ) as React.CSSProperties,\n        '--colorThisButton': (\n          props.colorbutton ? props.colorbutton : `var(--colorBitcoinOrange)`\n        )  as React.CSSProperties,\n        '--colorThisButtonText': (\n          props.colorbuttontext ? props.colorbuttontext : `var(--colorButtonText)`\n        ) as React.CSSProperties,\n        '--sizeButton': (\n          props.sizebutton\n          // Button was designed at 2.9 * var(--s) scale font so\n          // this just lets user redefine font & everything else proportionally\n            ? `calc(${props.sizebutton}/2.9 * var(--s))`\n            : `calc(2.5/2.9 * var(--s))`\n        ) as React.CSSProperties\n      }}\n      className={ styles.roundButtonWrap }\n      {...props}\n    >\n      <div\n        className={ [\n          styles.roundButton,\n          props.back ? styles.backArrow : undefined,\n          props.next ? styles.nextArrow : undefined,\n        ].join(' ') }\n      >\n        { props.children }\n      </div>\n    </div>\n  )\n}\n","import { IState, IAction, ActionTypes } from '../../interfaces'\nimport { initialState } from './../'\nconst {\n  STORE_SEARCH_RESULTS_FAIL,\n  STORE_SEARCH_RESULTS,\n  TYPING,\n  NEW_WALLET,\n  CHANGE_PAGE_INFO,\n  UPDATE_WALLET,\n  UPDATE_DOMAIN,\n  ACTION_FAIL,\n  LOAD_STATE\n} = ActionTypes\n\n/**\n * Reducer edits global state via information in payload.\n * Action is object { payload, type }.\n * type describes what type of changes to global state to make.\n * payload contains data provided to make those changes.\n */\nexport default function reducer (state: IState, action: IAction): IState {\n  const { payload } = action\n\n  switch (action.type) {\n\n    case UPDATE_WALLET: {\n      // after full scan of the wallet address\n      return {\n        ...state,\n        wallet: {\n          ...state.wallet, // wif/mnemonic/address unchanged\n          txHistory: payload.wallet.txHistory,\n          utxoList: payload.wallet.utxoList,\n          checkedHistory: true,\n          checkedUtxo: true\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case UPDATE_DOMAIN: {\n      return {\n        ...state,\n        domain: {\n          ...payload.domain,\n          checkedHistory: true,\n          checkedUtxo: true\n        },\n        chain: {\n          height: payload.chain.height\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case CHANGE_PAGE_INFO:\n      // navigation info for controlling domains\n      return {\n        ...state,\n        pageInfo: payload\n      }\n\n    case NEW_WALLET: {\n      // store totally new wallet object\n      return {\n        ...state,\n        wallet: {\n          ...initialState.wallet,\n          address: payload.address,\n          mnemonic: payload.mnemonic,\n          WIF: payload.WIF\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case STORE_SEARCH_RESULTS: {\n      // store results of looking up totally new alias\n      // update notifications and ownership information\n\n      return {\n        ...state,\n        alias: payload.alias,\n        domain: {\n          ...initialState.domain,\n          ...payload.domain,\n          checkedHistory: true\n        },\n        chain: {\n          height: payload.chain.height\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case STORE_SEARCH_RESULTS_FAIL: {\n      // store results of looking up totally new alias\n      // reset notifications and ownership information\n      return {\n        ...state,\n        alias: payload.alias,\n        domain: {\n          ...initialState.domain,\n          domainName: payload.domainName,\n          notificationAddress: payload.notificationAddress\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case TYPING: {\n      // change of alias part of domain name\n      // this change renders owner and notification information outdated\n      return {\n        ...state,\n        alias: payload,\n        domain: initialState.domain,\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case ACTION_FAIL: {\n      return {\n        ...state,\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case LOAD_STATE: {\n      return {\n        ...payload,\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    default: {\n      console.warn('Unknown action type')\n      return state\n    }\n  }\n}\n\n// can split maybe like this later if gets too long\n// https://dev.to/vanderleisilva/global-state-management-with-react-hooks-and-context-5f6h\n\n","import React from 'react'\nimport { IState } from '../interfaces'\nimport reducer from './reducers/Reducer'\n\n// Change state process:\n// 1. Component calls action from src/store/actions/\n// 2. Action does stuff (e.g. API calls) and dispatches results to reducer in src/store/reducer/\n// 3. Reducer modifies state based on dispatched payload and type of action.\n\n// initial state\n// (changes to design need to be matched in reducers & interfaces)\nexport const initialState: IState = {\n  network: 'testnet',             // 'testnet' or 'bitcoin'\n  alias: 'satoshi',               // first half of domain name\n  extension: '.btc',              // last half of domain name\n  domain: {                       // domain info from notifications\n    domainName: '',\n    notificationAddress: '',      // p2wsh address for this domain name (alias + extension)\n    txHistory: [],                // array of all tx for this address (old addressHistory)\n    utxoList: [],                 // array of all current utxo for this address\n    users: {},                    // object with all interacting users\n    currentOwner: '',             // address of user that controls domain\n    bidding: {},                  // bidding info\n    checkedHistory: false,        // if notifications tx history has ever been updated\n    checkedUtxo: false            // if notifications utxo including raw tx has ever been updated\n  },\n  wallet: {                       // wallet information & utxo for controlling domain names\n    address: '',                  // public address (p2wpkh)\n    mnemonic: '',                 // mnemonic for private key derivation\n    WIF: '',                      // wallet import format for private key derivation\n    txHistory: [],                // array of all tx for this address\n    utxoList: [],                 // array of all current utxo for this address\n    checkedHistory: false,        // if wallet tx history has ever been updated\n    checkedUtxo: false            // if wallet utxo including raw tx has ever been updated\n  },\n  chain: {\n    height: 0                     // height of blockchain\n  },\n  pageInfo: {                     // user navigation information for controlling domain name\n    current: 1\n  },\n  settings: {\n    feeRate: 1.1                  // fee rate to use in sat/bByte\n  },\n  lastTimeStamp: Date.now(),      // last change timestamp, to detect any changes to state or time out\n\n}\n\n// helper methods\nexport const getOwner = (st: IState) => {\n  const ownerAddress = st.domain.currentOwner\n  return st.domain.users[ownerAddress]\n}\n\nexport const getUser = (st: IState, address: string) => {\n  return st.domain.users[address]\n}\n\nexport const Store = React.createContext<any>(initialState)\n// returns object with .Provider and .Consumer\n// Provider makes state available to all child components no matter how deep\n\n\n\n// creates wrapping element for global state\nexport function StoreProvider ({ children }: JSX.ElementChildrenAttribute): JSX.Element {\n  const [state, dispatch] = React.useReducer(reducer, initialState)\n\n  return (\n    <Store.Provider value={{ state, dispatch }}>\n      { children }\n    </Store.Provider>\n  )\n}\n","/**\r\n * Takes in a string of interest inputString\r\n * and Array of strings or string describing filter.\r\n * Returns the string of interst with only characters present in filters selected.\r\n */\r\nexport default function  sanitize (inputString, stringOrArray) {\r\n  // get choice input into same form of array of string(s) of choices\r\n  let choices; // :string | Array<string>\r\n  if (Array.isArray(stringOrArray)) {\r\n    choices = stringOrArray;\r\n  }\r\n  if (typeof stringOrArray === 'string') {\r\n    choices = [stringOrArray];\r\n  }\r\n\r\n  // add each choice to filter selection\r\n\r\n  // string mask\r\n  let filter = '';\r\n  // array of functions\r\n  const logicFilters = [];\r\n\r\n  choices.forEach(choice => {\r\n\r\n    // short masks\r\n    if (choice === 'numbers') {\r\n      filter += '0123456789';\r\n    }\r\n    if (choice === 'decimal_point') {\r\n      filter += '.';\r\n    }\r\n    if (choice === 'hex') {\r\n      filter += '0123456789abcdefABCDEF';\r\n    }\r\n    if (choice === 'lowcaps') {\r\n      filter += 'abcdefghijklmnopqrstuvwxyz';\r\n    }\r\n    if (choice === 'highcaps') {\r\n      filter += 'ABCDEFGHIJKLMNOPQRSTUVWYZ';\r\n    }\r\n    if (choice === 'spaces') {\r\n      filter += ' ';\r\n    }\r\n\r\n    // longer masks\r\n    if (choice === 'base58') {\r\n      // https://en.wikipedia.org/wiki/Base58#cite_note-3\r\n      filter += '12345689ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';\r\n    }\r\n    if (choice === 'basic') {\r\n      filter += '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\n    }\r\n    if (choice === 'oneline') {\r\n      filter += '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,./-_!`~[]{}|@#%^&()-=?$';\r\n    }\r\n    if (choice === 'url') {\r\n      filter += `0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ:/?#[]@!$&'()*+,;=-_.~`;\r\n    }\r\n\r\n    // ========================================================\r\n    // functions\r\n    // adds anon function to array of functions\r\n\r\n    if (choice === 'no_spaces') {\r\n      logicFilters.push(str =>\r\n        str.split('')\r\n          .filter(letter => letter !== ' ')\r\n          .join(''))\r\n    }\r\n\r\n    if (choice === 'single_space_width') {\r\n      logicFilters.push(str =>\r\n        // split by 2+ spaces and replace with single space\r\n        str.split(/  */).join(' ')\r\n      )\r\n    }\r\n\r\n    // keep only first decimal point\r\n    if (choice === 'decimal_point') {\r\n\r\n      logicFilters.push(str =>\r\n        (str\r\n          // splits to array between .\r\n          .split('.')\r\n          // join first 2 elements with ., others with empty string\r\n          // returns a string\r\n          .reduce((resultingString = '', letter, index) =>\r\n            // real . goes b/w array's index 0 and 1, even if string had . first\r\n            (index === 1)\r\n              ? [ ...resultingString, letter ].join('.')\r\n              : [ ...resultingString, letter ].join('')\r\n          , undefined)\r\n        )\r\n      )\r\n    }\r\n\r\n\r\n\r\n  })\r\n\r\n  if (filter.length === 0 && logicFilters.length === 0) {\r\n    console.warning('sanitize used w/o any known filters', stringOrArray)\r\n  }\r\n\r\n  let outputString = '';\r\n\r\n  // apply string mask to only keep characters within filter string\r\n  outputString = inputString\r\n    .split('')\r\n    .filter(letter => filter.indexOf(letter) > -1)\r\n    .join('');\r\n\r\n  // use every selected logic function on the outputString\r\n  logicFilters.forEach(fn => outputString = fn(outputString))\r\n\r\n  return outputString;\r\n}\r\n\r\n\r\n// function sanitizeOld (inString, type) {\r\n//   let filter;\r\n//   if (type === 'base58') {\r\n//     // https://en.wikipedia.org/wiki/Base58#cite_note-3\r\n//     filter = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';\r\n//   } else if (type === 'hex') {\r\n//     filter = '0123456789abcdef';\r\n//   } else if (type === 'basic') {\r\n//     filter = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\n//   } else if (type === 'numbers') {\r\n//     filter = '0123456789';\r\n//   } else if (type === 'fractions') {\r\n//     filter = '0123456789.';\r\n//   } else if (type === 'oneline') {\r\n//     filter = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,./-_!`~[]{}|@#%^&()-=?$';\r\n//   } else if (type === 'url') {\r\n//     filter = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ./-_';\r\n//   } else {\r\n//     console.log('sanitize: valid type not provided');\r\n//     return undefined;\r\n//   }\r\n\r\n//   const res = inString\r\n//     .split('')\r\n//     .filter(letter => filter.indexOf(letter) > -1)\r\n//     .join('');\r\n\r\n//   return res;\r\n// }","import { IState, Dispatch } from '../../interfaces'\nimport sanitize from '../../helpers/sanitize'\nimport { ActionTypes } from './../../interfaces'\nconst { TYPING } = ActionTypes;\n\n/**\n * Cleans up the entered string including removing next line characters\n */\nexport const changeAliasAction = async (state: IState, dispatch: Dispatch, value: any) => {\n  // clean up the string\n  const newString = value\n  const sanitizedString = sanitize(newString, 'url')\n\n  return dispatch({\n    type: TYPING,\n    payload: sanitizedString\n  })\n}\n","import { IBnsState } from './../types/'\nimport { MIN_NOTIFY, MIN_BURN } from './../constants'\nimport {\n  existsCurrentOwner,\n  isOwnerExpired,\n  clearOwner,\n  getParsedHeight,\n  atLeastTwoOutputs,\n  isNotify,\n  isOpreturnOutput0,\n  didNotifyMin,\n  didBurnMin,\n  setOwner,\n  getOwner,\n  getUser,\n  getTxInput0SourceUserAddress,\n  getTxHeight,\n  getTxTimestamp,\n  getTxOutput0BurnValue,\n  isAddressTheCurrentOwner,\n  burnedPreviousRateMin,\n  readEmbeddedData,\n  getLastOwnerBurnedValue\n} from './../formathelpers'\n\n// =========== CONDITIONS / PERMISSIONS ================\n// Called by the actions for conditions\n// Return object with \"info\": describing condition,\n// \"status\" to check conditoin,\n// and optional \"special\" to give transaction forming specifications\n\nconst OUTS_2 = ({ tx=undefined }: any) => ({\n  info: 'Tx must have 2+ outputs',\n  status: () => atLeastTwoOutputs(tx)\n})\n\nconst OUT_0 = ({ tx=undefined }: any) => ({\n  info: 'Tx must have OP_RETURN @ output[0]',\n  status: () => isOpreturnOutput0(tx)\n})\n\nconst OUT_1 = ({ st, tx=undefined }: any) => ({\n  info: 'Tx must have notification address @ output[1]' ,\n  status: () => isNotify(st, tx)\n})\n\nconst NOTIFIED_MIN = ({ tx=undefined }: any) => ({\n  info: `Tx must have minimum ${MIN_NOTIFY} @ output[1]`,\n  status: () => didNotifyMin(tx)\n})\n\nconst BURNED_MIN = ({ tx=undefined }: any) => ({\n    info: `Tx must burn ${MIN_BURN} @ output[0]`,\n    status: () => didBurnMin(tx),\n    special: { output0value: MIN_BURN }\n  })\n\nconst NO_OWNER = ({ st }: any) => ({\n  info: 'There must not be an existing owner',\n  status: () => !existsCurrentOwner(st)\n})\n\nconst EXISTS_OWNER = ({ st }: any) => ({\n  info: 'There must be existing owner',\n  status: () => existsCurrentOwner(st)\n})\n\nconst BURN_LAST_WIN = ({ st, tx=undefined }: any) => ({\n  info: 'Tx must burn the last ownership winning burn amount',\n  status: () => burnedPreviousRateMin(st, tx),\n  special: { output0value: getLastOwnerBurnedValue(st) }\n})\n\nconst USER_IS_OWNER = ({ st, address=undefined }: any) => ({\n  info: `User's address must match owner's address`,\n  status: () => isAddressTheCurrentOwner(st, address)\n})\n\nconst IS_OWNER_EXPIRED = ({ st }: any) => ({\n  info: 'Ownership must be expired at current parsed height',\n  status: () => isOwnerExpired(st)\n})\n\n\n// ============ USER ACTIONs ===============\n\n// Describe: If no owner, sender can claim ownership\nexport const claimOwnershipAction = (st: IBnsState, tx: any = undefined) => {\n  const args = { st, tx }\n  return {\n\n    info: 'Claim ownership of an available domain',\n\n    permissions: [\n      NO_OWNER(args)\n    ],\n\n    conditions: [\n      OUTS_2(args),\n      OUT_0(args),\n      OUT_1(args),\n      NOTIFIED_MIN(args),\n\n      BURNED_MIN(args)\n    ],\n\n    execute: () => {\n      // ownership source was already created for sure via updateSourceUserFromTx\n      // only have to set owner address to tx address\n      const height = getTxHeight(tx)\n      const senderAddress =  getTxInput0SourceUserAddress(tx)\n      setOwner(st, senderAddress)\n      getUser(st, senderAddress).winHeight = height\n      getUser(st, senderAddress).winTimestamp = getTxTimestamp(tx)\n      getUser(st, senderAddress).burnAmount = getTxOutput0BurnValue(tx)\n\n      // set ownership to this address\n      // update win height / time\n\n      console.log(\n        `${ st.domain.domainName } : ${ getTxHeight(tx) } height: new owner is ${ getUser(st, senderAddress).address }`\n      )\n    }\n  }\n}\n\n\n// Describe: If from current owner & burned past winning minimum, extend ownership.\nexport const currentOwnerRenewAction = (\n  st: IBnsState,\n  address: string,\n  tx: any = undefined\n) => {\n  const args = { st, address, tx }\n  return {\n\n    info: 'Extend ownership of this domain',\n\n    permissions: [\n      USER_IS_OWNER(args)\n    ],\n\n    conditions: [\n      OUTS_2(args),\n      OUT_0(args),\n      OUT_1(args),\n      NOTIFIED_MIN(args),\n\n      BURNED_MIN(args),\n      BURN_LAST_WIN(args)\n    ],\n\n    execute: () => {\n      const owner = getOwner(st)\n      // set owner's win height to current tx height therefore updating ownership\n      owner && (owner.winHeight = getTxHeight(tx))\n      owner && (owner.winTimestamp = getTxTimestamp(tx))\n      console.log(\n        `${ st.domain.domainName } : ${ getTxHeight(tx) } height: owner extended ownership ${ owner?.address }`\n      )\n    }\n  }\n}\n\n// Describe: update forwarding information.\nexport const updateForwardingInfoAction = (\n  st: IBnsState,\n  tx: any = undefined\n) => {\n  const args = { st, tx }\n  return {\n\n    info: \"Only update forwarding information\",\n\n    permissions: [],\n\n    conditions: [\n      OUTS_2(args),\n      OUT_0(args),\n      OUT_1(args),\n      NOTIFIED_MIN(args)\n    ],\n\n    execute: () => {\n      readEmbeddedData(st, tx)\n    }\n  }\n}\n\n// =========== AUTOMATIC PARSED ACTIONS NOT BY USERS (e.g. TIME BASED) ===========\n\n// Describe: if OWNERSHIP_DURATION_BY_BLOCKS blocks since ownership update, no owner again\nexport const autoCheckForOwnerExpired = (st: IBnsState) => {\n  const args = { st }\n  return {\n    info: 'Existing ownerships that expire are removed',\n\n    conditions: [\n      EXISTS_OWNER(args),\n      IS_OWNER_EXPIRED(args)\n    ],\n\n    execute: () => {\n      clearOwner(st)\n      console.log(st.domain.domainName, getParsedHeight(st), 'ownership expired')\n    }\n  }\n}","import { calcP2WSH } from './calcP2WSH'\nimport { newState } from './initialState'\nimport * as actions from './actions'\nimport { IBnsState } from './types'\nimport {\n  setParsedHeight,\n  updateSourceUserFromTx,\n  getTxHeight,\n  updateOwnerHistory,\n  getCurrentHeight\n } from './formathelpers'\n\n/**\n * Returns ownership and notification information objects.\n * @param   {Array<any>}  notificationsHistory  - Array of any tx with notificationsAddress.\n * @param   {string}      domainName            - Full domainName to use (e.g. 'satoshi.btc').\n * @param   {number}      currentHeight         - Current blockheight of the network chain selected.\n * @param   {string}      networkChoice         - 'testnet' or 'bitcoin' (matches bitcoinjs-lib).\n * @returns {IBnsState}                         - BNS state describing object.\n */\nexport const calcBnsState = (\n  notificationsHistory: Array<any>,\n  domainName: string,\n  currentHeight: number,\n  networkChoice: string\n): IBnsState => {\n\n  // initialize temporary derivation state\n  const st = JSON.parse(JSON.stringify(newState)); // deep object clone\n  st.domain.domainName = domainName\n  st.chain && (st.chain.currentHeight = currentHeight)\n  st.domain.notificationAddress = calcP2WSH(domainName, networkChoice)?.notificationsAddress || ''\n\n  // Sorting history from earliest to latest\n  // reversing should speed it up if not complete it\n  st.domain.txHistory = (notificationsHistory\n    .slice().reverse()\n    .sort((prev, next) => {\n      const aBlockHeight = prev.status.block_height\n      const bBlockHeight = next.status.block_height\n      return aBlockHeight - bBlockHeight\n    })\n  )\n\n  // iterate with blockheights of relevant tx to derive st state\n  // Each tx blockheight serves as reference time\n  st.domain.txHistory.forEach((tx: any) => {\n\n    // update current parsed height based on tx confirmed height\n    setParsedHeight(st, getTxHeight(tx))\n\n    // update or create new basic user info based on source address @ input0\n    // this includes nonce set to previous update height for this user\n    updateSourceUserFromTx(st, tx)\n\n    // check if owner expired\n    actions.runAllAutomaticChecks(st)\n\n    // run all possible actions\n    // starting with reading embedded data\n    actions.runAllUserActions(st, tx)\n\n    // update ownership history each tx\n    updateOwnerHistory(st)\n\n  })\n\n  // final check for current block height\n  setParsedHeight(st, getCurrentHeight(st))\n  actions.autoCheckForOwnerExpired(st)\n\n  return st\n}\n\n","import {\n  currentOwnerRenewAction,\n  claimOwnershipAction,\n  autoCheckForOwnerExpired,\n  updateForwardingInfoAction\n} from './actions'\nimport { IBnsState } from './../types/'\nimport {\n  getTxInput0SourceUserAddress\n} from './../formathelpers'\n\n/****************************************************************************************\n * Returns what actions are available for specific user address at current state\n */\nexport const runAllActionPermissionChecks = (st: IBnsState, address: string) => {\n\n  // Edit this list to include more actions for checks\n  const allActions = [\n    updateForwardingInfoAction(st),\n    currentOwnerRenewAction(st, address),\n    claimOwnershipAction(st)\n  ]\n\n  // check which actions are doable\n  const checkedActions: any[] = []\n  allActions.forEach(action => {\n\n    // check each permission in each action\n    const checkedPermissions: any[] = []\n    action.permissions.forEach((permission: any) => {\n      const isAllowed = permission.status()\n\n      // add to list of permissions checked in this action & their display info\n      checkedPermissions.push({\n        isAllowed,\n        info: permission.info\n      })\n    })\n\n    // grab every special rule so can put together tx based on them\n    const specialTxDirections: any[] = []\n    action.permissions.forEach((permission: any) => {\n      if ('special' in permission) specialTxDirections.push({\n        info: permission.info,\n        rule: permission.special\n      })\n    })\n    action.conditions.forEach((condition: any) => {\n      if ('special' in condition) specialTxDirections.push({\n        info: condition.info,\n        rule: condition.special\n      })\n    })\n\n\n    // add to list of all actions with summary of all their permissions checks\n    checkedActions.push({\n      info: action.info,\n      isUsable: checkedPermissions.every(permission => permission.isAllowed),\n      permissionList: checkedPermissions,\n      special: specialTxDirections\n    })\n  })\n\n  // return array of doable actions\n  return checkedActions\n}\n\n/****************************************************************************************\n * Executes all actions possible by user that sent tx.\n * Nothing returned.\n */\nexport const runAllUserActions = (st: IBnsState, tx: any) => {\n\n  // edit this list\n  const allUserActions = [\n    updateForwardingInfoAction(st, tx),\n    currentOwnerRenewAction(st, getTxInput0SourceUserAddress(tx), tx),\n    claimOwnershipAction(st, tx)\n  ]\n\n  allUserActions.forEach((action: any) => {\n\n    // check that all conditions & permissions are true\n    const okConditions = action.conditions.reduce(\n      (areAllConditionsMet: boolean, eaCondition: any) => areAllConditionsMet && eaCondition.status()\n    , true)\n\n    const okPermissions = action.permissions.reduce(\n      (areAllPermissionsMet: boolean, eaPermission: any) => areAllPermissionsMet && eaPermission.status()\n    , true)\n\n    if (okConditions && okPermissions) action.execute()\n  })\n}\n\n/****************************************************************************************\n * Executes non-user actions like ownership expiration over time.\n * Nothing returned.\n */\nexport const runAllAutomaticChecks = (st: IBnsState) => {\n\n  // list of all automatic actions\n  const allAutoChecks = [\n    autoCheckForOwnerExpired(st)\n  ]\n\n  allAutoChecks.forEach(action => {\n    // check that all conditions are true\n    const ok = action.conditions.reduce((areAllConditionsMet, eaCondition) => (\n      areAllConditionsMet && eaCondition.status()\n    ), true)\n    if (ok) action.execute()\n  })\n}\n\n\n","import { encrypt } from './cryptography'\n\n/**\n * Returns number of bytes the string has after encryption.\n * Encryption is used directly to measure result accurately\n * even if cryption method changes in the future.\n */\nexport const stringByteCount = (data: string): number => {\n  const cipher: Buffer = encrypt(data, 'arbitrary key and iv seeding string')\n  // returns buffer, so length should be bytesize\n  return cipher.length;\n}","import axios from 'axios'\n\n// Documentation\n// https://github.com/Blockstream/esplora/blob/esplora_v2.00/API.md\n// https://github.com/Blockstream/esplora/blob/master/API.md#post-tx\n\nconst API_PATH_TESTNET = 'https://blockstream.info/testnet/api/'\nconst API_PATH_BITCOIN = 'https://blockstream.info/api/'\nconst API_RATE_LIMIT = 0.6    // guessing calls per second cap\n\n// (TODO) a single instance of async task executing loop per API to ensure rate limit holds per API\n// Meanwhile calling function can use its own busy flag to ensure promises are resolved before repeats.\n// RawTx requests and multipage history (length > 25) are main risks.\n\n\nexport async function getHeight (strNetwork: string) {\n  const API_PATH = (\n    (strNetwork === 'testnet')\n    ? API_PATH_TESTNET\n    : API_PATH_BITCOIN\n  ) + 'blocks/tip/height'\n  console.log(API_PATH)\n\n  try {\n\n    const res = await axios.get(API_PATH)\n    console.log('getHeight', res.data)\n    return res.data\n\n  } catch (e) {\n\n    console.log(e)\n    await rateLimit()\n    throw new Error('Blockstream.info API height get failed')\n  }\n\n}\n\n/**\n * API request for each UTXO in array to get the raw tx necessary for psbt.\n * @param     {Array}     arrayUtxo       Array of UTXO.\n * @param     {string}    strNetwork      Network type: 'bitcoin' or 'testnet'.\n * @returns   {object}                    { arrayTx: arrayTx w/ .hex, error: string, fails: number }\n */\nexport async function addRawTxToArray (arrayUtxo: Array<any>, strNetwork: string) {\n  // to track failures indecies\n  let erroredOutputs = ''\n\n  // abort if empty array\n  if (arrayUtxo?.length === 0) { return { arrayUtxo, error: 'no utxo' } }\n\n  // clone array\n  const arrayUtxoWithHex = [...arrayUtxo]\n\n  // iterate through original utxo and add hex onto clone, 2 tries max each\n  for (const [indexString, utxo] of Object.entries(arrayUtxo)) {\n    // indexString is a string so convert for array index use\n    const index = parseInt(indexString, 10)\n\n    let tries = 2\n    while (tries-- > 0) {\n      try {\n        const { txid } = utxo\n\n        // raw tx hex path on API\n        const API_PATH = (\n          (strNetwork === 'testnet')\n            ? API_PATH_TESTNET\n            : API_PATH_BITCOIN\n        ) + 'tx/' + txid + '/hex'\n        console.log(API_PATH)\n\n        const res = await axios.get(API_PATH)\n\n        console.log(index, 'index utxo has raw hex of', res.data)\n\n        // add hex data into cloned utxo array\n        arrayUtxoWithHex[index].hex = res.data\n\n        // break while loop if got data, don't need more tries\n        break\n\n      } catch(e) {\n        // keeping track of failures\n        console.log('fail detected', indexString, utxo, tries, erroredOutputs, e)\n        // keep track of indecies missing hex\n        erroredOutputs += indexString + ' '\n      }\n\n      await rateLimit()\n    }\n  }\n\n  // return summary object\n  return { arrayUtxoWithHex, erroredOutputs }\n}\n\n/**\n * API request for all utxo for this address\n * @param     {string}    address       Bitcoin address.\n * @param     {string}    strNetwork    Network type: 'bitcoin' or 'testnet'.\n * @returns   {Array}                   Array of UTXO.\n */\nexport async function getUTXOList (address: string, strNetwork: string) {\n  const API_PATH = (\n    (strNetwork === 'testnet')\n    ? API_PATH_TESTNET\n    : API_PATH_BITCOIN\n  ) + 'address/' + address + '/utxo'\n  console.log(API_PATH)\n\n  try {\n    const res = await axios.get(API_PATH)\n\n    console.log('getUTXOList', res.data)\n\n    await rateLimit()\n\n    return res.data\n\n  } catch (e) {\n\n    console.log(e)\n    await rateLimit()\n    throw new Error('Blockstream.info API access failed')\n\n  }\n}\n\n/**\n * API request all transactions for a specific address.\n * parameters: (address, network).\n * @param   {string} address    - address on network.\n * @param   {string} network    - 'testnet' or 'bitcoin' to match bitcoinjs-lib.\n * @returns {Array<object>}     -  Array of tx objects.\n */\nexport async function getAddressHistory (address: string, network: string) {\n  // https://blockstream.info/testnet/api/address/tb1qprkzdaqt5jkxrhy57ngvra8k0rvq63ulksz8cx85qwke3myhjrtq9s6nj3/txs/chain\n  // GET /address/:address/txs/chain[/:last_seen_txid]\n  // Get confirmed transaction history for the specified address/scripthash, sorted with newest first.\n  // Returns 25 transactions per page. More can be requested by specifying the last txid seen by the previous query.\n\n  const CONFIRMED_PAGES_ADDON = '/txs/chain'\n\n  const API_PATH = (\n    (network === 'testnet')\n    ? API_PATH_TESTNET\n    : API_PATH_BITCOIN\n  ) + 'address/' + address + CONFIRMED_PAGES_ADDON\n\n  try {\n    const res = await axios.get(API_PATH)\n\n    console.log('blockstream.info API address history request', res)\n    return res.data\n\n  } catch (e) {\n    console.log(e)\n    throw new Error('Blockstream.info API access failed')\n  }\n}\n\n/**\n * Broadcasts content onto the blockchain.\n * parameters: (content, network).\n * @param   {string}  content  - raw hex content of transaction.\n * @param   {string}  network  - 'testnet' or 'bitcoin' to match bitcoinjs-lib.\n * @returns {string}           - Successful broadcast returns txid, otherwise error reason.\n */\nexport async function txPush (content: string, network: string) {\n\n  // const API_PATH_TESTNET =\n  //  'https://blockstream.info/testnet/api/broadcast'\n\n  // const API_PATH_BITCOIN =\n  //   'https://blockstream.info/api/broadcast'\n\n  const API_PATH =\n    (network === 'testnet')\n    ? API_PATH_TESTNET + 'broadcast'\n    : API_PATH_BITCOIN + 'broadcast'\n\n  try {\n    const res = await axios.get(API_PATH, {\n      params: {\n        tx: content\n      }\n    })\n\n    // console.log(res)\n    console.log('Broadcasted on', network)\n\n    // returns txid on success\n    return { txid: res.data }\n\n  } catch (e) {\n    console.log('Failed pushtx', network, e)\n\n    // console.log('error main message:', e.response.data)\n    return { error: e.response.data }\n  }\n}\n\n// Slow down based on rate limit.\n// Convert hz to time in milliseconds.\nasync function rateLimit () {\n  return new Promise(r => setTimeout(r, 1000.0 / API_RATE_LIMIT))\n}\n","import { IState, Dispatch, ActionTypes } from '../../interfaces'\nimport { calcP2WSH, calcBnsState } from '../../helpers/bns'\nimport { getAddressHistory, getHeight } from './../../api/blockstream'\nconst { STORE_SEARCH_RESULTS_FAIL, STORE_SEARCH_RESULTS } = ActionTypes;\n\n/**\n * Get address,\n * tx with notification address,\n * calculate owner,\n * find current owner's forwarding info,\n * send/dispatch to reducer to store important data found\n */\nexport const searchAction = async (state: IState, dispatch: Dispatch, router: any = undefined) => {\n  const domainName = state.alias + state.extension\n  // stop if no alias submitted, nothing to save to state\n  if (!state.alias) { return undefined }\n\n  // find address for this alias\n  const { notificationsAddress } = calcP2WSH(domainName, state.network)\n\n  // (TODO) should check if max length for API reached to know if to use pages & append value (25?)\n\n  try {\n\n    // 1. Get current blockheight from API so ownership is using latest possible info\n\n    const currentHeight = await getHeight(state.network)\n\n    // 2. Get API response for all tx history of this address\n    // This will grab all tx that \"notified\" this address by sending to it\n    // Upon failure error should be caught in this function\n    const notificationsTxHistory = await getAddressHistory(notificationsAddress, state.network)\n\n    // calculate bns data from this history via helper functions\n    const { domain } = calcBnsState(\n      notificationsTxHistory,\n      domainName,\n      currentHeight,\n      state.network\n    )\n\n    // 3. if navigated via id, use router to navigate home w/o id in url\n    if (router) { router?.push('/') }\n\n    // store data\n    return dispatch({\n      type: STORE_SEARCH_RESULTS,\n      payload: {\n        alias: state.alias,\n        domain,\n        chain: {\n          height: currentHeight\n        }\n      }\n    })\n\n  } catch (e) {\n    console.log(e)\n    // still updating the notification address\n    return dispatch({\n      type: STORE_SEARCH_RESULTS_FAIL,\n      payload: {\n        alias: state.alias,               // can save alias\n        domainName,\n        notificationsAddress              // can save this easy derivation\n      }\n    });\n  }\n}\n\n// test address tb1qprkzdaqt5jkxrhy57ngvra8k0rvq63ulksz8cx85qwke3myhjrtq9s6nj3\n// has mixture of tx sent to it on testnet\n// https://blockstream.info/testnet/address/tb1qprkzdaqt5jkxrhy57ngvra8k0rvq63ulksz8cx85qwke3myhjrtq9s6nj3","import * as bitcoin from 'bitcoinjs-lib'\r\nimport bip39 from 'bip39'\r\n\r\n\r\n/**\r\n * Scans the address for utxo on a given network.\r\n * (In BNS would be useful for wallet and notification address)\r\n */\r\n// export const scanAddress = async (address: string, strNetwork: string) => {\r\n  // create array of utxo\r\n\r\n\r\n  // add full tx hex to that array (might take time)\r\n// }\r\n\r\n/**\r\n * Make new mnemonic for p2wpkh m/44'/0'/0'/0/0 address and WIF.\r\n * @param     {string}    strNetwork    String describing network ('bitcoin', 'testnet').\r\n * @returns   {object}                  Object { mnemonic, WIF, address } - all strings.\r\n */\r\nexport const createNewWallet = (strNetwork: string) => {\r\n  // network version. bitcoin or testnet\r\n  const network = bitcoin.networks[strNetwork]\r\n  // create backup phrase\r\n  const mnemonic = bip39.generateMnemonic()\r\n  const seedBuffer = bip39.mnemonicToSeed(mnemonic)\r\n  // create derivation master node\r\n  const masterNode = bitcoin.bip32.fromSeed(seedBuffer, network)\r\n  // derive m/44'/0'/0'/0 /0 node\r\n  const childNode0 = masterNode.derivePath(\"m/44'/0'/0'\").derivePath(\"0/0\")\r\n  // get private key in wallet import format for that child node\r\n  const WIF = childNode0.toWIF()\r\n  // derive a standard p2wpkh address from that WIF\r\n  const keyPair = bitcoin.ECPair.fromWIF(WIF, network)\r\n  const address = bitcoin.payments.p2wpkh({ pubkey: keyPair.publicKey, network }).address\r\n\r\n  return { mnemonic, WIF, address }\r\n}\r\n\r\n/**\r\n * Load p2wpkh m/44'/0'/0'/0/0 wallet info from mnemonic.\r\n * @param     {string}    strMnemonic     Mnemonic string of 12 words as described in bip39.\r\n * @param     {string}    strNetwork      String describing network ('bitcoin', 'testnet').\r\n * @returns   {object}                    Object { mnemonic, WIF, address } - all strings.\r\n */\r\nexport const loadWallet = (strMnemonic: string, strNetwork: string) => {\r\n  // network version. bitcoin or testnet\r\n  const network = bitcoin.networks[strNetwork]\r\n  const seedBuffer = bip39.mnemonicToSeed(strMnemonic)\r\n  // create derivation master node\r\n  const masterNode = bitcoin.bip32.fromSeed(seedBuffer, network)\r\n  // derive m/44'/0'/0'/0 /0 node\r\n  const childNode0 = masterNode.derivePath(\"m/44'/0'/0'\").derivePath(\"0/0\")\r\n  // get private key in wallet import format for that child node\r\n  const WIF = childNode0.toWIF()\r\n  // derive a standard p2wpkh address from that WIF\r\n  const keyPair = bitcoin.ECPair.fromWIF(WIF, network)\r\n  const address = bitcoin.payments.p2wpkh({ pubkey: keyPair.publicKey, network }).address\r\n\r\n  return { mnemonic: strMnemonic, WIF, address }\r\n}\r\n\r\n\r\n//\r\n/**\r\n * Parse UTXO array to get total unspent balance in satoshi.\r\n * @param     {Array}    utxoArray      Array of UTXO objects with '.value' field in satoshi.\r\n * @returns   {number}                  Total number of unspent satoshi.\r\n */\r\nexport function getUnspentSum(utxoArray: Array<any>): number {\r\n\r\n  const sumSats = utxoArray?.reduce(\r\n    (sum: number, utxo: any) => sum + utxo.value\r\n    , 0) || 0\r\n\r\n  return sumSats\r\n}","import { IState, Dispatch } from '../../interfaces'\nimport { ActionTypes } from './../../interfaces'\n\nimport { createNewWallet, loadWallet } from './../../helpers/bitcoin'\n\nconst { NEW_WALLET } = ActionTypes;\n\n/**\n * Create new wallet address & backup.\n * If mnemonic is provided, wallet is generated from that.\n */\nexport const createNewWalletAction = async (\n  state: IState, dispatch: Dispatch, strMnemonic: string = ''\n) => {\n\n  // load all the wallet info from mnemonic or generate new random mnemonic to do it\n  const { mnemonic, WIF, address } = (\n    (strMnemonic === '')\n      ? createNewWallet(state.network)\n      : loadWallet(strMnemonic, state.network)\n  )\n\n  return dispatch({\n    type: NEW_WALLET,\n    payload: { mnemonic, WIF, address }\n  })\n}","import { IState, Dispatch, ActionTypes } from '../../interfaces'\nconst { CHANGE_PAGE_INFO } = ActionTypes;\n\n\n/**\n * Request to change page info that's checked for validity here\n */\nexport const changePageInfoAction = async (state: IState, dispatch: Dispatch, page: number) => {\n  // for now no checks\n\n  const { pageInfo } = state\n  pageInfo.current = page\n\n  return dispatch({\n    type: CHANGE_PAGE_INFO,\n    payload: pageInfo\n  })\n}","import { IState, Dispatch, ActionTypes } from '../../interfaces'\nimport { calcP2WSH, calcBnsState } from '../../helpers/bns'\nimport { getAddressHistory, getUTXOList, addRawTxToArray, getHeight } from '../../api/blockstream'\nconst { UPDATE_WALLET, UPDATE_DOMAIN, ACTION_FAIL } = ActionTypes\n\n/**\n * Scans the address for utxo on a given network (w/ API).\n * Add hex of each tx that created utxo (for psbt).\n * addressType is one of enums ActionTypes that's either UPDATE_WALLET or UPDATE_NOTIFICATION.\n * If scanning wallet, then update wallet state.\n * If scanning notification address, then update notification state.\n * Notification scan will reproduce address scan first before getting details.\n */\nexport const scanAddressFullyAction = async (\n  state: IState,\n  dispatch: Dispatch,\n  addressType: ActionTypes\n) => {\n  const domainName = state.alias + state.extension\n\n  // wallet address scan\n  if (addressType === UPDATE_WALLET) {\n    // wallet address\n\n    try {\n\n      // 1. get address TX history\n\n      const walletAddress = state.wallet.address\n      const walletTxHistory = await getAddressHistory(walletAddress, state.network)\n\n      // 2. get address UTXO list (could also calculate from tx history or API)\n\n      const utxoListWalletAddress = await getUTXOList(walletAddress, state.network)\n\n      // 3. get raw tx for each UTXO (psbt requirement...)\n\n      const { arrayUtxoWithHex, erroredOutputs } = await addRawTxToArray(utxoListWalletAddress, state.network)\n\n      console.log({ walletAddress, walletTxHistory, utxoListWalletAddress, arrayUtxoWithHex, erroredOutputs })\n\n      return dispatch({\n        type: UPDATE_WALLET,\n        payload: {\n          wallet: {\n            txHistory: walletTxHistory,\n            utxoList: arrayUtxoWithHex\n          }\n        }\n      })\n\n    } catch (e) {\n      console.log('Wallet address scan failed')\n      console.log(e)\n      // abort\n      return dispatch({\n        type: ACTION_FAIL,\n        payload: {}\n      });\n    }\n  }\n\n  // notification address scan\n  if (addressType === UPDATE_DOMAIN) {\n\n\n    try {\n\n      // 1. get current blockheight from API so ownership is using latest possible info\n\n      const currentHeight = await getHeight(state.network)\n\n      // 2. get address TX history\n\n      const { notificationsAddress } = calcP2WSH(domainName, state.network)\n      const notificationsTxHistory = await getAddressHistory(notificationsAddress, state.network)\n\n\n      // 3. get address UTXO list (could also calculate from tx history or API)\n\n      const utxoListNotificationAddress = await getUTXOList(notificationsAddress, state.network)\n\n      // 4. get raw tx for each UTXO (psbt requirement...)\n\n      const { arrayUtxoWithHex, erroredOutputs } = await addRawTxToArray(utxoListNotificationAddress, state.network)\n\n      // (TODO) add utxo param & use to calcBnsState\n      const { domain } = calcBnsState(\n        notificationsTxHistory,\n        domainName,\n        currentHeight,\n        state.network\n      )\n\n      console.log({ domain, utxoListNotificationAddress, arrayUtxoWithHex, erroredOutputs })\n\n      return dispatch({\n        type: UPDATE_DOMAIN,\n        payload: {\n          domain: {\n            ...domain,\n            utxoList: arrayUtxoWithHex\n          },\n          chain: {\n            height: currentHeight\n          }\n        }\n      })\n\n    } catch (e) {\n      console.log('Notification address scan failed')\n      console.log(e)\n      // abort\n      return dispatch({\n        type: ACTION_FAIL,\n        payload: {}\n      });\n    }\n\n  }\n\n  throw new Error('unexpected address type')\n}","import React from 'react'\nimport { Store, getOwner } from './../../store'\nimport { Link } from 'react-router-dom'\n\nimport styles from './SearchResults.module.css'\nimport timeDiff from './../../helpers/timediff'\nimport { OWNERSHIP_DURATION_BY_BLOCKS, interpretFw, findLatestForwards } from '../../helpers/bns/'\n\n\nexport const SearchResults = () => {\n  // global state\n  const { state } = React.useContext(Store)\n\n  // temp object to keep track of timers\n  let diff = { isExpired: true, dh: '' }\n\n  // calc time left in ownership via block heights\n  const owner = getOwner(state)\n  if (owner) {\n    const heightOfExpiration = owner.winHeight + OWNERSHIP_DURATION_BY_BLOCKS\n    const blocksUntilExpires = (heightOfExpiration - state.chain.height)\n    const msUntilExpires = blocksUntilExpires * 10.0 * 60.0 * 1000.0\n    diff = timeDiff(msUntilExpires, 0)\n  }\n\n  // account expires or isExpired information\n  const expirationMsg = () => {\n    // abort if no known ownership history\n    if (!owner) return ('')\n    return (\n      <div\n        className={ diff.isExpired ? styles.isExpired : styles.notisExpired }\n      >\n        { !diff.isExpired && ('expires in ' + diff.dh) }\n      </div>\n    )\n  }\n\n  // calculate latest forwards\n  const latestForwards = owner ? findLatestForwards(owner.forwards) : []\n\n  return (\n    <>\n      <div className={ styles.wrapper }>\n        <div\n          className={ styles.describe }\n        >\n          { latestForwards.length } matches on { state.network } {'  '}\n          { expirationMsg() }\n        </div>\n        <div className={ styles.listContainer } >\n          {(diff.isExpired) && (\n            <Link\n              to='/create'\n              className={ styles.createLink }\n            >\n              Domain available!\n            </Link>\n          )}\n        </div>\n        <div className={ styles.listContainer } >\n          {\n            latestForwards.map(fw => {\n              const ifw = interpretFw(fw)\n              if (ifw.render) {\n                return (\n                  <a\n                    key={ fw.network }\n                    className={ styles.listItem }\n                    href={ encodeURI(ifw?.link || '') || undefined }\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                  >\n                    <span className={ styles.key }>{ ifw.where }</span>\n                    { ifw.what }\n                  </a>\n                )\n              } else {\n                return ('')\n              }\n            })\n          }\n        </div>\n      </div>\n    </>\n  )\n}\n","\n/**\n * Difference between timestampMsec timestamp relative to current time or another reference referenceTimestampMsec timestamp.\n * Returns days-hours-minutes string, days-hours string, if expired, and ms of difference.\n * @param   {number}  timestampMsec               Timestamp of interest (milliseconds).\n * @param   {number}  [referenceTimestampMsec=]   Reference timestamp (milliseconds).\n * @returns {object}                              { dhm, dh, isExpired, msDiff }.\n */\nexport default function timeDiff(\n  timestampMsec: number, referenceTimestampMsec: number = Date.now()\n): {\n  dhm: string\n  dh: string\n  isExpired: boolean\n  msDiff: number\n} {\n  let diff = timestampMsec - referenceTimestampMsec\n  // note sign\n  const isExpired = (diff <= 0)\n  // mod away higher time frames\n  diff = Math.abs(diff)\n  const d = Math.floor(diff / (1000 * 60 * 60 * 24))\n  // remove days\n  diff -= d * (1000 * 60 * 60 * 24)\n  const h = Math.floor(diff / (1000 * 60 * 60)) % 24\n  // remove hours\n  diff -= h * (1000 * 60 * 60)\n  const m = Math.floor(diff / (1000 * 60)) % 60\n  return {\n    dhm: `${d} days ${h} hours ${m} min`,\n    dh: `${d} days ${h} hours`,\n    isExpired,        // time difference is to the past of now? (boolean)\n    msDiff: diff\n  };\n}","  // take array of all forwards for owner and return array with only latest forwards\nexport const findLatestForwards = (forwards: Array<any>) => {\n  // simplest would be to go through object where keys of cloned network would overwrite\n  // sort first for simplicity\n  const sortedForwards = [...forwards].sort((prev, next) => {\n    // sorts by index proportional to block height and time\n    const prevHeight = prev.updateHeight\n    const nextHeight = next.updateHeight\n    return prevHeight - nextHeight\n  })\n  // now just overwrite values for same networks in order of sorted array\n  const currentNetworks: {[key: string]: any} = {}\n  sortedForwards.forEach(eaForward => {\n    currentNetworks[eaForward.network] = eaForward\n  })\n  // return just array of values, networks still part of values as well\n  return Object.values(currentNetworks)\n}\n","/**\n * Reads a single forward info object to interpret its values\n * as where the forwarding address should be used, what it is, and what link to use.\n * Returns {what: string, where: string, link: string, render: boolean}.\n */\nexport function interpretFw (\n  fw: { network: string, address: string, updateHeight: number, updateTimestamp: number }\n) {\n  // blank address means it was removed\n  if (fw.address === '') {\n    return {\n      render: false\n    }\n  }\n\n  if (fw.network === 'p2wsh' || fw.network === 'btc') {\n    return {\n      where: 'btc:',\n      what: (\n        fw.address\n      ),\n      link: (\n        'https://blockstream.info/address/' + fw.address\n      ),\n      render: true\n    }\n  }\n\n  if (fw.network === 'http' || fw.network === 'https' || fw.network === 'url' || fw.network === 'web') {\n    return {\n      where: 'https://',\n      what: fw.address,\n      link: 'https://' + fw.address,\n      render: true\n    }\n  }\n\n  if (fw.network === 'twitter') {\n    return {\n      where: 'twitter.com/',\n      what: fw.address,\n      link: 'https://twitter.com/' + fw.address,\n      render: true\n    }\n  }\n\n  if (fw.network === 'github') {\n    return {\n      where: 'github.com/',\n      what: fw.address,\n      link: 'https://github.com/' + fw.address,\n      render: true\n    }\n  }\n\n  if (fw.network === 'youtube') {\n    return {\n      where: 'youtu.be/',\n      what: fw.address,\n      link: 'https://www.youtube.com/watch?v=' + fw.address,\n      render: true\n    }\n  }\n\n  // if unknown forward network, no link, and the rest is shown as is\n  return {\n    where: fw.network,\n    what: fw.address,\n    link: undefined,\n    render: true\n  }\n}\n","import React, { useEffect, useRef } from 'react'\nimport { RoundButton } from './../general/RoundButton'\nimport { Store } from './../../store/'\nimport { searchAction, changeAliasAction } from './../../store/actions/'\nimport { SearchResults } from './../SearchResults'\nimport styles from './HomeContent.module.css'\n\nexport const HomeContent = (props: any): JSX.Element => {\n  const { state, dispatch } = React.useContext(Store)\n\n  // if page is loaded with #/id/:alias format\n  // this will change alias to that one\n  // then it will navigate to '/'\n  // and then it will do search with new alias\n  // http://localhost:3000/#/id/satoshi\n  const alias = props?.match?.params?.alias\n  if (alias) {\n    searchAction({...state, alias}, dispatch, props.history)\n  }\n\n  // is serach done\n  const isSearchDone = () => state.domain.checkedHistory\n\n  // put the textarea (by ref) into focus on mount and move caret to end\n  const inputEl = useRef<HTMLTextAreaElement>(null)\n  useEffect(() => {\n    if (inputEl && inputEl.current) {\n      inputEl.current.selectionEnd = inputEl.current.value.length\n      inputEl.current.selectionStart = inputEl.current.value.length\n      inputEl.current.focus()\n    }\n  }, [])\n\n  const placeHolder = 'satoshi'\n  return (\n    <>\n      <div className={\n        !isSearchDone()\n          ? [styles.lblMainTitle, styles.noselect].join(' ')\n          : [styles.lblMainTitle, styles.lblMainTitleAfter, styles.noselect].join(' ')\n      }>\n        <span>Bitcoin</span> Name System\n      </div>\n      <div className={\n        !isSearchDone()\n          ? styles.divSearch\n          : [styles.divSearch, styles.divSearchAfter].join(' ')\n      }>\n        <textarea\n          id=\"txtSearch\"\n          className={ styles.txtSearch }\n          cols={ 30 }\n          rows={ 1 }\n          spellCheck={ false }\n          value={ state.alias }\n          placeholder={ placeHolder }\n          ref={ inputEl }\n          onChange={ e => changeAliasAction(state, dispatch, e?.target?.value) }\n          onKeyPress={ e => { e.key === 'Enter' && searchAction(state, dispatch) } }\n        ></textarea>\n        <RoundButton\n          sizebutton='2.6'\n          onClick={ () => searchAction(state, dispatch) }\n        >\n          .btc\n        </RoundButton>\n      </div>\n      <div style={{ display: isSearchDone() ? 'block' : 'none' }}>\n        <SearchResults />\n      </div>\n    </>\n  )\n}\n","import React from 'react'\nimport { HomeContent } from './../components/HomeContent'\n\nconst Home = (props: any): JSX.Element => {\n  return (\n    <>\n      <HomeContent { ...props } />\n    </>\n  )\n}\nexport default Home","import React from 'react'\nimport { Store } from './../../store/'\nimport styles from './AboutContent.module.css'\n\nexport const AboutContent = () => {\n  const { state } = React.useContext(Store)\n\n  return (\n    <>\n      <div>\n        About page\n      </div>\n      <div className={ styles.wrapper }>\n        <pre>\n          { JSON.stringify({ ...state }, null, 2) }\n        </pre>\n      </div>\n    </>\n  )\n}\n","import React from 'react'\nimport { AboutContent } from './../components/AboutContent'\n\nexport default function About(): JSX.Element {\n  return (\n    <>\n      <AboutContent />\n    </>\n  )\n}\n\n// for lazy loading:\n// const RoundButton = React.lazy<any>(() => import('../components/RoundButton')\n// <React.Suspense\n//   fallback={\n//     <div>loading...</div>\n//   }\n// >\n// </React.Suspense>\n","import React, { useState } from 'react'\nimport { RoundButton } from '../../general/RoundButton'\nimport styles from './P1RestoreOrBackup.module.css'\nimport { createNewWalletAction, changePageInfoAction } from '../../../store/actions/'\nimport sanitize from './../../../helpers/sanitize'\nimport { Store } from './../../../store/'\n\nenum pages {\n  ROOT,\n  NEW_WALLET,\n  LOAD_BACKUP\n}\n\n// restore backup or create new\nexport const P1RestoreOrBackup = () => {\n  const { state, dispatch } = React.useContext(Store) // global state\n  const [ page, setPage ] = useState(pages.ROOT) // local state\n  const [ backup, setBackup ] = useState('') // local state\n\n  // count non empty string strings separated by spaces\n  const wordCount = backup.split(' ').filter(v => v !== '').length\n\n  return (\n    <div className={ styles.wrapper }>\n\n      {/* ROOT PAGE */}\n      <div\n        style={{ display: page === pages.ROOT ? 'block' : 'none' }}\n      >\n        <div\n          className={ styles.title }\n        >\n          Need <span className={ styles.Orange }>BTC</span>\n          address to control<br />\n          the domain name\n        </div>\n        <div\n          className={ styles.buttonWrapper }\n        >\n          <RoundButton\n            show={ (state.wallet.mnemonic.length > 0) ? 'false' : 'true' }\n            onClick={() => {\n              setPage(pages.NEW_WALLET)\n              createNewWalletAction(state, dispatch)\n            }}\n          >\n            I need a new wallet\n          </RoundButton>\n          <RoundButton\n            show={ (state.wallet.mnemonic.length > 0) ? 'true' : 'false' }\n            onClick={() => {\n              setPage(pages.NEW_WALLET)\n            }}\n          >\n            Current backup\n          </RoundButton>\n          <RoundButton\n            onClick={() => {\n              setPage(pages.LOAD_BACKUP)\n            }}\n          >\n            Restore from backup\n          </RoundButton>\n          <RoundButton\n            show={ (!!state.wallet?.address).toString() }\n            onClick={() => {\n              changePageInfoAction(state, dispatch, 2)\n            }}\n            next='true'\n            colorbutton={'var(--colorHighlight)'}\n          >\n            Don't change wallet\n          </RoundButton>\n        </div>\n      </div>\n\n      {/* NEW_WALLET PAGE */ }\n\n      <div\n        className={ styles.contentWrapper }\n        style={{ display: page === pages.NEW_WALLET ? 'flex' : 'none' }}\n      >\n        <div className={ styles.describe }>\n          Randomly generated for domain control\n          <br /><br />\n          Backup this private phrase\n          or you will lose access\n        </div>\n        <div\n          id='divBackup'\n          spellCheck={ false }\n          className={ styles.backup }\n          onClick={ () => {\n            // select div entire contents\n            const thisDiv = document?.getElementById('divBackup')\n            if (thisDiv) {\n              window.getSelection()?.selectAllChildren(thisDiv)\n            }\n          }}\n        >\n          { state.wallet.mnemonic }\n        </div>\n        <div className={ styles.buttonWrapper } >\n          <RoundButton\n            onClick={() => {\n              setPage(pages.ROOT)\n            }}\n            back='true'\n          >\n            Back\n          </RoundButton>\n          <RoundButton\n            onClick={() => {\n              setPage(pages.NEW_WALLET)\n              createNewWalletAction(state, dispatch)\n            }}\n          >\n            New\n          </RoundButton>\n          <RoundButton\n            next='true'\n            onClick={() => {\n              changePageInfoAction(state, dispatch, 2)\n            }}\n          >\n            I'm done with backup\n          </RoundButton>\n        </div>\n      </div>\n\n      {/* LOAD_BACKUP PAGE */ }\n\n      <div\n        style={{ display: page === pages.LOAD_BACKUP ? 'block' : 'none' }}\n      >\n        <div className={ styles.title }>\n          Type or paste your backup here\n        </div>\n        <br></br>\n        <div>\n          { (wordCount).toString() + ' words now. 12 minimum.' }\n        </div>\n        <br></br>\n        <textarea\n          className={ styles.restoreBackup }\n          cols={ 30 }\n          rows={ 3 }\n          spellCheck={ false }\n          placeholder={ 'mnemonic backup' }\n          onChange={ e => {\n            // lowcaps, spaces, single space max, only one space on left while typing\n            const cleanString = sanitize(\n              e.target.value.toLowerCase(),\n              'lowcaps spaces single_space_width'.split(' ')\n            ).trimLeft()\n            setBackup(cleanString.trim()) // store without trailing space\n            e.target.value = cleanString // quick update\n          } }\n        ></textarea>\n        <div className={ styles.buttonWrapper } >\n          <RoundButton\n            onClick={() => {\n              setPage(pages.ROOT)\n            }}\n            back='true'\n          >\n            Back\n          </RoundButton>\n          <RoundButton\n            // 12 words minimum separated by spaces (TODO): proper checks\n            show={ (wordCount >= 12) ? 'true' : 'false' }\n            next='true'\n            onClick={() => {\n              createNewWalletAction(state, dispatch, backup)\n              changePageInfoAction(state, dispatch, 2)\n            }}\n          >\n            Done\n          </RoundButton>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n","import React, { useEffect, useState } from 'react'\nimport styles from './CreateHeader.module.css'\nimport { Store } from './../../../store/'\n\n// restore backup or create new\nexport const CreateHeader = () => {\n  const { state } = React.useContext(Store) // global state\n\n  // Make sure entire alias is always visible on top through\n  // resizing based on letter count.\n  //\n  // get window width in component instance state 'width'\n  // so can resize alias based on char count\n  const [ width, setWidth ] = useState(window.innerWidth)\n  useEffect(() => {\n    const resize = () => { setWidth(window.innerWidth) }\n    window.addEventListener('resize', resize);\n    return () => window.removeEventListener('resize', resize);\n  }, [])\n  const domainName = state.alias + state.extension\n  // enforces max size to font size so 1 letter alias has same font as 19 letter alias\n  const fontScale = Math.min(\n      Math.floor(1.3 * width / domainName.length),\n      Math.floor(1.3 * width / 20)\n  )\n\n  const barHeight = { height: (0.12 * width + 0.4 * fontScale).toString() + 'px' }\n  const aliasMarginTop = { marginTop: (0.03 * width - 0.3 * fontScale).toString() + 'px' }\n  const aliasFontSize = { fontSize: fontScale.toString() + 'px' }\n\n  return (\n    <>\n      <div\n        className={ styles.cutOverflow }\n        style={ barHeight }\n      >\n        <div\n          className={ styles.bar }\n          style={ barHeight }\n        />\n      </div>\n      <div\n        className={ styles.wrapper }\n        style={ aliasMarginTop }\n      >\n        <span\n          className={ styles.alias }\n          style={ aliasFontSize }\n        >{ state.alias }</span>\n        <span\n          className={ styles.ext }\n          style={ aliasFontSize }\n        >{ state.extension }</span>\n      </div>\n      <div className={ styles.spacer } />\n    </>\n  )\n}\n\n","import React, { useState, useEffect } from 'react'\nimport { RoundButton } from '../../general/RoundButton'\nimport styles from './P2LoadWallet.module.css'\nimport { Store } from '../../../store'\nimport { changePageInfoAction } from '../../../store/actions'\nimport qr from 'qrcode'\n\n/**\n * Load wallet page, including faucet link for testnet users\n */\nexport const P2LoadWallet = () => {\n  const { state, dispatch } = React.useContext(Store) // global state\n\n  // load QR code into local state\n  const [ qrCode, setQrCode] = useState()\n  useEffect(() => {\n    qr.toDataURL(state.wallet.address, { type: 'image/jpeg' }, (err: any, url: any) => {\n      if (!err) { setQrCode(url) }\n    })\n  }, [state.wallet.address])\n\n  return (\n    <div className={ styles.wrapper }>\n      <div className={ styles.contentWrapper }>\n        <div\n          className={ styles.imgQr }\n        >\n          {/* downloadable */}\n          <img src={qrCode} alt={'QR Code'} />\n        </div>\n        <div>\n          Fund your wallet to control domain.\n        </div>\n        <div className={ styles.address }>\n          { state.wallet.address }\n        </div>\n      </div>\n      <div className={ styles.buttonWrapper }>\n        <RoundButton\n          back='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 1)\n          }}\n        >\n          Back\n        </RoundButton>\n        <RoundButton\n          colorbutton={'var(--colorHighlight)'}\n          show={ (state.network === 'testnet').toString() }\n          onClick={ () => {\n            // open faucet page in new window\n            // segwit compatible:\n            // 1) https://testnet-faucet.mempool.co/\n            // 2) https://bitcoinfaucet.uo1.net/\n            window.open('https://bitcoinfaucet.uo1.net/', '_blank')\n            // window.open('https://testnet-faucet.mempool.co/', '_blank')\n          }}\n        >\n          Testnet: tBTC faucet\n        </RoundButton>\n        <RoundButton\n          onClick={ () => {\n            // open blockstream explorer for address in new window/tab\n            const pathEdit = (state.network === 'testnet') ? 'testnet/' : ''\n            window.open(\n              `https://blockstream.info/${pathEdit}address/${state.wallet.address}`\n            , '_blank')\n          }}\n        >\n          Open explorer\n        </RoundButton>\n        <RoundButton\n          next='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 3)\n          }}\n        >\n          Ready\n        </RoundButton>\n      </div>\n    </div>\n  )\n}\n\n","import React from 'react'\nimport { RoundButton } from '../../general/RoundButton'\nimport styles from './P3DomainAndWallet.module.css'\nimport { Store } from '../../../store'\nimport { changePageInfoAction } from '../../../store/actions'\nimport { scanAddressFullyAction } from './../../../store/actions'\nimport { ActionTypes } from './../../../interfaces'\nimport { getUnspentSum } from './../../../helpers/bitcoin'\n\n/**\n * Bid on network\n */\nexport const P3DomainAndWallet = () => {\n  const { state, dispatch } = React.useContext(Store) // global state\n\n  // Local state: keep track if API is busy\n  const [ apiStatus, setApiStatus ] = React.useState('ok')\n\n  // on state update detected by timestamp, reset api status\n  React.useEffect(() => { setApiStatus('ok') }, [ state.lastTimeStamp ])\n\n  // most important for domain notificaiton address is the transaction history to know ownership\n  // but also the current utxo in case we want to control the domain\n  const domainInfo = () => {\n    if (state.domain.checkedHistory && state.domain.checkedUtxo) {\n      return ('✓')\n    } else {\n      return ('needs scan')\n    }\n  }\n\n  // wallet needs utxo info including raw tx & tx history for nonce\n  const walletInfo = () => {\n    if (state.wallet.checkedHistory && state.wallet.checkedUtxo) {\n      return ( '✓' )\n    } else {\n      return ('needs scan')\n    }\n  }\n\n  // are all necessary scans done\n  const areScansDone = () => {\n    return (\n      state.wallet.checkedUtxo &&\n      state.wallet.checkedHistory &&\n      state.domain.checkedUtxo &&\n      state.domain.checkedHistory\n    )\n  }\n\n  // Conditions to enable next pages.\n  // if owner - full control\n  // if domain available - bid\n  // if not owner, warn user\n  // (TODO) if auction period, challenge bids\n  const readyStatus = () => {\n    if (!areScansDone()) {\n      // needs scans\n      return { isReady: false,  type: 'missing', info: 'Scan both to move on' }\n    }\n    const ownerAddress = state.domain.currentOwner;\n    const walletAddress = state.wallet.address;\n    const isWalletAddress = (walletAddress !== '')\n    const isDomainAvailable = (ownerAddress === '')\n    const isWalletTheOwner = (walletAddress === ownerAddress)\n    if (!isWalletAddress) {\n      return { isReady: false,  type: 'nowallet', info: 'No wallet loaded' }\n    }\n    if (isWalletTheOwner && !isDomainAvailable) {\n      return { isReady: true,   type: 'owner',    info: 'Your domain ready' }\n    }\n    if (!isWalletTheOwner && isDomainAvailable) {\n      return { isReady: true,   type: 'open',     info: 'Domain is available' }\n    }\n    if (!isWalletTheOwner && !isDomainAvailable) {\n      return { isReady: false,  type: 'taken',    info: 'Not your domain' }\n    }\n    console.log('Unknown status of ownership', ownerAddress, walletAddress, isWalletAddress, isDomainAvailable, isWalletTheOwner)\n    return { isReady: false,    type: 'unknown',  info: '' }\n  }\n\n  return (\n    <div className={ styles.wrapper }>\n      <div className={ styles.title }>\n        Wallet and domain history needed. <br />\n        (No offline method yet)\n      </div>\n      <div className={ styles.domainInfo }>\n        { (apiStatus !== 'domain')  && 'Domain ' + domainInfo() }\n        { (apiStatus === 'domain')  && 'Domain scanning...' }\n      </div>\n      <div className={ styles.domainButton }>\n        <RoundButton\n          onClick={ () => {\n            if (apiStatus === 'ok') {\n              setApiStatus('domain')\n              scanAddressFullyAction(state, dispatch, ActionTypes.UPDATE_DOMAIN)\n            }\n          }}\n        >\n          API Scan\n        </RoundButton>\n      </div>\n      <div className={ styles.walletInfo }>\n        { (apiStatus !== 'wallet')  && 'Wallet ' + walletInfo() }\n        { (apiStatus === 'wallet') && 'Wallet scanning...' }\n      </div>\n      <div className={ styles.walletButton }>\n        <RoundButton\n          onClick={ () => {\n            if (apiStatus === 'ok') {\n              setApiStatus('wallet')\n              scanAddressFullyAction(state, dispatch, ActionTypes.UPDATE_WALLET)\n            }\n          }}\n        >\n          API Scan\n        </RoundButton>\n      </div>\n      <div className={ styles.unspent }>\n        <div className={ styles.balance }>\n          { state.wallet.checkedUtxo? (getUnspentSum(state.wallet.utxoList) / 1e8).toFixed(8) : 'n/a' }\n        </div>\n        { (state.network === 'testnet') ? ' tBTC' : ' BTC' }\n      </div>\n      <div className={ styles.ownership }>\n        { readyStatus().info }\n      </div>\n      <div className={ styles.buttonWrapper }>\n        <RoundButton\n          back='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 2)\n          }}\n        >\n          Back\n        </RoundButton>\n        <RoundButton\n          show={ readyStatus().isReady ? 'true' : 'false' }\n          next='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 4)\n          }}\n        >\n          Ready\n        </RoundButton>\n      </div>\n    </div>\n  )\n}\n\n","import React from 'react'\nimport { RoundButton } from '../../general/RoundButton'\nimport styles from './P4ActionChoice.module.css'\nimport { Store } from '../../../store'\nimport { changePageInfoAction } from '../../../store/actions'\n\nimport { runAllActionPermissionChecks, calcBnsState } from './../../../helpers/bns/'\n\n\n/**\n * Bid on network\n */\nexport const P4ActionChoice = () => {\n  // global state\n  const { state, dispatch } = React.useContext(Store)\n\n\n  // simulate bns state once again just in case\n  // up to current block height\n  const bns = calcBnsState(\n    state.domain.txHistory,\n    state.domain.domainName,\n    state.chain.height,\n    state.network\n  )\n  // and get all permissions\n  const checkActions = runAllActionPermissionChecks(bns, state.wallet.address)\n\n  return (\n    <div className={ styles.wrapper }>\n      <div className={ styles.title }>\n        Available actions\n      </div>\n      <div className={ styles.availableActions }>\n        {\n          checkActions.map(action => {\n            if (action.isUsable) {\n              console.log('special tx instructions:', action.special)\n              return (\n              <RoundButton\n                next={ 'true' }\n                onClick={ () => {\n                  changePageInfoAction(state, dispatch, 5)\n                }}\n                key={ action.info }\n              >\n                { action.info }\n              </RoundButton>\n              )\n            } else {\n              return ''\n            }\n          })\n        }\n      </div>\n      <div className={ styles.unavailableActions }>\n        <div className={ styles.unavailableActions__title }>\n          Unavailable actions:\n        </div>\n        <div className={ styles.unavailableActions__actionList }>\n          {\n            checkActions.map(action => {\n              if (!action.isUsable) {\n                return (\n                  <div\n                    className={\n                      styles.unavailableActions__actionList__action\n                    }\n                    key={ action.info }\n                  >\n                    <div\n                      className={\n                        styles.unavailableActions__actionList__action__title\n                      }\n                    >\n                      { action.info }\n                    </div>\n                    <div\n                      className={\n                        styles.unavailableActions__actionList__action__permissionList\n                      }\n                    >\n                      { action.permissionList.map((permission: any) => {\n                        return (\n                          <div\n                            className={\n                              styles.unavailableActions__actionList__action__permissionList__permission\n                            }\n                            key={permission.info}\n                          >\n                            - { permission.info }\n                          </div>\n                        )\n                      })}\n                    </div>\n                  </div>\n                )\n              } else {\n                return ('')\n              }\n            })\n          }\n        </div>\n      </div>\n      <div className={ styles.buttonWrapper }>\n        <RoundButton\n          back='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 3)\n          }}\n        >\n          Back\n        </RoundButton>\n      </div>\n    </div>\n  )\n}","import React, { useEffect } from 'react'\nimport { RoundButton } from '../../general/RoundButton'\nimport styles from './P5CustomForwards.module.css'\nimport { Store, getOwner } from '../../../store'\nimport { changePageInfoAction } from '../../../store/actions'\nimport { calcBidDomainTx, stringByteCount, BYTES_MAX } from '../../../helpers/bns'\nimport sanitize from '../../../helpers/sanitize'\n\n/**\n * Bid on network\n */\nexport const P5CustomForwards = () => {\n  // global state\n  const { state, dispatch } = React.useContext(Store)\n\n  // array of network:forwardingAddress objects\n  const forwards = getOwner(state)?.forwards.slice().reverse() || []\n\n  // local state for plannedChanges to embed (content inside textboxes for network/address)\n  const [customAdd, setCustomAdd] = React.useState({network: '', address: '' })\n\n  // local state for all plannedChanges to embed in this tx\n  const initialPlannedChanges = {}\n  const [plannedChanges, setPlannedChanges] = React.useState(\n    initialPlannedChanges as { [key: string]: string }\n  )\n\n  // local state for tx hex\n  const [tx, setTx] = React.useState({ hex: '', txid: '' })\n\n  // combine forwards into a string for the tx\n  const combineForwards = (objForwards: any) => {\n    let forwardsString = ''\n    Object.keys(objForwards).forEach(fwNetwork => {\n      forwardsString += fwNetwork + ' ' + objForwards[fwNetwork] + ' '\n    })\n    if (forwardsString.length > 0) { forwardsString = forwardsString.slice(0, -1) }\n    console.log('string to embed:', '\"' + forwardsString + '\"')\n    return forwardsString\n  }\n\n  // calculate tx (on mount or changes in global state or local plannedChanges to embed)\n  useEffect(() => {\n    try { // to make tx\n      setTx(\n        calcBidDomainTx(\n          combineForwards(plannedChanges),\n          state.wallet,\n          state.domain,\n          state.settings.feeRate,\n          state.network\n        )\n      )\n    } catch (e) {\n      // tx creation expected to fail often\n    }\n  }, [state, plannedChanges])\n\n  console.log('tx attempt info', tx)\n\n  const bytesOfChanges = stringByteCount(combineForwards(plannedChanges))\n  console.log(bytesOfChanges)\n\n  return (\n    <div className={ styles.wrapper }>\n      <div className={ styles.title }>\n        Update forwarding information\n      </div>\n      <div className={ styles.changes }>\n        {/* bytes info */ }\n        { (Object.keys(plannedChanges).length === 0) && 'Nothing added yet' }\n        { (bytesOfChanges <= BYTES_MAX) &&\n          <div className={ styles.bytesLeft }>\n            { BYTES_MAX - bytesOfChanges } Bytes left\n          </div>\n        }\n        { (bytesOfChanges > BYTES_MAX) &&\n          <div className={ styles.bytesOver }>\n            Too much by { bytesOfChanges - BYTES_MAX } Bytes\n          </div>\n        }\n        { Object.keys(plannedChanges).map((fwNetwork) => {\n          return (\n            <div\n              className={ styles.updateItem }\n              key={ fwNetwork }\n              onClick={ () => {\n                setCustomAdd({ network: fwNetwork, address: plannedChanges[fwNetwork] })\n              } }\n            >\n              <div\n                className={ styles.updateInfo }\n              >\n                {\n                  (plannedChanges[fwNetwork] !== '')\n                    ? (<>\n                      Updating forwarding on <span>{ ' ' + fwNetwork + ' ' }</span>\n                      network to address of <span>{ ' ' + plannedChanges[fwNetwork] + ' ' }</span>\n                      <i>{' '}(+{ stringByteCount(fwNetwork + ' ' + plannedChanges[fwNetwork]) }B)</i>\n                    </>)\n                    : (<>\n                      Deleting previously set forwarding information for\n                      <span>{ ' ' + fwNetwork + ' '}</span> network\n                      <i>{' '}(+{ stringByteCount(fwNetwork + ' ' + plannedChanges[fwNetwork]) }B)</i>\n                    </>)\n                }\n              </div>\n              <div\n                className={ ['btnCircle', styles.updateCancel, 'addTooltipRight'].join(' ') }\n                onClick={ (e) => {\n                  const newData = { ...plannedChanges }\n                  delete newData[fwNetwork]\n                  setPlannedChanges(newData)\n                  e.stopPropagation()\n                } }\n              >\n                <span>×</span>\n                <aside>Remove from planned changes</aside>\n              </div>\n            </div>\n          )\n        }) }\n      </div>\n      <div className={ styles.editor } >\n        { (customAdd.network.length > 0) && <div\n          className={ [styles.btnDelete, 'canPress'].join(' ') }\n          onClick={ () => {\n            setPlannedChanges({\n              ...plannedChanges,\n              [customAdd.network]: ''\n            })\n            setCustomAdd({ network: '', address: '' })\n          } }\n        >\n            No address\n        </div> }\n        <textarea\n          spellCheck={ false }\n          value={ customAdd.network }\n          className={ styles.editorNetwork }\n          placeholder={ 'network' }\n          onChange={ (e) => {\n            const cleanText = sanitize(e.target.value, 'oneline')\n            setCustomAdd({ ...customAdd, network: cleanText })\n            e.target.value = cleanText\n          } }\n        ></textarea>\n        <textarea\n          spellCheck={ false }\n          value={ customAdd.address }\n          className={ styles.editorAddress }\n          placeholder={ 'address on network' }\n          onChange={ (e) => {\n            const cleanText = sanitize(e.target.value, 'oneline')\n            setCustomAdd({ ...customAdd, address: e.target.value })\n            e.target.value = cleanText\n          } }\n        ></textarea>\n        <div\n          className={ ['btnCircle', styles.btnAdd, 'canPress', 'addTooltip'].join(' ') }\n          onClick={ () => {\n            setPlannedChanges({\n              ...plannedChanges,\n              [customAdd.network]: customAdd.address\n            })\n            setCustomAdd({ network: '', address: '' })\n          } }\n        >\n          <span>+</span>\n          <aside>Add to planned changes</aside>\n        </div>\n      </div>\n      <div className={ styles.pastList } >\n        { forwards.map((fw: any, i: number) => {\n          return (\n            <div\n              className={ styles.pastPair }\n              key={ i }\n              onClick={ () => {\n                setCustomAdd({ network: fw.network, address: fw.address })\n              } }\n            >\n              <div className={ styles.pastNetwork } >\n                { fw.network }\n              </div>\n              <div className={ styles.pastAddress } >\n                { fw.address }\n              </div>\n            </div>\n          )\n        }) }\n      </div>\n      <div className={ styles.buttonWrapper }>\n        <RoundButton\n          back='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 4)\n          }}\n        >\n          Back\n        </RoundButton>\n        <RoundButton\n          next='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 6)\n          }}\n        >\n          Ready\n        </RoundButton>\n      </div>\n    </div>\n  )\n}\n\n","import React from 'react'\nimport { Store } from '../../../store'\nimport { RoundButton } from '../../general/RoundButton'\nimport styles from './P6Broadcast.module.css'\nimport { changePageInfoAction } from '../../../store/actions'\n\n/**\n * Broadcast tx page.\n * Fee selection.\n * Transaction summary/status. *\n */\nexport const P6Broadcast = () => {\n  // global state\n  const { state, dispatch } = React.useContext(Store)\n\n  return (\n    <div className={ styles.wrapper }>\n      <div className={ styles.title }>\n        Decide fee rate to broadcast\n      </div>\n      <div className={ styles.feeSelection }>\n        <div className={ styles.Rate }>\n          Fee 1.1 sat/vByte\n        </div>\n        <div className={ styles.usdAPI }>\n          get USD estimates\n        </div>\n        <div className={ styles.feeAPI }>\n          get fee estimates\n        </div>\n      </div>\n      <div className={ styles.txSummary }>\n        tx stats or tx fail\n      </div>\n      <div className={ styles.buttonWrapper }>\n        <RoundButton>\n          Broadcast (TODO)\n        </RoundButton>\n        <RoundButton\n          onClick={ () => changePageInfoAction(state, dispatch, 4)\n          }\n        >\n          Back\n        </RoundButton>\n      </div>\n\n    </div>\n  )\n}","import React from 'react'\nimport { Store } from './../../store/'\nimport { P1RestoreOrBackup } from '../CreateSteps/P1RestoreOrBackup'\nimport { P2LoadWallet } from '../CreateSteps/P2LoadWallet'\nimport { P3DomainAndWallet } from '../CreateSteps/P3DomainAndWallet'\nimport { P4ActionChoice } from '../CreateSteps/P4ActionChoice'\nimport { P5CustomForwards } from '../CreateSteps/P5CustomForwards'\nimport { P6Broadcast } from './../CreateSteps/P6Broadcast'\nimport styles from './CreateNavigator.module.css'\n\n/**\n * Handle navigation of alias manipulation\n */\nexport const CreateNavigator = () => {\n  // global state\n  const { state } = React.useContext(Store)\n\n  const page = state.pageInfo?.current\n\n  !page && console.log('Unknown Page')\n\n  return (\n    <div className={ [styles.wrapper, 'scrollbar'].join(' ') }>\n      <div className={ styles.horizontalScaler } >\n        { (page === 1) && <P1RestoreOrBackup /> }\n        { (page === 2) && <P2LoadWallet /> }\n        { (page === 3) && <P3DomainAndWallet /> }\n        { (page === 4) && <P4ActionChoice /> }\n        { (page === 5) && <P5CustomForwards /> }\n        { (page === 6) && <P6Broadcast /> }\n      </div>\n    </div>\n  )\n}\n","import React from 'react'\nimport { CreateHeader } from './../components/CreateSteps/CreateHeader'\nimport { CreateNavigator } from './../components/CreateNavigator'\n\n/**\n * Combine header & body components for alias manipulation\n */\nexport default function Create () {\n  return (\n    <>\n      <CreateHeader />\n      <CreateNavigator />\n    </>\n  )\n}\n","import React from 'react'\nimport { Link } from 'react-router-dom'\nimport styles from './Navbar.module.css'\n\nexport const Navbar = (): JSX.Element => {\n  return (\n    <>\n      <div\n        className={ styles.warning }\n      >\n        FOR TESTING, DO NOT USE\n      </div>\n      <div\n        className={ styles.root }\n      >\n        <a\n          href=\"https://github.com/ildarmgt/BitcoinNameSystem\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          { 'source' }\n        </a>\n        <Link to='/about'>about</Link>\n        <Link to='/create'>owners</Link>\n        <Link to='/'>search</Link>\n      </div>\n    </>\n  )\n}\n\n// Hash history cannot PUSH the same path; a new entry will not be added to the history stack\n// Only issue is the warning in console, but that only exists in development mode so can be ignored.","import React from 'react';\nimport { Route, Switch } from 'react-router-dom'\nimport Home from './pages/Home'\nimport About from './pages/About'\nimport Create from './pages/Create'\nimport { Navbar } from './components/Navbar'\n\n// using for routing\nconst App = (): JSX.Element => {\n  // onbtc.me?satoshi can now forward to onbtc.me/#/id/satoshi which resets to onbtc.me after search\n  // redirect to auto searching path routed in return and remove query from url\n  const searchParam = (new URLSearchParams(window.location.search)).keys().next().value\n  searchParam && console.log('search param detected after ?', searchParam)\n  // no forward slash before # in string is vital\n  searchParam && window.history.pushState({}, '', window.location.pathname + '#/id/' + searchParam)\n\n  return (\n    <>\n      {/* switch only renders first match instead of all matches */}\n      <Switch>\n        <Route path='/id/:alias' component={Home} />\n        <Route exact path='/id/' component={Home} />\n        <Route path=\"/about\" component={About} />\n        <Route path=\"/create\" component={Create} />\n        <Route path='/:noise' component={Home} />\n        <Route exact path='/' component={Home} />\n      </Switch>\n      <Navbar />\n      {/* <Route exact path=\"/\" render={() => <Home />} /> */}\n    </>\n  );\n}\nexport default App;\n","import React, { useState, useEffect } from 'react'\nimport styles from './DevPanel.module.css'\nimport { Store } from '../../store/'\nimport { ActionTypes } from './../../interfaces/'\nconst json = require('./../../utils/test.json');\n\ninterface IState {\n  blShow: boolean\n  setShow: React.Dispatch<React.SetStateAction<boolean>>\n}\n\nexport const DevPanel = (props: any): JSX.Element => {\n  const { state, dispatch } = React.useContext(Store) // global state\n\n  // store if DevPanel is hidden\n  const [hidden, setHidden] = useState<boolean>(false);\n\n  // reruns to reattach keyup event to toggle hidden class\n  useEffect(() => {\n    const onDevKey = (e: any) => {\n      if (e.key === '`') {\n        setHidden(!hidden)\n      } else {\n        // give focus back to the input bar\n        if (document.activeElement?.id !== 'txtSearch') {\n          const txtSearch = document.getElementById('txtSearch') as HTMLTextAreaElement\n          txtSearch?.focus()\n        }\n      }\n    }\n    document.addEventListener('keyup', onDevKey)\n    return () => {\n      document.removeEventListener('keyup', onDevKey)\n    }\n  }, [hidden])\n\n  const onOutlineClick = () => {\n    const id: string = 'outliner';\n    const sheet: HTMLElement | null = document.getElementById(id);\n    if (!sheet) {\n      const outlineCss = '* {box-shadow: 0 0 0 1px red;}'\n      const style = document.createElement('style')\n      style.type = 'text/css'\n      style.id = id\n      style.appendChild(document.createTextNode(outlineCss))\n      document.head.appendChild(style)\n    } else {\n      sheet.parentNode?.removeChild(sheet)\n    }\n  }\n\n  const dlState = () => {\n    let data = \"text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(state))\n    let a = document.createElement('a')\n    a.href = 'data:' + data\n    a.download = 'test.json'\n    a.innerHTML = 'download JSON'\n    let container = document.getElementById('container')\n    container?.appendChild(a)\n    a.click()\n    a.remove()\n  }\n\n  return (\n    <div\n      className={[\n        styles.divDev,\n        !hidden ? styles.hidden : ''\n      ].join(' ')}\n      { ...props }\n    >\n      <div><b>DevPanel</b></div>\n      <div\n        className={ styles.button }\n        onClick={ () => {\n          dlState()\n        } }\n      >\n        Save State\n      </div>\n      <div\n        className={ [styles.btnOutline, styles.button].join(' ') }\n        onClick={ onOutlineClick }\n      >\n        Outline\n      </div>\n      <div\n        className={ styles.button }\n        onClick={ () => {\n          console.log(json);\n          dispatch({ type: ActionTypes.LOAD_STATE, payload: json });\n        } }\n      >\n        Load State\n      </div>\n      <div\n        className={ styles.button }\n        onClick={ () => {\n          console.log(state);\n        } }\n      >\n        Console State\n      </div>\n    </div>\n  )\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { HashRouter } from 'react-router-dom';\nimport './css/global.css';\nimport App from './App';\nimport { StoreProvider } from './store'\nimport { DevPanel } from './components/DevPanel'\n\n// Using for store access and hash router base\nReactDOM.render(\n  <StoreProvider>\n    <HashRouter>\n      <App />\n    </HashRouter>\n    <DevPanel />\n  </StoreProvider>,\n  document.getElementById('root')\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.register();\n// import * as serviceWorker from './serviceWorker';","import crypto from 'crypto'\n\n/**\n * Encrypt - symmetric - aes-256-crt\n * @param   {string}  stringText      To be encrypted (up to 80 bytes)\n * @param   {string}  stringForKey    Derive Key from (not final Key).\n * @param   {string}  stringForIV     Derive IV from (not final IV). Defaults as stringForKey.\n * @returns {Buffer}                  Buffer to embed in tx.\n */\nexport const encrypt = (\n  stringText: string, stringForKey: string, stringForIV: string = stringForKey\n) => {\n  // aes-NUMBER-TYPE\n  // Must have key size matching NUMBER (in aes name) of bits (NUMBER/8 bytes)\n  // Must have IV matching encryption block size, 16 bytes for AES128-to-256-range in cbc mode\n  // sha256 can make 32 byte buffer out of anything and then .slice(0, N) can cut it to N bytes\n\n  const key = crypto.createHash('sha256').update(stringForKey).digest()             // 32 bytes\n  const iv = crypto.createHash('sha256').update(stringForIV).digest().slice(0, 16)  // 16 bytes\n\n  let cipher = crypto.createCipheriv('aes-256-ctr', key, iv)\n  let encrypted = cipher.update(Buffer.from(stringText))\n\n  encrypted = Buffer.concat([encrypted, cipher.final()])\n\n  return encrypted\n}\n\n /**\n * Decrypt - symmetric - aes-256-crt\n * @param   {Buffer}  stringText      Buffer to be decrypted.\n * @param   {string}  stringForKey    Derive Key from (not final Key).\n * @param   {string}  stringForIV     Derive IV from (not final IV). Defaults as stringForKey.\n * @returns {Buffer}                  Buffer to utf8 embeded in tx.\n */\nexport const decrypt = (\n  bufferCypher: Buffer, stringForKey: string, stringForIV: string = stringForKey\n) => {\n\n  const key = crypto.createHash('sha256').update(stringForKey).digest()             // 32 bytes\n  const iv = crypto.createHash('sha256').update(stringForIV).digest().slice(0, 16)  // 16 bytes\n\n  let decipher = crypto.createDecipheriv('aes-256-ctr', key, iv)\n\n  // first part\n  let decrypted = decipher.update(bufferCypher)\n\n  // the rest\n  decrypted = Buffer.concat([decrypted, decipher.final()])\n\n  return decrypted.toString('utf8')\n}\n\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"divDev\":\"DevPanel_divDev__2q66m\",\"hidden\":\"DevPanel_hidden__Wlj3v\",\"btnOutline\":\"DevPanel_btnOutline__2FJLx\",\"button\":\"DevPanel_button__1DKHt\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"cutOverflow\":\"CreateHeader_cutOverflow__3s_72\",\"bar\":\"CreateHeader_bar__27ge1\",\"wrapper\":\"CreateHeader_wrapper__3cPTN\",\"alias\":\"CreateHeader_alias__1dNdj\",\"ext\":\"CreateHeader_ext__17sc6\",\"spacer\":\"CreateHeader_spacer__3tstm\"};","import * as bitcoin from 'bitcoinjs-lib'\nconst op = bitcoin.opcodes;\nconst hash160 = bitcoin.crypto.hash160;\n\n\n/**\n * Get p2wsh notificaiton address from domainName and network.\n * @param   {string} domainName         - full domainName to use (e.g. 'satoshi.btc').\n * @param   {string} networkChoice      - 'testnet' or 'bitcoin' (matches bitcoinjs-lib).\n * @returns {object}                    - { notificationsAddress - p2wsh address derived from domainName }.\n */\nexport const calcP2WSH = (domainName: string, networkChoice: string) => {\n  const network = bitcoin.networks[networkChoice];\n\n  // convert domainName into buffer so it can be put into script\n  const bufferData = Buffer.from(domainName, 'utf8');\n\n  // easily spendable script for ACS notification output\n  // specific to this domainName\n  const witnessScript = bitcoin.script.compile([\n    hash160(bufferData),\n    op.OP_DROP\n  ]);\n\n  // calculate p2wsh address for this witnessScript & network\n  const p2wsh = bitcoin.payments.p2wsh({\n    redeem: {\n      output: witnessScript,\n      network\n    },\n    network\n  })\n  const notificationsAddress = p2wsh.address;\n\n  return {\n    notificationsAddress\n  };\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P2LoadWallet_wrapper__vI_bb\",\"contentWrapper\":\"P2LoadWallet_contentWrapper__UNLo4\",\"buttonWrapper\":\"P2LoadWallet_buttonWrapper__1rrct\",\"address\":\"P2LoadWallet_address__37xx2\",\"imgQr\":\"P2LoadWallet_imgQr__3Avh3\"};","import { IUser, IBnsState } from './types/'\n\n// Initializing values\n\nexport const newState: IBnsState = {\n  domain: {                                     // notification info for this domain name\n    domainName:                   '',           // domain name\n    notificationAddress:          '',           // p2wsh address for this domain name (alias + extension)\n    txHistory:                    [],           // array of all tx for this address (old addressHistory)\n    utxoList:                     [],           // array of all current utxo for this address\n    users:                        {},           // keeps track of interacting users / source addresses with addresses as keys\n    currentOwner:                 '',           // points to a source address or blank string\n    bidding:                      {},           // bidding\n    ownersHistory:                []            // owner history log\n  },\n  chain: {\n    parsedHeight:                 0,            // parsed height for derivation\n    currentHeight:                0             // real world block height\n  }\n}\n\n// values to initialize users with\nexport const newUser: IUser = {\n  address:        '',           // address in control\n  forwards:       [],           // for forwards later\n  burnAmount:     0,            // burned to get ownership\n  winHeight:      0,            // blockheight winning bid\n  winTimestamp:   0,            // winHeight in block's timestamp\n  nonce:          0,            // for counting previous notification height from this address, no matter good/bad/type\n  updateHeight:   0             // the height of most current parsed update, created after nonce height & therefore using it\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"roundButtonWrap\":\"RoundButton_roundButtonWrap__2X50a\",\"roundButton\":\"RoundButton_roundButton__tfjmf\",\"nextArrow\":\"RoundButton_nextArrow__SS6Nl\",\"backArrow\":\"RoundButton_backArrow__2MJJm\"};"],"sourceRoot":""}