{"version":3,"sources":["helpers/bns/constants.tsx","helpers/bns/deterministicRandom.tsx","components/CreateNavigator/CreateNavigator.module.css","components/general/Logo/Logo.module.css","components/general/LogoBackground/LogoBackground.module.css","components/CreateSteps/P5CustomForwards/P5CustomForwards.module.css","components/Navbar/Navbar.module.css","components/SearchResults/SearchResults.module.css","helpers/bns/calcTx.tsx","helpers/bns/ecies.tsx","helpers/bns/types/types.tsx","helpers/bns/types/index.js","components/AboutContent/graphic.png","helpers/bns/formathelpers.tsx","components/CreateSteps/P1RestoreOrBackup/P1RestoreOrBackup.module.css","components/CreateSteps/P4ActionChoice/P4ActionChoice.module.css","components/CreateSteps/P2LoadWallet/P2LoadWallet.module.css","components/CreateSteps/P6Broadcast/P6Broadcast.module.css","helpers/bns/bitcoin.tsx","components/CreateSteps/P3DomainAndWallet/P3DomainAndWallet.module.css","components/HomeContent/HomeContent.module.css","components/DevPanel/DevPanel.module.css","components/AboutContent/AboutContent.tsx","pages/About.tsx","interfaces/index.tsx","store/reducers/Reducer.tsx","store/initialState.tsx","store/state.tsx","store/helpers.tsx","components/CreateSteps/CreateHeader/CreateHeader.tsx","components/general/RoundButton/RoundButton.tsx","helpers/sanitize.js","store/actions/changeAliasAction.tsx","helpers/bns/forwards/interpretFw.tsx","helpers/bns/actions/actions.tsx","helpers/bns/actions/batch.tsx","helpers/bns/calcBnsState.tsx","helpers/bns/forwards/findLatestForwards.tsx","helpers/bns/forwards/interpretCommand.tsx","helpers/bns/stringByteCount.tsx","helpers/bns/actionhelpers.tsx","api/blockstream.tsx","components/CreateSteps/P1RestoreOrBackup/P1RestoreOrBackup.tsx","store/actions/searchAction.tsx","store/actions/createNewWalletAction.tsx","store/actions/changePageInfoAction.tsx","store/actions/scanAddressFullyAction.tsx","store/actions/changeChoicesBNSAction.tsx","components/general/Details/Details.tsx","components/CreateSteps/P2LoadWallet/P2LoadWallet.tsx","components/CreateSteps/P3DomainAndWallet/P3DomainAndWallet.tsx","components/general/InputForm/InputForm.tsx","components/general/Switch/Switch.tsx","components/CreateSteps/P4ActionChoice/P4ActionChoice.tsx","components/CreateSteps/P5CustomForwards/P5CustomForwards.tsx","components/wallet/FeesSelection/FeesSelection.tsx","components/CreateSteps/P6Broadcast/P6Broadcast.tsx","components/CreateNavigator/CreateNavigator.tsx","pages/Create.tsx","helpers/timediff.tsx","components/SearchResults/SearchResults.tsx","components/HomeContent/HomeContent.tsx","pages/Home.tsx","pages/Settings.tsx","components/general/Logo/Logo.tsx","components/general/LogoBackground/LogoBackground.tsx","components/wallet/Withdraw/Withdraw.tsx","pages/Wallet.tsx","components/wallet/Wallet/Wallet.tsx","components/Navbar/Navbar.tsx","App.tsx","components/DevPanel/DevPanel.tsx","index.tsx","components/general/RoundButton/RoundButton.module.css","helpers/bns/cryptography.tsx","helpers/bns/initialState.tsx","components/CreateSteps/CreateHeader/CreateHeader.module.css","components/general/InputForm/InputForm.module.css","components/wallet/FeesSelection/FeesSelection.module.css","components/general/Details/Details.module.css","components/general/Switch/Switch.module.css","components/wallet/Withdraw/Withdraw.module.css","helpers/bns/calcP2WSH.tsx","components/AboutContent/AboutContent.module.css"],"names":["BYTES_MAX","MIN_BURN","MIN_NOTIFY","OWNERSHIP_DURATION_BY_BLOCKS","CHALLENGE_PERIOD_DURATION_BY_BLOCKS","CHALLENGE_MIN_MULTIPLY","EARLIEST_NOTIFICATION_HEIGHT","deterministicRandomBid","bidArray","undefined","length","maxRange","ranges","map","thisBid","thisRange","min","max","value","weight","bid","blockHash","some","console","warn","rangedHashBigInt","BigInt","i","module","exports","hash160","bitcoin","op","calcTx","wallet","domain","choices","networkChoice","vBytes","utxoList","Error","feeRate","network","calcP2WSH","domainName","notificationsAddress","fee","Math","ceil","burnAmounts","action","suggestions","reduce","allBurnAmounts","thisSuggestion","burnAmountsHere","info","set","name","get","parseInt","burnAmount","refundsAmount","refundAmountsArray","refundAmounts","type","BnsSuggestionType","REFUND_BIDDERS","refunds","split","thisAmountAndAddress","thisAddress","thisAmount","address","amount","valueNeeded","totalGathered","gatheredFromWallet","gatheredFromOther","toBeUsedUtxoOfNotifications","derivedUtxoList","forEach","utxo","from_scriptpubkey_address","push","toBeUsedUtxoOfUserWallet","toFixed","keyPair","fromWIF","WIF","psbt","setVersion","setLocktime","addInput","hash","txid","index","vout","sequence","nonWitnessUtxo","Buffer","from","hex","witnessScript","compile","OP_DROP","inputScript","OP_TRUE","nonce","getNonce","toString","encryptionKey","log","finalEmbedString","embedString","data","encrypt","embed","addOutput","script","output","changeAddress","find","suggestion","change","thisRefund","signInput","validateSignaturesOfInput","finalizeInput","getFinalScripts","tx","extractTransaction","thisVirtualSize","virtualSize","getId","toHex","nInputs","ins","nOutputs","outs","byteLength","notifyAmount","nInputsFromWallet","nInputsFromOther","BnsActionType","BnsBidType","existsCurrentOwner","st","currentOwner","existsUser","users","createNewUser","JSON","parse","stringify","newUser","getOwnerAddress","setOwner","newOwnerAddress","getUser","getOwner","ownerAddress","updateOwnerHistory","ownersHistory","clearOwner","getParsedHeight","chain","parsedHeight","setParsedHeight","height","getNotificationAddress","notificationAddress","getLastOwnerBurnedValue","isOwnerExpired","owner","winHeight","getTxTimestamp","status","block_time","getTxHeight","block_height","getTxOutput0BurnValue","getTxInput0SourceUserAddress","vin","prevout","scriptpubkey_address","updateSourceUserFromTx","fromAddress","user","updateHeight","readEmbeddedData","isOpreturnOutput0","embeddedDataHex","scriptpubkey_asm","slice","join","getTxOutput0Data","embeddedDataBuffer","decryptionKey","embeddedDataUtf8Array","decrypt","forwardsInThisTx","word","networkPiece","forwardingAddressPiece","thisForward","encodeURIComponent","updateTimestamp","forwards","addToUserForwards","atLeastTwoOutputs","isNotify","getTxOutput1NotifyAddress","didNotifyMin","getTxOutput1NotifyValue","isAddressTheCurrentOwner","isSenderTheCurrentOwner","didBurnMin","burnedPreviousRateMin","isCommandCalled","command","getCommandCalled","txHeight","startsWith","updateUtxoFromTx","input","spentUtxoIndex","findIndex","splice","noUnspentUserNotificationsUtxo","userOfTxAddress","userThatCreatedThisUtxo","isInThePast","resetBidding","bidding","newState","addBid","userAddress","burnValue","endHeight","startHeight","startBidding","bids","timestamp","valueLeftToRefund","block_hash","isBiddingOver","biddingType","NULL","isBiddingOngoing","isAddressACurrentBidder","isSenderACurrentBidder","subtractRefunds","txUserAddress","paidTo","toAddress","toAmount","thisBidAddress","assert","refund","unrefundedBidsOnly","filter","unrefundedAmounts","refundsLeft","endBidding","unrefundedBids","goodBidsThatRefunded","thisBidHeight","thisUnrefundedBid","winner","validBidsAtLastHeight","lastHeight","maxBidIndex","bidIndex","thisHeight","winTimestamp","varuint","require","createNewWallet","strNetwork","mnemonic","bip39","generateMnemonic","seedBuffer","mnemonicToSeed","fromSeed","derivePath","toWIF","p2wpkh","pubkey","publicKey","loadWallet","strMnemonic","getUnspentSum","utxoArray","sum","inputIndex","isSegwit","isP2SH","isP2WSH","payment","p2wsh","redeem","p2sh","finalScriptSig","finalScriptWitness","witness","vector","buffer","allocUnsafe","writeVarInt","currentLen","varintLen","encodingLength","concat","encode","writeVarSlice","writeSlice","witnessStackToScriptWitness","AboutContent","className","styles","wrapper","title","contentWrapper","drawing","src","image","alt","href","target","rel","About","ActionTypes","STORE_SEARCH_RESULTS_FAIL","STORE_SEARCH_RESULTS","TYPING","NEW_WALLET","CHANGE_PAGE_INFO","UPDATE_WALLET","UPDATE_DOMAIN","ACTION_FAIL","LOAD_STATE","CHOICES_BNS_ACTION","reducer","state","payload","lastTimeStamp","Date","now","txHistory","pageInfo","checkedWallet","checkedDomain","current","initialState","alias","checkedLightSearch","extension","apiPath","testnet","txHex","Store","React","createContext","unitsBTC","satsToBTCSpaced","sats","styling","CreateHeader","useContext","history","useHistory","useState","window","innerWidth","width","setWidth","useEffect","resize","addEventListener","removeEventListener","fontScale","floor","barHeight","aliasMarginTop","marginTop","aliasFontSize","fontSize","cutOverflow","style","bar","onClick","ext","spacer","RoundButton","props","display","show","colorbutton","colorbuttontext","sizebutton","roundButtonWrap","back","roundButton","backArrowPad","next","nextArrowPad","backArrow","children","nextArrow","overhead","sanitize","inputString","stringOrArray","Array","isArray","logicFilters","choice","str","letter","resultingString","numbers","digits","warning","outputString","indexOf","fn","interpretFw","fw","blockchain","render","onNetwork","where","what","link","OUTS_2","describe","OUT_0","OUT_1","NOTIFIED_MIN","units","BURNED_MIN","NO_OWNER","EXISTS_OWNER","BURN_LAST_WIN","USER_IS_OWNER","IS_OWNER_EXPIRED","NO_UNSPENT_USER_NOTIFICATIONS_UTXO","USER_ADDRESS_NOT_NOTIFICATION_ADDRESS","IS_COMMAND_CALLED","IS_BIDDING_OVER","SUGGESTION_SUBMIT_NEW_ADDRESS","SUGGESTION_SUBMIT_NEW_OWNER_ADDRESS","SUGGESTION_SUBMIT_BURN_AMOUNT","calcMin","SUGGESTION_REFUND_PAST_BIDDERS","ignoreAddress","leftAmounts","WARNING_POINTLESS_IF_NOT_OWNER","args","bidForOwnershipAction","BID_FOR_OWNERSHIP","permissions","conditions","execute","BURN","permission","condition","changeAddressAction","CHANGE_ADDRESS","thisCommand","newAddress","oldOwner","sendOwnershipAction","SEND_OWNERSHIP","currentOwnerRenewAction","RENEW","updateForwardingInfoAction","ONLY_FORWARDS","autoCheckForOwnerExpiredAction","updateUtxoFromTxAction","autoCheckForBiddingWinnerNewOwnerAction","runAllAutomaticActions","areAllConditionsMet","eaCondition","calcBnsState","notificationsHistory","currentHeight","reverse","sort","prev","actions","okConditions","okPermissions","areAllPermissionsMet","eaPermission","findLatestForwards","sortedForwards","currentNetworks","eaForward","isNotCommand","isNotEmptyNetwork","Object","values","interpretCommand","key","allActions","getterName","stringByteCount","getSetters","getFeeEstimatesAPI","path","a","async","API_PATH","axios","res","rateLimit","getHeightAPI","addRawTxToArrayAPI","erroredOutputs","error","entries","indexString","tries","getUTXOListAPI","confirmed","getAddressHistoryAPI","txPushAPI","content","params","response","Promise","r","setTimeout","pages","searchAction","dispatch","router","notificationsTxHistory","createNewWalletAction","changePageInfoAction","page","scanAddressFullyAction","addressType","walletAddress","walletTxHistory","utxoListWalletAddress","newDomain","changeChoicesBNSAction","Details","showDetails","setShowDetails","buttonWrapper","toggleDetails","description","arrow","down","details","P1RestoreOrBackup","ROOT","setPage","backup","setBackup","wordCount","v","orange","LOAD_BACKUP","id","spellCheck","restoreBackup","cols","rows","placeholder","onChange","e","cleanString","toLowerCase","trimLeft","trim","P2LoadWallet","qrCode","setQrCode","qr","toDataURL","color","dark","err","url","imgQr","backAndReady","button","open","pathEdit","P3DomainAndWallet","apiStatus","setApiStatus","readyStatus","isReady","domainInfo","domainButton","walletInfo","walletButton","unspent","balance","ownership","InputForm","textValue","setTextValue","thisInputOnChange","thisInitialValue","shiftRight","label","thisInputLabel","textarea","cleanedValue","sanitizeFilters","showButton","invisible","thisSubmitButtonOnClick","showBonusInformation","bonusInformation","Switch","selection","setSelection","defaultChoices","do","initialIndex","initialValue","choiceArea","thisChoice","selected","String","P4ActionChoice","extraFormData","setExtraFormData","checkActions","setCheckActions","bns","checkedActions","checkedPermissions","isAllowed","actionSuggestions","isUsable","every","permissionList","runAllActionPermissionChecks","getSuggestInfo","getSuggestion","btcMin","btcUnits","btcValue","btcMinFull","btcValueFull","showStatus","availableActions","suggestionsToGet","getGetters","haveGettersOrSetters","suggestionToGet","onChangeFunction","thisAction","inputForms","replace","cleanInput","round","parseFloat","setSuggestion","setDescription","setName","settings","valueToReturn","valueArray","unitsArray","thisValue","bullets","isNaN","Number","strings","renderSetSuggestion","breakable","okButton","unavailableActions","unavailableActions__title","unavailableActions__actionList","unavailableActions__actionList__action","unavailableActions__actionList__action__title","unavailableActions__actionList__action__permissionList","unavailableActions__actionList__action__permissionList__permission","P5CustomForwards","textboxContent","setTextboxContent","setPlannedChanges","objForwards","forwardsString","keys","fwNetwork","needsChanging","getPlannedChanges","actionRequirementsString","chosenAction","stringFromCommands","getActionEmbedRequirements","plannedChangesSoFar","words","pastForwards","bytesOfChanges","bytesLeft","isSpaceFull","subtitle","changes","bytesOver","abs","bytes","thisByteCostEstimate","interpretation","cmd","allowRemoval","updateItem","updateInfo","updateCancel","newData","stopPropagation","explainForwards","editor","btnDelete","editorNetwork","cleanText","editorAddress","btnAdd","pastList","pastPair","pastNetwork","pastAddress","FeesSelection","feeText","setFeeText","showSuggestions","apiSuccess","min20","min40","min60","feeSuggestions","setFeeSuggestions","fees","fees__rate","cleanNumber","fees__apicall","apiSuggest","tryFees","fees__feeSelection","fees__feeSelection__choice","P6Broadcast","txIssue","message","endsWith","numberOfUpdates","countSoFar","ok","reason","broadcastStatus","setBroadcastStatus","unitBTC","showBTC","finalCost","totalCost","txSummary","status__button","PATH","status__failed","CreateNavigator","horizontalScaler","Create","timeDiff","timestampMsec","referenceTimestampMsec","diff","isExpired","d","h","m","dhm","dh","msDiff","SearchResults","notificationLink","linkable","nAddress","tabledOwnershipData","toUTCString","Fragment","isBurn","getBidding","tabledBiddingData","tabledAvailableDomainData","expandableTable","inputData","inputDescription","ownershipDetails","dataRows","dataRowIndex","latestForwards","matches","scrollbars","listContainer","ifw","listItem","avaiability","to","createLink","HomeContent","match","isSearchDone","inputEl","useRef","selectionEnd","selectionStart","focus","lblMainTitle","lblMainTitleAfter","divSearch","divSearchAfter","txtSearch","ref","sanitizedString","changeAliasAction","onKeyPress","results","Home","Settings","Logo","logo","LogoBackground","Withdraw","request","total","Wallet","txBuilder","setTxBuilder","initialTxBuilder","setParams","handleParamsChanges","TESTING","handleHashChange","resetUrl","fedValues","location","finalParamObject","thisKeyValue","splitKeyValue","thisKey","decodeURIComponent","newParams","pushState","process","minFeeRate","maxFeeRate","minOutputValue","result","inputs","fillInputs","outputs","Navbar","searchButton","toggleMenuButtonDiv","overflowMenuDiv","buttonWidth","offsetWidth","showCollapsed","resizeTimer","nav","setNav","dispatchEvent","Event","isCreatePage","pathname","isHomePage","isAboutPage","isSettingsPage","isWalletPage","menu","getBoundingClientRect","menuLeft","left","menuTop","top","opacity","onResize","document","body","classList","add","clearTimeout","remove","onClickAnywhere","buttonsArray","windowWidth","stdSizer","innerHeight","howManyButtonsFitSafely","buttonsOnNavbar","btn","buttonsOverflow","pageNum","collapsitron","menuShown","dots","thisButton","overflowMenu","App","searchParam","URLSearchParams","search","component","exact","json","ReactDOM","useReducer","Provider","hidden","setHidden","onDevKey","activeElement","getElementById","divDev","createElement","download","innerHTML","container","appendChild","click","dlState","btnOutline","sheet","parentNode","removeChild","createTextNode","head","localStorage","setItem","getItem","stringText","stringForKey","stringForIV","crypto","createHash","update","digest","iv","cipher","createCipheriv","encrypted","final","bufferCypher","decipher","createDecipheriv","decrypted","bufferData"],"mappings":"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","file":"static/js/main.3818ecf7.chunk.js","sourcesContent":["/**\n * Constants used to determine rules on BNS.\n */\n\n// testing mode true/false to reduce waiting time for tests\n// on for `npm run start` (development mode)\n// off for `npm run build` (production mode)\nconst TESTING = (process.env.NODE_ENV === 'development')\nTESTING && console.warn('Testing mode ON')\n\n// Block times can vary from 10 minutes but ok for estimate.\n// 52560 blocks ~365 days.\n// 1000 blocks ~ a week.\n// 288 blocks ~48 hours.\n// 144 blocks ~1 day.\n\n// max data safe to embed in OP_RETURN type tx (bytes)\n// ~80 chars\nconst BYTES_MAX = 80\n\n// Satoshis to burn minimum for attempting ownership (satoshi)\nconst MIN_BURN = 1000\n\n//  Minimum to use for notification output (satoshi)\nconst MIN_NOTIFY  = 1000\n\n// Ownership duration after victory (blocks)\n// ~1 year (production) / ~7 days (development)\nconst OWNERSHIP_DURATION_BY_BLOCKS = !TESTING ? 52560 : 1000\n\n// Duration before a top bidder becomes owner (blocks)\n// ~1 day\nconst CHALLENGE_PERIOD_DURATION_BY_BLOCKS = 144\n\n// Multiplier required on burn amount for new bid to beat\n// a previous (lower height) winning bid (assuming meets other conditions by deadline).\n// sets a minimum treshhold for trying to outbid someone else\nconst CHALLENGE_MIN_MULTIPLY = 2\n\n// BNS did not really exist before this point (for notifications only, wallets can go further)\n// this might be used to feed to nodes to speed up fetching of notification data to only after this height\nconst EARLIEST_NOTIFICATION_HEIGHT =  1662000\n\n\nexport {\n  TESTING,\n  MIN_BURN,\n  MIN_NOTIFY,\n  OWNERSHIP_DURATION_BY_BLOCKS,\n  BYTES_MAX,\n  CHALLENGE_PERIOD_DURATION_BY_BLOCKS,\n  CHALLENGE_MIN_MULTIPLY,\n  EARLIEST_NOTIFICATION_HEIGHT\n}","import { I_Bid } from './types'\n\n// this file will be used for various functions that might need deterministic random function\n\n/**\n * Takes array of bids or empty array and returns a winner if possible, otherwise undefined.\n * Winner is derived through deterministic weighted random number weighted by bid values.\n */\nexport const deterministicRandomBid = (bidArray: Array<I_Bid>): I_Bid | undefined => {\n  // easy cases\n  if (bidArray === undefined) return undefined\n  if (bidArray.length === 0) return undefined\n  if (bidArray.length === 1) return bidArray[0]\n\n  // now the harder derivations of N > 1 elements\n\n  // max weight summed up across all elements\n  let maxRange = 0\n  // array of each element including their range based on weight (value)\n  let ranges = bidArray.map(thisBid => {\n    const thisRange = {\n      min: maxRange,\n      max: maxRange + thisBid.value,\n      weight: thisBid.value,\n      bid: thisBid\n    }\n    maxRange = maxRange + thisBid.value\n    return thisRange\n  })\n\n  // Ideally should use block hash at this height to get random value,\n  // which is not predictable or cheap to change when block is found, even by miners.\n  // Grabbing the first blockHash, same at same height (same block = same block hash).\n  const blockHash = bidArray[0].blockHash\n\n  // quickly check that all block hashes are same\n  if (bidArray.some(thisBid => thisBid.blockHash !== blockHash)) {\n    console.warn('bidArray should have same height txs but txs contained different block hashes!!!', bidArray)\n  }\n\n  // convert block hash to hex BigInt can read and create BigInt\n  const hashBigInt = BigInt('0x' + blockHash)\n\n  // take a mod of max range to use as random number\n  const rangedHashBigInt = hashBigInt % BigInt(maxRange)\n\n  // find the range where it landed and return that bid\n  // the overall range of [0, maxRange) is split into separate ranges by each bid the exact length of each bid amount\n  // a number mod of max range has to fall somewhere within the individual ranges, and decide the winner\n  // completely deterministic by anyone independently yet very hard to predict before tx confirmations\n  for (let i = 0; i < ranges.length; i++) {\n    if (BigInt(ranges[i].min) <= rangedHashBigInt) {\n      if (BigInt(ranges[i].max) < rangedHashBigInt) {\n        // found it\n        return ranges[i].bid\n      }\n    }\n  }\n\n  console.warn('something went wrong and no winner was found', ranges, bidArray, maxRange)\n  return undefined\n}","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"CreateNavigator_wrapper__24rTe\",\"horizontalScaler\":\"CreateNavigator_horizontalScaler__2qmoi\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"Logo_wrapper__39M2z\",\"logo\":\"Logo_logo__1yGiJ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"LogoBackground_wrapper__2ydbu\",\"logo\":\"LogoBackground_logo__34EFs\",\"rotateMe\":\"LogoBackground_rotateMe__3KDus\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P5CustomForwards_wrapper__2kAy2\",\"title\":\"P5CustomForwards_title__29aFH\",\"subtitle\":\"P5CustomForwards_subtitle__1iqt_\",\"changes\":\"P5CustomForwards_changes__23bYg\",\"pastList\":\"P5CustomForwards_pastList__3rXdy\",\"buttonWrapper\":\"P5CustomForwards_buttonWrapper__3hvwB\",\"editor\":\"P5CustomForwards_editor__1ZVVF\",\"updateItem\":\"P5CustomForwards_updateItem__1wAhx\",\"updateCancel\":\"P5CustomForwards_updateCancel__3b5bW\",\"updateInfo\":\"P5CustomForwards_updateInfo__2OBcF\",\"editorNetwork\":\"P5CustomForwards_editorNetwork__1L6UB\",\"editorAddress\":\"P5CustomForwards_editorAddress__1N25M\",\"btnAdd\":\"P5CustomForwards_btnAdd__1tiSg\",\"btnDelete\":\"P5CustomForwards_btnDelete__3NCte\",\"pastPair\":\"P5CustomForwards_pastPair__3YvIk\",\"pastNetwork\":\"P5CustomForwards_pastNetwork__35eVe\",\"pastAddress\":\"P5CustomForwards_pastAddress__3-W_H\",\"bytesLeft\":\"P5CustomForwards_bytesLeft__2zySr\",\"bytesOver\":\"P5CustomForwards_bytesOver__ysfMq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"nav\":\"Navbar_nav__2imOE\",\"wallet\":\"Navbar_wallet__1RkTc\",\"warning\":\"Navbar_warning__1HOBZ\",\"overflowMenu\":\"Navbar_overflowMenu__1dStH\",\"button\":\"Navbar_button__3Xi0T\",\"selected\":\"Navbar_selected__10Mm9\",\"pageNum\":\"Navbar_pageNum__1amUi\",\"collapsitron\":\"Navbar_collapsitron__2qzRt\",\"dots\":\"Navbar_dots__1OrSM\",\"menuShown\":\"Navbar_menuShown__3-TaY\",\"blurme\":\"Navbar_blurme__2nA1q\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"SearchResults_wrapper__VvaYk\",\"matches\":\"SearchResults_matches__CzTtF\",\"scrollbars\":\"SearchResults_scrollbars__1zMfY\",\"breakable\":\"SearchResults_breakable__3r3ay\",\"listContainer\":\"SearchResults_listContainer__12vQE\",\"listItem\":\"SearchResults_listItem__3Udwx\",\"key\":\"SearchResults_key__358jo\",\"expired\":\"SearchResults_expired__2ptnD\",\"avaiability\":\"SearchResults_avaiability__3E0Yr\",\"createLink\":\"SearchResults_createLink__13Wez\",\"describe\":\"SearchResults_describe__3HACm\",\"ownershipDetails\":\"SearchResults_ownershipDetails__1Z7p1\",\"balance\":\"SearchResults_balance__11rok\",\"linkable\":\"SearchResults_linkable__86qQ2\"};","import * as bitcoin from 'bitcoinjs-lib'\nimport { calcP2WSH } from './calcP2WSH'\nimport { MIN_NOTIFY } from './constants'\nimport { encrypt } from './cryptography'\nimport { I_Domain, I_Checked_Action } from './types/'\nimport { BnsSuggestionType } from './../bns/types'\nimport { getNonce } from './formathelpers'\nimport { getFinalScripts } from './bitcoin'\n\nconst hash160 = bitcoin.crypto.hash160\nconst op = bitcoin.opcodes\n\ninterface I_Tx_Result {\n  thisVirtualSize: number\n  txid: number\n  hex: string\n  valueNeeded: number\n  fee: number\n  change: number\n  burnAmount: number\n  notifyAmount: number\n  refundsAmount: number\n  totalGathered: number\n  gatheredFromWallet: number\n  gatheredFromOther: number\n  nInputs: number\n  nOutputs: number\n  nInputsFromWallet: number\n  nInputsFromOther: number\n}\n\n/**\n * Creates hex of tx to bid on domain.\n * Throws error if not enough funds.\n * Leave vBytes blank, it will call itself via recursion until it derives needed size.\n * @param   {object}      wallet                  - { WIF, address, txHistory, utxoList, ... }.\n * @param   {object}      domain                  - all domain info\n * @param   {object}      choices                 - { action, feeRate, embedString, ... }\n * @param   {string}      networkChoice           - 'testnet' or 'bitcoin' (matches bitcoinjs-lib).\n * @param   {number=}     [vBytes=0]              - size of transaction in vBytes. *\n * @returns {object}                              - Tx Results.\n */\nexport const calcTx = (\n  wallet: any,\n  domain: I_Domain,\n  choices: { action: I_Checked_Action, feeRate: number, embedString: string, [key: string]: any },\n  networkChoice: string,\n  vBytes: number = 1\n): I_Tx_Result => {\n\n  if (wallet.utxoList.length === 0) {\n    throw new Error('Wallet has no funds (utxo) to use')\n  }\n\n  // grab fee rate\n  const feeRate = choices.feeRate\n\n  // grab network object\n  const network = bitcoin.networks[networkChoice]\n\n  // calculate domain notification address\n  const { notificationsAddress } = calcP2WSH(domain.domainName, networkChoice)\n\n  // calculate funds necessary for this tx, round up sat for more better than being below minimum.\n  const fee = Math.ceil(vBytes * feeRate)\n\n\n  // output[0]: check special tx rules for max amount required to burn among all of them\n  const burnAmounts = choices.action.suggestions.reduce((allBurnAmounts: any, thisSuggestion: any) => {\n    // console.log('choices.action.suggestions each item:', thisSuggestion)\n    let burnAmountsHere: any = []\n      // if there's a set burn rule, add to list\n      if (('set' in thisSuggestion.info) && (thisSuggestion.info.set.name === 'Bid burn amount')) {\n        burnAmountsHere = [...burnAmountsHere, thisSuggestion.info.set.value]\n      }\n      // if there's a user provided get value, add to list\n      if (('get' in thisSuggestion.info) && (thisSuggestion.info.get.name === 'Bid burn amount')) {\n        burnAmountsHere = [...burnAmountsHere, parseInt(thisSuggestion.info.get.value, 10)]\n      }\n    return [...allBurnAmounts, ...burnAmountsHere]\n  }, [])\n  const burnAmount = Math.max(...burnAmounts)\n\n  // add up any refunds to do for total needed and array of address/amount for generating outputs\n  let refundsAmount = 0\n  const refundAmountsArray = choices.action.suggestions.reduce((refundAmounts: any, thisSuggestion: any) => {\n    // console.log('choices.action.suggestions each item:', thisSuggestion)\n    // if there's a refund to do, add to list\n    if (thisSuggestion.info.type === BnsSuggestionType.REFUND_BIDDERS && thisSuggestion.info.get.value === true) {\n      const arrayOfAmountsAndAddresses = thisSuggestion.info.set.value.split('\\n')\n      const refunds = arrayOfAmountsAndAddresses.map((thisAmountAndAddress: any) => {\n        const thisAddress = thisAmountAndAddress.split(' ')[1]\n        const thisAmount = parseInt(thisAmountAndAddress.split(' ')[0], 10)\n        refundsAmount += thisAmount\n        return { address: thisAddress, amount: thisAmount }\n      })\n\n      return [...refundAmounts, ...refunds]\n    } else {\n      return refundAmounts\n    }\n  }, [])\n\n  const valueNeeded = refundsAmount + burnAmount + MIN_NOTIFY + fee // sat\n\n  // gather necessary utxo to use until enough to cover costs\n  let totalGathered = 0 // sat\n\n  // track multiple sources for providing detailed information\n  let gatheredFromWallet = 0\n  let gatheredFromOther = 0\n\n  // prepare extra inputs from other rules\n  // adding these first to totalGathered satoshi since have to add them all anyway\n  let toBeUsedUtxoOfNotifications: Array<any> = []\n  // must consume all ACS utxo wallet.address has created\n  // get all utxo for notification address\n  domain.derivedUtxoList.forEach(utxo => {\n    // use only utxo created from this wallet's address\n    if (utxo.from_scriptpubkey_address === wallet.address) {\n      toBeUsedUtxoOfNotifications.push(utxo)\n      totalGathered += utxo.value\n      gatheredFromOther += utxo.value\n    }\n  })\n\n\n  // Adding remaining funds from user's wallet to total Gathered\n  // Must always add at least 1 user utxo @ index 0 to indicate ownership\n  let toBeUsedUtxoOfUserWallet: Array<any> = []\n  wallet.utxoList.forEach((utxo: any) => {\n    // while not enough funds or if haven't added a single user utxo yet\n    if (totalGathered < valueNeeded || toBeUsedUtxoOfUserWallet.length === 0) {\n      toBeUsedUtxoOfUserWallet.push(utxo)\n      totalGathered += utxo.value\n      gatheredFromWallet += utxo.value\n    }\n  })\n\n  // all utxo parsed at this point\n\n  // if still not enough funds after all possible inputs,\n  // there are simply not enough funds to do the tx\n  if (totalGathered < valueNeeded) {\n    throw new Error(\n      'Not enough funds available (need: '\n      + (valueNeeded / 1e8).toFixed(8)\n      + ' BTC, have: '\n      + (totalGathered / 1e8).toFixed(8) + ' BTC)'\n    )\n  }\n\n\n  // calculate keys from wallet import format key\n  const keyPair = bitcoin.ECPair.fromWIF(wallet.WIF, network)\n  // create Partially Signed Bitcoin Transaction object to build tx\n  const psbt = new bitcoin.Psbt({ network })\n  psbt.setVersion(2)    // default\n  psbt.setLocktime(0)   // default\n\n  // add all inputs to transaction\n\n  // must be first added as owner address must always be at index 0 input\n  toBeUsedUtxoOfUserWallet.forEach(utxo => {\n    psbt.addInput({\n      hash: utxo.txid,\n      index: utxo.vout,\n      sequence: 0xfffffffe,\n      // should work for segwit and nonsegwit inputs\n      nonWitnessUtxo: Buffer.from(utxo.hex, 'hex')\n    })\n  })\n\n  // calculate witnessScript\n  const witnessScript = bitcoin.script.compile([\n    hash160(Buffer.from(domain.domainName, 'utf8')),\n    op.OP_DROP\n  ])\n\n  const inputScript = bitcoin.script.compile([op.OP_TRUE])\n\n  // add each utxo to inputs\n  toBeUsedUtxoOfNotifications.forEach(utxo => {\n    if (!utxo.hex) {\n      // abort if missing raw hex\n      throw new Error(`Utxo is missing hex, txid: ${utxo.txid}, vout:${utxo.vout}`)\n    }\n    psbt.addInput({\n      hash: utxo.txid,\n      index: utxo.vout,\n      sequence: 0xfffffffe,\n      nonWitnessUtxo: Buffer.from(utxo.hex, 'hex'),\n      witnessScript: witnessScript\n    })\n  })\n\n\n  // inputs done\n\n  /* -------------------------------------------------------------------------- */\n  /*                              creating outputs                              */\n  /* -------------------------------------------------------------------------- */\n\n  // add the op_return output (always index 0)\n  // if first time notifying, nonce is '0', otherwise the last blockheight when this user has sent ANY tx to that notification address\n  const nonce = getNonce({ domain }, wallet.address).toString()\n  const encryptionKey =  domain.domainName + wallet.address + nonce\n  console.log('nonce used to encrypt', domain.domainName, wallet.address, nonce)\n\n  const finalEmbedString = choices.embedString\n  console.log('string embedded is', '\"' + finalEmbedString + '\"')\n  const data = encrypt(finalEmbedString, encryptionKey)\n  const embed = bitcoin.payments.embed({ data: [data] })\n\n\n\n  psbt.addOutput({\n    script: embed.output,\n    value: burnAmount,\n  })\n  console.log('rules say to burn ', burnAmount)\n\n  // output[1] add notification output (always index 1)\n  psbt.addOutput({\n    address: notificationsAddress, // calculated from domainName provided\n    value: MIN_NOTIFY\n  })\n\n  // output[2] add change output (anything is fine for output[2] or higher)\n  // here we can set an address change where user keeps control as the\n  // address to receive the remaining change from this tx\n  const changeAddress = choices.action.type === 'CHANGE_ADDRESS'\n    ? (choices.action.suggestions.find((suggestion: any) => ('get' in suggestion.info))!.info.get!.value)\n    : wallet.address\n  const change = totalGathered - valueNeeded\n  psbt.addOutput({\n    address: changeAddress,\n    value: change\n  })\n\n  refundAmountsArray.forEach((thisRefund: { address: string, amount: number }) => {\n    psbt.addOutput({\n      address: thisRefund.address,\n      value: thisRefund.amount\n    })\n  })\n\n  /* -------------------------------------------------------------------------- */\n  /*          at this point all inputs & outputs added so ready to sign         */\n  /* -------------------------------------------------------------------------- */\n\n  toBeUsedUtxoOfUserWallet.forEach((utxo, index) => {\n    // sign p2wpkh of controlling\n    psbt.signInput(index, keyPair)\n    // (TODO) signing ACS inputs will need script\n\n    if (!psbt.validateSignaturesOfInput(index)) {\n      throw new Error('Signature validation failed for input index ' + index.toString())\n    }\n  })\n\n  // finalizing inputs\n  // psbt.finalizeAllInputs()\n\n  // finalize regular p2wsh inputs normally\n  for (let i = 0; i < toBeUsedUtxoOfUserWallet.length; i++) {\n    psbt.finalizeInput(i)\n  }\n  // finalize witness script stack inputs with extra parameter\n  // for the submitted script parameters & original full script\n  for (\n    let i = toBeUsedUtxoOfUserWallet.length;\n    i < toBeUsedUtxoOfUserWallet.length + toBeUsedUtxoOfNotifications.length;\n    i++\n  ) {\n    psbt.finalizeInput(i, getFinalScripts({ inputScript, network }))\n  }\n\n  const tx = psbt.extractTransaction()\n  console.log(tx)\n  const thisVirtualSize = tx.virtualSize()\n  const txid = tx.getId()\n  const hex = tx.toHex()\n  const nInputs = tx.ins.length\n  const nOutputs = tx.outs.length\n\n  if (vBytes >= thisVirtualSize) {\n    // If this tx fee was calculated for a vBytes size equal to or larger than the resulting derived tx (thisVirtualSize),\n    // fee should be safe by being equal to or larger than necessary at required feeRate.\n    // Obviously vBytes = 0 will never give the correct fee minimum the first time through.\n    console.log('virtualSize', tx.virtualSize())\n    console.log('byteLength', tx.byteLength())\n    console.log('getId', tx.getId())\n    console.log('hex', tx.toHex())\n    console.log('')\n    return {\n      txid,\n      thisVirtualSize,\n      hex, valueNeeded,\n      fee,\n      change,\n      burnAmount,\n      notifyAmount: MIN_NOTIFY,\n      refundsAmount,\n      totalGathered,\n      gatheredFromWallet,\n      gatheredFromOther,\n      nInputs,\n      nOutputs,\n      nInputsFromWallet: toBeUsedUtxoOfUserWallet.length,\n      nInputsFromOther: toBeUsedUtxoOfNotifications.length || 0\n    }\n  } else {\n    // Redo this tx calculation using the virtual size we just calculated for vByte optional parameter.\n    return calcTx(\n      wallet, domain, choices, networkChoice, thisVirtualSize\n    )\n  }\n}\n\n\n\n","// My edit of https://github.com/bin-y/standard-ecies/blob/master/main.js\n// Removed space consuming hmac, replaced with 4 byte checksum, simplified\n// https://medium.com/asecuritysite-when-bob-met-alice/go-public-and-symmetric-key-the-best-of-both-worlds-ecies-180f71eebf59\n// https://en.wikipedia.org/wiki/Integrated_Encryption_Scheme\n\nimport crypto from 'crypto'\n\n// ecies.encrypt() or ecies.decrypt()\n\ninterface I_Options {\n  hashName?: string                                       // 'sha256' (default)\n  curveName?: string                                      // e.g. 'secp256k1' (default)\n  symmetricCypherName?: string                            // e.g. 'aes-256-crt' or 'aes-256-ecb' (default)\n  iv?: Buffer | null                                      // 16 byte buffer or null\n  toIv?: Buffer | string                                  // will get hashed to derive iv\n  keyFormat?: \"compressed\" | \"uncompressed\" | \"hybrid\"    // e.g. 'compressed' (default)\n}\n\n/**\n * Attempts to encrypt with public key.\n * For 'secp256k1' 33 bytes on ephemeral key, 4 bytes checksum, rest on cipher content.\n * Returns encrypted message buffer or undefined if error.\n * @param     {Buffer}      publicKey           Public key to encrypt with.\n * @param     {Buffer}      message             Clear text message to decrypt.\n * @param     {object}      [options={}]        Object with options.\n * @returns   {Buffer | undefined}              Encrypted message buffer, undefined if error.\n */\nconst encrypt = (publicKey: Buffer, message: Buffer, options: I_Options = {}) => {\n  options = makeUpOptions(options)\n\n  try {\n    // add 4 byte checksum to end of cleartext to check later\n    const checkSum = crypto.createHash('sha256').update(message).digest().slice(0, 4)\n    const checkSummedMessage = Buffer.concat([message, checkSum])\n\n    const ecdh = crypto.createECDH(options.curveName!)\n    // R (generated)\n    // null error avoided via hex buffer\n    const R = Buffer.from(ecdh.generateKeys('hex', options.keyFormat!), 'hex')\n    // S (calculated)\n    const sharedSecret = ecdh.computeSecret(publicKey)\n\n    // uses KDF to derive a symmetric encryption\n    // Ke = KDF(S)\n    const hash = hashMessage(options.hashName!, sharedSecret)\n    // Ke\n    const encryptionKey = hash\n\n    // encrypts the message:\n    // c = E(Ke m)\n    const cipherText = symmetricEncrypt(options.symmetricCypherName!, options.iv, encryptionKey, checkSummedMessage)\n\n    // console.log('ecies encryption success with', { R, cipherText })\n\n    // outputs R || c\n    return Buffer.concat([R, cipherText])\n\n  } catch (e) {\n    return undefined\n  }\n}\n\n/**\n * Attempts to decrypt with private key.\n * Returns decrypted message buffer or undefined if error or checksum fail.\n * @param     {Buffer}      privateKey          Private key to decrypt with.\n * @param     {Buffer}      encryptedMessage    Encrypted message to decrypt.\n * @param     {object}      [options={}]        Object with options.\n * @returns   {Buffer | undefined}              Cleartext if decrypted, otherwise undefined.\n */\nconst decrypt = (privateKey: Buffer, encryptedMessage: Buffer, options: I_Options = {}) => {\n  options = makeUpOptions(options)\n\n  const ecdh = crypto.createECDH(options.curveName!)\n  ecdh.setPrivateKey(privateKey);\n\n  try {\n    // null error avoided via hex buffer\n    const publicKeyLength = Buffer.from(ecdh.getPublicKey('hex', options.keyFormat), 'hex').length\n    // R (provided)\n    const R = encryptedMessage.slice(0, publicKeyLength)\n    // c (provided)\n    const cipherText = encryptedMessage.slice(publicKeyLength, encryptedMessage.length)\n    // S (calculated)\n    const sharedSecret = ecdh.computeSecret(R)\n\n    // derives keys the same way as Alice did:\n    // Ke = KDF(S)\n    const hash = hashMessage(options.hashName!, sharedSecret)\n    // Ke\n    const encryptionKey = hash\n\n    // console.log({ R, cipherText })\n    const decryptedMessagecheckSummed = symmetricDecrypt(options.symmetricCypherName!, options.iv, encryptionKey, cipherText)\n\n    // check the last 4 bytes of checksum\n    const checkSum = decryptedMessagecheckSummed.slice(-4)\n    const decryptedMessage = decryptedMessagecheckSummed.slice(0, -4)\n    const newCheckSum = crypto.createHash('sha256').update(decryptedMessage).digest().slice(0, 4)\n\n    // if not equal or either are too short\n    if (Buffer.compare(checkSum, newCheckSum) !== 0 || checkSum.length !== 4 || newCheckSum.length !== 4) {\n      throw new Error('checkSum failed')\n    }\n\n    // console.log('ecies decryption success from', { R, cipherText })\n    return decryptedMessage\n\n  } catch (e) {\n\n    return undefined\n  }\n}\n\nexport const ecies = { encrypt, decrypt }\n\n/* -------------------------------------------------------------------------- */\n/*                                   helpers                                  */\n/* -------------------------------------------------------------------------- */\n\n// E\nfunction symmetricEncrypt(cypherName: string, iv: Buffer | null | undefined, key: Buffer, plaintext: Buffer) {\n  let cipher\n  if (iv) {\n    cipher = crypto.createCipheriv(cypherName, key, iv)\n  }\n  else {\n    cipher = crypto.createCipher(cypherName, key)\n  }\n  const firstChunk = cipher.update(plaintext)\n  const secondChunk = cipher.final()\n  return Buffer.concat([firstChunk, secondChunk])\n}\n\n// E-1\nfunction symmetricDecrypt(cypherName: string, iv: Buffer | null | undefined, key: Buffer, ciphertext: Buffer) {\n  let cipher\n  if (iv) {\n    cipher = crypto.createDecipheriv(cypherName, key, iv)\n  }\n  else {\n    cipher = crypto.createDecipher(cypherName, key)\n\n  }\n  const firstChunk = cipher.update(ciphertext)\n  const secondChunk = cipher.final()\n  return Buffer.concat([firstChunk, secondChunk])\n}\n\n// KDF\nfunction hashMessage(cypherName: string, message: Buffer) {\n  return crypto.createHash(cypherName).update(message).digest()\n}\n\nfunction makeUpOptions(options: I_Options = {}) {\n\n  if (options.hashName === undefined) {\n    options.hashName = 'sha256'\n  }\n  if (options.curveName === undefined) {\n    options.curveName = 'secp256k1'\n  }\n  if (options.symmetricCypherName === undefined) {\n    options.symmetricCypherName = 'aes-256-ecb'\n    options.iv = null\n  }\n  if ((options.iv === undefined) && !!options.toIv) {\n    options.iv = crypto.createHash('sha256')\n      .update(options.toIv)     // value to hash\n      .digest()                 // hash\n      .slice(0, 16)             // first 16 bytes\n  }\n  if (options.keyFormat === undefined) {\n    options.keyFormat = 'compressed'\n  }\n\n  return options\n}\n\n","\n// types of user BNS actions that match use in actions.tsx\nexport enum BnsActionType {\n  RENEW = 'RENEW',\n  ONLY_FORWARDS = 'ONLY_FORWARDS',\n  BID_FOR_OWNERSHIP = 'BID_FOR_OWNERSHIP',\n  SEND_OWNERSHIP = 'SEND_OWNERSHIP',\n  CHANGE_ADDRESS = 'CHANGE_ADDRESS',\n  REFUND_OTHER_BIDS = 'REFUND_OTHER_BIDS'\n}\n\n// types of suggestions so user interface can interpret correctly\n// among limited options\nexport enum BnsSuggestionType {\n  REFUND_BIDDERS = 'REFUND_BIDDERS'\n}\n\n// types of bidding\nexport enum BnsBidType {\n  BURN = 'BURN',            // ownership bidding in progress taht requires burns\n  NULL = 'NULL'             // no bidding in progress\n}\n\nexport interface I_BNS_Action {\n  type: BnsActionType\n  info: string\n  permissions: Array<any>\n  conditions: Array<any>\n  execute: () => void\n  args: any\n}\n\nexport interface I_BNS_Auto_Action {\n  info: string\n  conditions: Array<any>\n  execute: () => void\n}\n\n// export interface I_Action_Choice {\n//   type: BnsActionType\n//   info: string\n//   suggestions: Array<any>\n//   actionContent: string\n// }\n\nexport interface I_BnsState {\n  domain: I_Domain\n  chain?: {\n    parsedHeight: number                // parsed height for derivation\n    currentHeight: number               // real world block height (for final update)\n  }\n}\n\nexport interface I_Domain {             // notification info for this domain name\n  domainName: string                    // domain name\n  notificationAddress: string           // p2wsh address for this domain name (alias + extension)\n  txHistory: Array<I_TX>                // array of all tx for this address (old addressHistory)\n  derivedUtxoList: Array<I_UTXO>        // derived utxo set from tx history parse\n  utxoList: Array<I_UTXO>               // array of all real time utxo at address\n  users: {                              // keeps track of interacting users / source addresses\n                                        // with addresses as keys\n    [address: string]: I_User\n  }\n  currentOwner: string                  // points to a source address or blank string\n\n  bidding: {                            // bidding\n    startHeight: number                 // auction/challenge start height\n    endHeight: number                   // \" end height\n    type: BnsBidType                    // type of bidding - e.g. BURN / NULL\n    bids: Array<I_Bid>                  // array of bids\n  }\n\n  ownersHistory: Array<I_User>          // owner history log\n}\n\nexport interface I_Bid {\n  height: number                        // height the bid was confirmed\n  timestamp: number                     // timestamp when bid was confirmed\n  address: string                       // address doing the bidding\n  value: number                         // amount bid\n  valueLeftToRefund: number             // amount of bid left to refund\n  blockHash: string                     // block hash of block where tx was confirmed\n}\n\nexport interface I_User {\n  address:      string                  // address in control\n  forwards:     Array<I_Forward>        // for forwards later\n  burnAmount:   number                  // burned to get ownership\n  winHeight:    number                  // blockheight winning bid\n  winTimestamp: number                  // winHeight in block's timestamp\n  nonce:        number                  // for counting previous notification\n                                        // height from this address, no matter good/bad/type\n  updateHeight: number                  // the height of most current parsed update, created\n                                        // after nonce height & therefore using it\n}\n\n  // each forward object has the following data\nexport interface I_Forward {\n  network: string\n  address: string\n  updateHeight: number\n  updateTimestamp: number\n}\n\nexport interface I_TX {\n  txid: string\n  version: number\n  locktime: number\n  size: number\n  weight: number\n  fee: number\n  vin: Array <{\n    txid: string\n    vout: number\n    prevout: {\n      scriptpubkey: string\n      scriptpubkey_asm: string\n      scriptpubkey_type: string\n      scriptpubkey_address: string\n    }\n    scriptsig: string\n    scriptsig_asm: string\n    witness: {\n      [key: number]: string\n    }\n    is_coinbase: boolean\n    sequence: number\n  }>\n  vout: Array <{\n    scriptpubkey: string\n    scriptpubkey_asm: string\n    scriptpubkey_type: string\n    scriptpubkey_address: string // op return case?\n    value: number\n  }>\n  status: {\n    confirmed: boolean      // unconfirmed case?\n    block_height: number\n    block_hash: string\n    block_time: number\n  }\n}\n\nexport interface I_UTXO {\n  txid: string\n  vout: number\n  status: {\n    confirmed: boolean\n    block_height: number\n    block_hash: string\n    block_time: number\n  }\n  value: number\n  hex?: string\n  from_scriptpubkey_address?: string\n}\n\nexport interface I_Condition {\n  status: () => boolean\n  info: {\n    describe: string                    // string containing explanation for user\n    type?: BnsSuggestionType            // type of suggestion\n    set?: {                             // object suggesting user sets something to a value\n      value: any                        // value to set it to (if exact value unknown better to .get it from user)\n      name: string                      // what the value is for\n      units: string                     // units\n    }\n    get?: {                             // object of suggested variable to get from user\n      value: number | string | boolean  // initial value of variable trying to get\n      name: string                      // name of variable getting\n      min?: number | null               // possible min value\n      max?: number | null               // possible max value\n      units?: string                    // units if necessary\n    }\n    command?: string                    // command if this is a command to be embedded (value in get/set)\n    warning?: string                    // warn if this is possible but terrible idea\n  }\n}\n\nexport interface I_Evaluated_Condition extends I_Condition {\n                                    // all I_Conditions parameters extended\n  isAllowed: boolean                // if permission passed check\n}\n\n\n// this is checked to know what user options are PER ACTION\nexport interface I_Checked_Action {\n  type: BnsActionType                   // pass each action type to user attempting to create tx\n  info: string                          // describe each action type\n  isUsable: boolean                     // summarize if it meets all permissions for user to do\n  permissionList: [                     // ONLY permissiond checked for this action (all can do before tx)\n    I_Evaluated_Condition\n  ]\n  suggestions: Array<I_Condition>      // info from ALL action's conditions\n}","export * from './types'","module.exports = __webpack_public_path__ + \"static/media/graphic.b15c3267.png\";","import { newUser, newState } from './initialState'\nimport {\n  OWNERSHIP_DURATION_BY_BLOCKS,\n  MIN_BURN,\n  MIN_NOTIFY,\n  CHALLENGE_PERIOD_DURATION_BY_BLOCKS,\n  CHALLENGE_MIN_MULTIPLY\n} from './constants'\nimport { I_User, I_Forward, I_BnsState, I_TX, I_UTXO, I_Bid, BnsBidType } from './types/'\nimport { decrypt } from './cryptography'\nimport { deterministicRandomBid } from './deterministicRandom'\n\n\n/* -------------------------------------------------------------------------- */\n/*                              helper functions                              */\n/* -------------------------------------------------------------------------- */\n\nexport const existsCurrentOwner = (st: I_BnsState): boolean => st.domain.currentOwner !== ''\nexport const existsUser = (st: I_BnsState, address: string): boolean => !!st.domain.users[address]\n\nexport const createNewUser = (st: I_BnsState, address: string): void => {\n  // create new user\n  st.domain.users[address] = JSON.parse(JSON.stringify(newUser))\n  // update its address for easy access\n  st.domain.users[address].address = address\n}\n\nexport const getOwnerAddress = (st: I_BnsState): string => st.domain.currentOwner || ''\n\nexport const setOwner = (st: I_BnsState, newOwnerAddress: string) => {\n  st.domain.currentOwner = newOwnerAddress\n}\n\n\nexport const getUser = (st: I_BnsState, address: string): I_User => {\n  if (!existsUser(st, address)) {\n    console.warn('You called', getUser, 'without checking if user exists via existsUser()')\n  }\n  return st.domain.users[address]\n}\n\nexport const getOwner = (st: I_BnsState) => {\n  const ownerAddress = getOwnerAddress(st)\n  if (!ownerAddress) return undefined\n  return getUser(st, ownerAddress)\n}\n\nexport const updateOwnerHistory = (st: I_BnsState): void => {\n  st.domain.ownersHistory.push(getOwner(st) || JSON.parse(JSON.stringify(newUser)))\n}\n\nexport const clearOwner = (st: I_BnsState): void => { st.domain.currentOwner = '' }\n\nexport const getCurrentHeight = (st: I_BnsState): number => st.chain?.currentHeight || 0\nexport const getParsedHeight = (st: I_BnsState): number => st.chain?.parsedHeight || 0\nexport const setParsedHeight = (st: I_BnsState, height: number): void => {\n  st.chain && (st.chain.parsedHeight = height)\n}\n\nexport const getNotificationAddress = (st: I_BnsState): string => st.domain.notificationAddress || ''\n\nexport const getLastOwnerBurnedValue = (st: I_BnsState): number => getOwner(st)?.burnAmount || 0\n\nexport const isOwnerExpired = (st: I_BnsState): boolean => {\n  if (!existsCurrentOwner(st)) return true // no owner same as expired\n  const owner = getOwner(st)\n  if (!owner) {\n    console.log('isOwnerExpired: owner exists but no user with such address stored')\n    return true\n  }\n  const blocksSinceUpdate = getParsedHeight(st) - owner.winHeight\n  return blocksSinceUpdate > OWNERSHIP_DURATION_BY_BLOCKS\n}\n\n/**\n * Returns nonce of user based on address.\n * If no previous user history for domain, nonce is 0, otherwise last tx height.\n */\nexport const getNonce = (st: I_BnsState, address: string): number => {\n  const doesExist = existsUser(st, address)\n  if (!doesExist) {\n    return 0\n  } else {\n    const user = getUser(st, address)\n    return user.nonce\n  }\n}\n\n\n// ===== tx functions (getters) =====================\n\nexport const getTxTimestamp = (tx: I_TX): number => tx.status.block_time || 0\nexport const getTxHeight = (tx: I_TX): number => tx.status.block_height || 0\n\nexport const getTxOutput0BurnValue = (tx: I_TX): number => tx.vout[0]?.value || 0\nexport const getTxOutput0Data = (tx: I_TX):string => {\n  if (isOpreturnOutput0(tx)) {\n    // remove 'OP_RETURN OP_PUSHBYTES_5 ' from it and return the rest\n    return tx.vout[0].scriptpubkey_asm.split(' ').slice(2).join('')\n  }\n  return ''\n}\n\nexport const getTxOutput1NotifyValue = (tx: I_TX): number => tx.vout[1]?.value || 0\nexport const getTxOutput1NotifyAddress = (tx: I_TX): string => tx.vout[1]?.scriptpubkey_address || ''\n\nexport const getTxInput0SourceUserAddress = (tx: I_TX): string => (\n  tx.vin[0]?.prevout.scriptpubkey_address || ''\n)\n\n\n// ======= update state from tx (setters) ========\n\n// update the info for the source user of the tx within bns state\n// when ran a second time, it simply updates nonce for post-tx value\nexport const updateSourceUserFromTx = (st: I_BnsState, tx: I_TX): void => {\n  const fromAddress = getTxInput0SourceUserAddress(tx)\n\n  // create new user if not already one of users\n  // if (!(fromAddress in st.domain.users)) {\n  if (!existsUser(st, fromAddress)) {\n    // create new user object by copying values of newUser object\n    createNewUser(st, fromAddress)\n    console.log('new source created:', fromAddress)\n  }\n\n  // update user heights/times\n  const user = st.domain.users[fromAddress]\n  user.nonce = user.updateHeight\n  user.updateHeight = getTxHeight(tx)\n}\n\nexport const addToUserForwards = (\n  st: I_BnsState,\n  fromAddress: string,\n  forwardsInThisTx: Array<I_Forward>\n) => {\n  const user = getUser(st, fromAddress)\n  user.forwards = [...user.forwards, ...forwardsInThisTx]\n}\n\n// parse embedded data and store in forwards\nexport const readEmbeddedData = (st: I_BnsState, tx: I_TX):void => {\n  // only go on if there is op_return with embedded data on output 0\n  if (!isOpreturnOutput0(tx)) {\n    console.log(getTxHeight(tx), ': no op_return found for txid')\n    return undefined\n  }\n\n  // get useful object references\n  const fromAddress = getTxInput0SourceUserAddress(tx)\n  const user = getUser(st, fromAddress)\n  const nonce = getNonce(st, fromAddress).toString()\n\n  const embeddedDataHex = getTxOutput0Data(tx)\n  const embeddedDataBuffer = Buffer.from(embeddedDataHex, 'hex')\n\n  const decryptionKey = st.domain.domainName + user.address + nonce\n  // console.log(\n  //   '',\n  //   getTxHeight(tx),\n  //   ': decryption key: ',\n  //   st.domain.domainName,\n  //   user.address,\n  //   nonce\n  // )\n  const embeddedDataUtf8 = decrypt(embeddedDataBuffer, decryptionKey)\n  // console.log('', getTxHeight(tx), ': found embedded data:', embeddedDataUtf8)\n\n  // split by spaces into array\n  const embeddedDataUtf8Array = embeddedDataUtf8.split(' ')\n\n  // collect all forwards in this tx\n  const forwardsInThisTx: Array<I_Forward> = []\n\n  embeddedDataUtf8Array.forEach((word: string, index: number) => {\n    // everything must be space separated in pairs\n    // so single block might mean failed decryption or\n    // last unpaired block might be padding or future versioning\n    // grabbing only odd and 1 before it values, only grabbing pairs\n    if (index % 2 === 1) {\n      const networkPiece = embeddedDataUtf8Array[index - 1]\n      const forwardingAddressPiece = word\n      const thisForward = {\n        // encoding text here before inserting it into global state\n        // encodeURIComponent() escapes all characters except: A-Z a-z 0-9 - _ . ! ~ * ' ( )\n        // majority of usecases do not need special characters\n        // for special cases users can just\n        // create a rule for specific network to decodeURIComponent & handle carefully\n        network:          encodeURIComponent(networkPiece),\n        address:          encodeURIComponent(forwardingAddressPiece),\n        updateHeight:     getTxHeight(tx),\n        updateTimestamp:  getTxTimestamp(tx)\n      }\n      forwardsInThisTx.push(thisForward)\n    }\n  })\n\n  // update forwards on the user\n  addToUserForwards(st, fromAddress, forwardsInThisTx)\n}\n\n// ===== rule checks (getters) =====\n\n// Describe:    2 outputs minimum\nexport const atLeastTwoOutputs = (tx: I_TX): boolean => tx.vout.length >= 2\n\n// Describe:    Is [0] output OP_RETURN type\nexport const isOpreturnOutput0 = (tx: I_TX): boolean => (\n  tx.vout[0].scriptpubkey_asm.split(' ')[0] === 'OP_RETURN'\n)\n\n// Describe:    Is [1] output this domain's notification address?\nexport const isNotify =  (st: I_BnsState, tx: I_TX): boolean => (\n  getTxOutput1NotifyAddress(tx) === getNotificationAddress(st)\n)\n\n// Describe:    At least minimum amount used in notification output? (Dust level is main danger)\nexport const didNotifyMin = (tx: I_TX): boolean => getTxOutput1NotifyValue(tx) >= MIN_NOTIFY\n\n// Describe:    Is address the current domain owner?\nexport const isAddressTheCurrentOwner = (st: I_BnsState, address: string): boolean =>\n  getOwnerAddress(st) === address\n\n// Describe:    Is tx sender the current domain owner (input [0], id'ed by address)?\nexport const isSenderTheCurrentOwner = (st: I_BnsState, tx: I_TX): boolean =>\n  getOwnerAddress(st) === getTxInput0SourceUserAddress(tx)\n\n// Describe:    At least minimum amount burned?\nexport const didBurnMin = (tx: I_TX): boolean =>\n  getTxOutput0BurnValue(tx) >= MIN_BURN\n\n// Describe:    Burned at least as much as previously burnt\nexport const burnedPreviousRateMin = (st: I_BnsState, tx: I_TX): boolean => (\n  getTxOutput0BurnValue(tx) >= getLastOwnerBurnedValue(st)\n)\n\n/**\n * Checks if this command exists at tx height from tx user.\n */\nexport const isCommandCalled = (\n  st: I_BnsState,\n  tx: I_TX,\n  command: string\n): boolean  => {\n  return !!getCommandCalled(st, tx, command)\n}\n\n/**\n * Gets command called in most recent forwards from user of tx.\n */\nexport const getCommandCalled = (\n  st: I_BnsState,\n  tx: I_TX,\n  command: string\n): I_Forward | undefined  => {\n\n  // get tx height (only current height is relevant for commands)\n  const txHeight = getTxHeight(tx)\n  // who sent the tx\n  const fromAddress = getTxInput0SourceUserAddress(tx)\n  // get user object of the tx sender\n  const user = getUser(st, fromAddress)\n  // array of forwards\n  const forwards = user.forwards\n\n\n  // scan height and name of each forward\n  for (let thisForward of forwards) {\n    const network = thisForward.network\n    const forwardHeight = thisForward.updateHeight\n    if (forwardHeight === txHeight) {\n      // commands are identified via a string (starts with !)\n      if (network.startsWith(command)) {\n        // found it so return in\n        return thisForward\n      }\n    }\n  }\n\n  return undefined\n}\n\n// Describe: update current derivedUtxoList from tx\n// Since utxo in question are the notificaiton address utxo,\n// they will always be part of txHistory\nexport const updateUtxoFromTx = (st: I_BnsState, tx: I_TX): void => {\n  const notificationAddress = getNotificationAddress(st)\n\n  // scan every tx input for notification address and remove those from utxo set\n  tx.vin.forEach((input: any) => {\n    // can scan by previous address or by current utxo list's txid+vout pairs\n    if (input.prevout.scriptpubkey_address === notificationAddress) {\n      const txid = input.txid\n      const vout = input.vout\n      // find first match with these values in derivedUtxoList\n      const spentUtxoIndex = st.domain.derivedUtxoList.findIndex(utxo => (\n        utxo.txid === txid && utxo.vout === vout\n      ))\n      // remove element at the position found\n      // utxo can only be spent once so first match ok\n      st.domain.derivedUtxoList.splice(spentUtxoIndex, 1)\n    }\n  })\n\n  // scan every tx output for notification address and add those to utxo set\n  tx.vout.forEach((output: any, vout: number) => {\n    if (output.scriptpubkey_address === notificationAddress) {\n      // if output address is notification address, it's always new utxo\n      // mark from address as address @ input 0 of the tx\n      st.domain.derivedUtxoList.push({\n        txid: tx.txid,\n        vout: vout,\n        status: tx.status,\n        value: output.value,\n        from_scriptpubkey_address: getTxInput0SourceUserAddress(tx)\n      } as I_UTXO)\n    }\n  })\n}\n\n// returns true only if there are no utxo (at notification address)\n// where the sender address (input[0] in the past) is the same as\n// the sender address of this tx (input[0])\nexport const noUnspentUserNotificationsUtxo = (st: I_BnsState, tx: I_TX): boolean => {\n  // sender address of this tx\n  const userOfTxAddress = getTxInput0SourceUserAddress(tx)\n  const txHeight = getTxHeight(tx)\n\n  // go through all derived utxo and make sure none are from this sender\n  for (let utxo of st.domain.derivedUtxoList) {\n    // user that created this utxo\n    const userThatCreatedThisUtxo = utxo.from_scriptpubkey_address\n\n    // block height of utxo creation\n    const utxoHeight = utxo.status.block_height\n\n    // only utxo formed before this tx height matter\n    // this tx would've likely created a new utxo that shouldn't count\n    const isInThePast = utxoHeight < txHeight\n\n    // all utxo in derived set should have from address\n    !userThatCreatedThisUtxo && console.log(\n      'st.domain.derivedUtxoList for some reason has undefined from_scriptpubkey_address'\n    )\n    // if even 1 matches, the check failed\n    if ((userThatCreatedThisUtxo === userOfTxAddress) && isInThePast) {\n      return false\n    }\n  }\n\n  // only gets this far if no utxo creators match our current tx user\n  return true\n}\n\n\n/**\n * Reset bidding.\n */\nexport const resetBidding = (st: I_BnsState): void => {\n  st.domain.bidding = { ...JSON.parse(JSON.stringify(newState.domain.bidding)) }\n}\n\n/**\n * Start bidding period.\n */\nexport const startBidding = (st: I_BnsState, tx: I_TX, type: BnsBidType) => {\n  const txHeight = getTxHeight(tx)\n\n  // reset bidding object just in case\n  resetBidding(st)\n\n  // start bidding pediod and set type\n  st.domain.bidding.startHeight = txHeight\n  st.domain.bidding.endHeight = txHeight + CHALLENGE_PERIOD_DURATION_BY_BLOCKS\n  st.domain.bidding.type = type\n\n  console.log('Bidding period started at height', txHeight, 'until', txHeight + CHALLENGE_PERIOD_DURATION_BY_BLOCKS)\n}\n\n/**\n * Add new bid.\n */\nexport const addBid = (st: I_BnsState, tx: I_TX, type: BnsBidType): void => {\n  const userAddress = getTxInput0SourceUserAddress(tx);\n  const txHeight = getTxHeight(tx)\n  const burnValue = getTxOutput0BurnValue(tx)\n\n  // if bidding hasn't started\n  if (txHeight > st.domain.bidding.endHeight) {\n    startBidding(st, tx, type)\n  }\n\n  // add this new bid to bids\n  const bids = st.domain.bidding.bids\n  const bid: I_Bid = {\n    height: txHeight,\n    timestamp: getTxTimestamp(tx),\n    address: userAddress,\n    value: burnValue,\n    valueLeftToRefund: burnValue, // initially same as value\n    blockHash: tx.status.block_hash\n  }\n  bids.push(bid)\n\n  console.log('New bid from', userAddress, 'for', burnValue)\n}\n\n/**\n * Return true only if bidding was happening and hasn't been resolved yet into a winner.\n */\nexport const isBiddingOver = (st: I_BnsState): boolean => {\n  // current parsed height (updated elsewhere)\n  const parsedHeight = st.chain!.parsedHeight\n\n  const biddingType = st.domain.bidding.type\n  const endHeight = st.domain.bidding.endHeight\n\n  // real bidding type still assigned but height is at or above end height for bidding\n  if ((biddingType !== BnsBidType.NULL) && (endHeight <= parsedHeight)) {\n    return true\n  }\n  return false\n}\n\n/**\n * Return true if there's a current bidding period.\n */\nexport const isBiddingOngoing = (st: I_BnsState): boolean => {\n  if (!st.chain) throw new Error ('called st.chain without it defined')\n\n  // current parsed height (updated elsewhere)\n  const parsedHeight = st.chain!.parsedHeight\n\n  const biddingType = st.domain.bidding.type\n  const endHeight = st.domain.bidding.endHeight\n  const startHeight = st.domain.bidding.startHeight\n\n  // real bidding type still assigned but height is at or above end height for bidding\n  if ((biddingType !== BnsBidType.NULL) && (parsedHeight < endHeight) && (parsedHeight >= startHeight)) {\n    console.log('', parsedHeight, 'Action falls within bidding period.')\n    return true\n  }\n  return false\n}\n\n/**\n* Return true if address is one of the bidders.\n*/\nexport const isAddressACurrentBidder = (st: I_BnsState, address: string): boolean => {\n  if (!isBiddingOngoing) return false\n\n  for (let i = 0; i < st.domain.bidding.bids.length; i++) {\n    const bid = st.domain.bidding.bids[i]\n    // if any bid address matches address provided return true\n    if (bid.address === address) return true\n  }\n\n  return false // no match found\n}\n\n\n/**\n * Return true if user is one of the bidders.\n */\nexport const isSenderACurrentBidder = (st: I_BnsState, tx: I_TX): boolean => {\n  const userAddress = getTxInput0SourceUserAddress(tx)\n  return isAddressACurrentBidder(st, userAddress)\n}\n\n\n/**\n * Subtract refunded amounts from active bids.\n */\nexport const subtractRefunds = (st: I_BnsState, tx: I_TX):void => {\n  const txUserAddress = getTxInput0SourceUserAddress(tx)\n  const bids = st.domain.bidding.bids\n\n  // create paidTo object with addresses as key for all refunds in the tx\n  // (step to prevent O(N^2) scaling)\n  const paidTo: { [address: string]: number } = {}\n  for (let output of tx.vout) {\n    const toAddress = output.scriptpubkey_address\n    const toAmount = output.value\n\n    if (\n      (toAddress !== undefined) &&    // type of output that has an target address\n      (txUserAddress !== toAddress)   // isn't from the same address (sender === receiver is change, not refund)\n    ) {\n      // set paid amount or add onto existing\n      paidTo[toAddress] ? (paidTo[toAddress] += toAmount) : (paidTo[toAddress] = toAmount)\n    }\n\n  }\n  // paidTo object done\n\n  // Apply paid object onto all bids\n  for (let i = 0; i < bids.length; i++) {\n    const thisBid = bids[i]\n    const thisBidAddress = thisBid.address\n\n    console.assert(thisBid.height >= st.domain.bidding.startHeight, `Bid height outside allowed range.`)\n    console.assert(thisBid.height < st.domain.bidding.endHeight, `Bid height outside allowed range.`)\n\n    // if paid to this address\n    if (paidTo[thisBidAddress] !== undefined) {\n\n      // each counted refund falls within range\n      // [0, min(total refunds paid, left to refund for this bid)]\n      // so valueLeftToRefund is 0 or positive only\n      const refund = Math.max(Math.min(paidTo[thisBidAddress], thisBid.valueLeftToRefund), 0)\n\n      // subtract out the refund from both paid amount and valueLeftToRefund\n      thisBid.valueLeftToRefund -= refund\n      paidTo[thisBidAddress] -= refund\n    }\n  }\n}\n\n/**\n * Return array of bids with only unrefunded bids.\n */\nexport const unrefundedBidsOnly = (st: I_BnsState): Array<I_Bid> => {\n  const bids = st.domain.bidding.bids\n\n  const unrefundedBids: Array<I_Bid> = bids.filter((thisBid: I_Bid) => {\n    return thisBid.valueLeftToRefund > 0\n  })\n\n  return unrefundedBids\n}\n\n/**\n * Return object with only addresses to refund as key and amounts left to refund as value.\n */\nexport const unrefundedAmounts = (st: I_BnsState): { [key: string]: number } => {\n  const unrefundedBids = unrefundedBidsOnly(st)\n\n  const amounts = unrefundedBids.reduce((refundsLeft: any, thisBid: I_Bid) => {\n    const address = thisBid.address\n    const amount = thisBid.valueLeftToRefund\n    // sums up amount left to refund per address\n    return refundsLeft[address]\n      ? {...refundsLeft, [address]: refundsLeft[address] + amount}\n      : {...refundsLeft, [address]: amount }\n  }, {})\n\n  // console.log('unrefunded amounts:', amounts)\n\n  return amounts\n}\n\n/**\n * Set new owner from bidding period.\n * Note: can be called unknown number of blocks after bidding period ended.\n */\nexport const endBidding = (st: I_BnsState): void => {\n  // Rules for who wins bidding:\n  // 1. List of all bids and how much they paid - have that in domain.bidding.bids.\n  // 2. Remove all bids that have any prior (lower height) bids from other addresses that were not refunded.\n  // 3. First potential winner is the first bid.\n  //    At same height, winner is derived from deterministic pseudorandom function (using block's hash) weighted by bid amount.\n  //    At increasing heights, new winner is who bid at least CHALLENGE_MIN_MULTIPLY times prior (lower height) winner's bid.\n\n  // Step (1)\n  const bids = st.domain.bidding.bids\n  const unrefundedBids = unrefundedBidsOnly(st)\n\n  // Step (2)\n\n  // get all bids that refunded priors\n  const goodBidsThatRefunded: Array<I_Bid> = []\n\n  for (let thisBid of bids) {\n\n    console.assert(thisBid.height >= st.domain.bidding.startHeight, `Bid height outside allowed range.`)\n    console.assert(thisBid.height < st.domain.bidding.endHeight, `Bid height outside allowed range.`)\n\n\n    const thisBidHeight = thisBid.height\n\n    // check if any unrefunded past bids\n    const hasUnrefundedPastBids = unrefundedBids.some((thisUnrefundedBid: I_Bid) => {\n      // return false if this isn't an unrefunded bid that matters\n\n      // must not have unrefunded bids at lower height\n      if (thisUnrefundedBid.height >= thisBidHeight) return false\n      // only different addresses matter\n      if (thisUnrefundedBid.address === thisBid.address) return false\n\n      return true\n    })\n\n    // if no unrefunded bids in the past, add to goodBidsThatRefunded\n    if (!hasUnrefundedPastBids) {\n      goodBidsThatRefunded.push(thisBid)\n    }\n  }\n\n  // Step (3)\n  // now with only a list of good bids with refunded priors, parse through them\n  // to check that each bid at higher height paid/burned at least *(CHALLENGE_MIN_MULTIPLY) of next lower height bid\n  let winner: I_Bid = {\n    address: '',\n    height: 0,\n    timestamp: 0,\n    value: 0,\n    valueLeftToRefund: 0,\n    blockHash: ''\n  }\n  let validBidsAtLastHeight: Array<I_Bid> = []\n  let lastHeight = 0\n  let maxBidIndex = goodBidsThatRefunded.length - 1\n  for (let bidIndex = 0; bidIndex <= maxBidIndex; bidIndex++) {\n    const thisBid = goodBidsThatRefunded[bidIndex]\n\n    // get height from bid\n    const thisHeight = thisBid.height\n\n    if (thisBid.height > lastHeight) {\n      // this means height went up so need to resolve previous heights:\n      // set  winner from X possible winners in the array from previous height\n      // if no entries, no change to winner\n\n      // get winner from array of previous bid height winners\n      winner = deterministicRandomBid(validBidsAtLastHeight) || winner\n\n      // reset validBidsAtLastHeight\n      validBidsAtLastHeight = []\n    }\n\n    // only push into bids array if it meets minimum criteria\n    // compared with winner of lower height calculated this round or before\n    const hasThisBidPaidEnough = thisBid.value >= (CHALLENGE_MIN_MULTIPLY * winner.value)\n\n    if (hasThisBidPaidEnough) {\n      validBidsAtLastHeight.push(thisBid)\n    }\n\n    // set last height based on this parsed bid\n    lastHeight = thisHeight\n\n    // final item update only (since there's no more bids after to step height)\n    if (bidIndex === maxBidIndex) {\n      // calc winner from array of same height bids, if possible\n      winner = deterministicRandomBid(validBidsAtLastHeight) || winner\n    }\n  }\n\n  // if there's a winner (should be, at least initial bid)\n  if (winner.address !== '') {\n    // set winner to owner\n    setOwner(st, winner.address)\n    getOwner(st)!.burnAmount = winner.value\n    getOwner(st)!.winHeight = winner.height\n    getOwner(st)!.winTimestamp = winner.timestamp\n    console.log('', winner.height, 'Bidding winner and new owner is', winner.address)\n\n    // resets all active bidding info, sets it to null values\n    resetBidding(st)\n\n  } else {\n    throw new Error('There should be no cases without a winner since at least 1st bid wins')\n  }\n}","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P1RestoreOrBackup_wrapper__32TQJ\",\"title\":\"P1RestoreOrBackup_title__2rH-6\",\"contentWrapper\":\"P1RestoreOrBackup_contentWrapper__1NT85\",\"buttonWrapper\":\"P1RestoreOrBackup_buttonWrapper__2ryAq\",\"describe\":\"P1RestoreOrBackup_describe__1RMqs\",\"orange\":\"P1RestoreOrBackup_orange__3V9sL\",\"spacer\":\"P1RestoreOrBackup_spacer__3luud\",\"backup\":\"P1RestoreOrBackup_backup__357rd\",\"restoreBackup\":\"P1RestoreOrBackup_restoreBackup__VUHgs\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P4ActionChoice_wrapper__2u2J5\",\"title\":\"P4ActionChoice_title__2PdRs\",\"availableActions\":\"P4ActionChoice_availableActions__1O5aS\",\"inputForms\":\"P4ActionChoice_inputForms__3vlaZ\",\"okButton\":\"P4ActionChoice_okButton__lq4sl\",\"unavailableActions\":\"P4ActionChoice_unavailableActions__3rEYI\",\"buttonWrapper\":\"P4ActionChoice_buttonWrapper__3Sx3Y\",\"orange\":\"P4ActionChoice_orange__6-7sA\",\"unavailableActions__title\":\"P4ActionChoice_unavailableActions__title__2EQ4_\",\"unavailableActions__actionList\":\"P4ActionChoice_unavailableActions__actionList__1VAc_\",\"unavailableActions__actionList__action\":\"P4ActionChoice_unavailableActions__actionList__action__GMwoW\",\"unavailableActions__actionList__action__title\":\"P4ActionChoice_unavailableActions__actionList__action__title__3ljZU\",\"unavailableActions__actionList__action__permissionList\":\"P4ActionChoice_unavailableActions__actionList__action__permissionList__2pKeq\",\"unavailableActions__actionList__action__permissionList__permission\":\"P4ActionChoice_unavailableActions__actionList__action__permissionList__permission__2eF7F\",\"breakable\":\"P4ActionChoice_breakable__x4Qcm\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P2LoadWallet_wrapper__vI_bb\",\"title\":\"P2LoadWallet_title__8Dw43\",\"contentWrapper\":\"P2LoadWallet_contentWrapper__UNLo4\",\"buttonWrapper\":\"P2LoadWallet_buttonWrapper__1rrct\",\"button\":\"P2LoadWallet_button__1A8-S\",\"address\":\"P2LoadWallet_address__37xx2\",\"orange\":\"P2LoadWallet_orange__UP8xH\",\"imgQr\":\"P2LoadWallet_imgQr__3Avh3\",\"backAndReady\":\"P2LoadWallet_backAndReady__3oVit\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P6Broadcast_wrapper__32tq-\",\"title\":\"P6Broadcast_title__2fzea\",\"fees\":\"P6Broadcast_fees__STZ2e\",\"txSummary\":\"P6Broadcast_txSummary__24FzE\",\"status\":\"P6Broadcast_status__3SsMv\",\"totalCost\":\"P6Broadcast_totalCost__Agr2T\",\"buttonWrapper\":\"P6Broadcast_buttonWrapper__ROAk6\",\"status__button\":\"P6Broadcast_status__button__fFvc3\",\"status__failed\":\"P6Broadcast_status__failed__1moa8\",\"balance\":\"P6Broadcast_balance__1ZVur\"};","import * as bitcoin from 'bitcoinjs-lib'\r\nimport bip39 from 'bip39'\r\nconst varuint = require('varuint-bitcoin');\r\n\r\n\r\n/**\r\n * Make new mnemonic for p2wpkh m/44'/0'/0'/0/0 address and WIF.\r\n * @param     {string}    strNetwork    String describing network ('bitcoin', 'testnet').\r\n * @returns   {object}                  Object { mnemonic, WIF, address } - all strings.\r\n */\r\nexport const createNewWallet = (strNetwork: string) => {\r\n  // network version. bitcoin or testnet\r\n  const network = bitcoin.networks[strNetwork]\r\n  // create backup phrase\r\n  const mnemonic = bip39.generateMnemonic() // 128 bit & randomBytes by default\r\n  const seedBuffer = bip39.mnemonicToSeed(mnemonic)\r\n  // create derivation master node\r\n  const masterNode = bitcoin.bip32.fromSeed(seedBuffer, network)\r\n  // derive m/44'/0'/0'/0 /0 node\r\n  const childNode0 = masterNode.derivePath(\"m/44'/0'/0'\").derivePath(\"0/0\")\r\n  // get private key in wallet import format for that child node\r\n  const WIF = childNode0.toWIF()\r\n  // derive a standard p2wpkh address from that WIF\r\n  const keyPair = bitcoin.ECPair.fromWIF(WIF, network)\r\n  const address = bitcoin.payments.p2wpkh({ pubkey: keyPair.publicKey, network }).address\r\n\r\n  return { mnemonic, WIF, address }\r\n}\r\n\r\n/**\r\n * Load p2wpkh m/44'/0'/0'/0/0 wallet info from mnemonic.\r\n * @param     {string}    strMnemonic     Mnemonic string of 12 words as described in bip39.\r\n * @param     {string}    strNetwork      String describing network ('bitcoin', 'testnet').\r\n * @returns   {object}                    Object { mnemonic, WIF, address } - all strings.\r\n */\r\nexport const loadWallet = (strMnemonic: string, strNetwork: string) => {\r\n  // network version. bitcoin or testnet\r\n  const network = bitcoin.networks[strNetwork]\r\n  const seedBuffer = bip39.mnemonicToSeed(strMnemonic)\r\n  // create derivation master node\r\n  const masterNode = bitcoin.bip32.fromSeed(seedBuffer, network)\r\n  // derive m/44'/0'/0'/0 /0 node\r\n  const childNode0 = masterNode.derivePath(\"m/44'/0'/0'\").derivePath(\"0/0\")\r\n  // get private key in wallet import format for that child node\r\n  const WIF = childNode0.toWIF()\r\n  // derive a standard p2wpkh address from that WIF\r\n  const keyPair = bitcoin.ECPair.fromWIF(WIF, network)\r\n  const address = bitcoin.payments.p2wpkh({ pubkey: keyPair.publicKey, network }).address\r\n\r\n  return { mnemonic: strMnemonic, WIF, address }\r\n}\r\n\r\n\r\n//\r\n/**\r\n * Parse UTXO array to get total unspent balance in satoshi.\r\n * @param     {Array}    utxoArray      Array of UTXO objects with '.value' field in satoshi.\r\n * @returns   {number}                  Total number of unspent satoshi.\r\n */\r\nexport function getUnspentSum(utxoArray: Array<any>): number {\r\n\r\n  const sumSats = utxoArray?.reduce(\r\n    (sum: number, utxo: any) => sum + utxo.value\r\n    , 0) || 0\r\n\r\n  return sumSats\r\n}\r\n\r\n\r\n/**\r\n * Finalize outputs that require custom scripts.\r\n * Based on based on https://github.com/bitcoinjs/bitcoinjs-lib/blob/master/test/integration/csv.spec.ts\r\n */\r\nexport const getFinalScripts = ({ inputScript, network }: any) => {\r\n  return function (\r\n    inputIndex: number,\r\n    input: any,\r\n    script: Buffer,\r\n    isSegwit: boolean,\r\n    isP2SH: boolean,\r\n    isP2WSH: boolean,\r\n  ): {\r\n    finalScriptSig: Buffer | undefined;\r\n    finalScriptWitness: Buffer | undefined;\r\n  } {\r\n    // Step 1: Check to make sure the meaningful script matches what you expect.\r\n\r\n    // Step 2: Create final scripts\r\n    let payment: any = {\r\n      network,\r\n      output: script,\r\n      input: inputScript,\r\n    };\r\n    if (isP2WSH && isSegwit)\r\n      payment = bitcoin.payments.p2wsh({\r\n        network,\r\n        redeem: payment,\r\n      });\r\n    if (isP2SH)\r\n      payment = bitcoin.payments.p2sh({\r\n        network,\r\n        redeem: payment,\r\n      });\r\n\r\n    function witnessStackToScriptWitness(witness: Buffer[]): Buffer {\r\n      let buffer = Buffer.allocUnsafe(0);\r\n\r\n      function writeSlice(slice: Buffer): void {\r\n        buffer = Buffer.concat([buffer, Buffer.from(slice)]);\r\n      }\r\n\r\n      function writeVarInt(i: number): void {\r\n        const currentLen = buffer.length;\r\n        const varintLen = varuint.encodingLength(i);\r\n\r\n        buffer = Buffer.concat([buffer, Buffer.allocUnsafe(varintLen)]);\r\n        varuint.encode(i, buffer, currentLen);\r\n      }\r\n\r\n      function writeVarSlice(slice: Buffer): void {\r\n        writeVarInt(slice.length);\r\n        writeSlice(slice);\r\n      }\r\n\r\n      function writeVector(vector: Buffer[]): void {\r\n        writeVarInt(vector.length);\r\n        vector.forEach(writeVarSlice);\r\n      }\r\n\r\n      writeVector(witness);\r\n\r\n      return buffer;\r\n    }\r\n\r\n    return {\r\n      finalScriptSig: payment.input,\r\n      finalScriptWitness:\r\n        payment.witness && payment.witness.length > 0\r\n          ? witnessStackToScriptWitness(payment.witness)\r\n          : undefined,\r\n    };\r\n  }\r\n}","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P3DomainAndWallet_wrapper__1ElFg\",\"contentWrapper\":\"P3DomainAndWallet_contentWrapper__vm5qp\",\"title\":\"P3DomainAndWallet_title__3ing2\",\"domainInfo\":\"P3DomainAndWallet_domainInfo__3p2aJ\",\"domainButton\":\"P3DomainAndWallet_domainButton__2PIDz\",\"walletInfo\":\"P3DomainAndWallet_walletInfo__2cQY0\",\"walletButton\":\"P3DomainAndWallet_walletButton__MmLZ3\",\"unspent\":\"P3DomainAndWallet_unspent__bUWZW\",\"buttonWrapper\":\"P3DomainAndWallet_buttonWrapper__djJkL\",\"ownership\":\"P3DomainAndWallet_ownership__lSY6a\",\"balance\":\"P3DomainAndWallet_balance__2fns7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"lblMainTitle\":\"HomeContent_lblMainTitle__1LqCG\",\"lblMainTitleAfter\":\"HomeContent_lblMainTitleAfter__J9CsB\",\"results\":\"HomeContent_results__3QLFo\",\"divSearch\":\"HomeContent_divSearch__3dKw5\",\"divSearchAfter\":\"HomeContent_divSearchAfter__2MAMf\",\"txtSearch\":\"HomeContent_txtSearch__3HpSp\",\"wrapper\":\"HomeContent_wrapper__mPINc\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"divDev\":\"DevPanel_divDev__2q66m\",\"hidden\":\"DevPanel_hidden__Wlj3v\",\"btnOutline\":\"DevPanel_btnOutline__2FJLx\",\"button\":\"DevPanel_button__1DKHt\"};","import React from 'react'\n// import { Store } from './../../store/'\nimport styles from './AboutContent.module.css'\nimport image from './graphic.png'\n\n\nexport const AboutContent = () => {\n  // const { state } = React.useContext(Store)\n\n  return (\n    <>\n      <div className={ [styles.wrapper, 'scrollbar'].join(' ') }>\n        <div className={ styles.title }>\n          <div>\n            Your <span>Bitcoin</span> domain\n            &nbsp;=&nbsp;\n          </div>\n          <div>\n            &nbsp;infinite forwarding addresses\n          </div>\n        </div>\n\n        <div className={ styles.contentWrapper }>\n\n          <img\n            className = { styles.drawing }\n            src={ image }\n            alt='graphic'\n          />\n\n          <p>\n            <span>Bitcoin</span> Domain System (<span>BNS</span>): easy to read custom domain names (i.e. aliases) that can store unlimited forwarding information to long alphanumeric btc addresses or any other types of addreses (e.g. ipfs, https, twitter, ...).\n          </p>\n\n          <p>\n            All <span>BNS</span> data is stored inside transactions on the <span>Bitcoin</span> blockchain. This means that <span>BNS</span> is protected by the most secure, decentralized, permissionless, and censorship resistant public network ever created.\n          </p>\n\n          <a\n            href=\"https://github.com/ildarmgt/BitcoinNameSystem/blob/master/README.md\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            more on github\n          </a>\n\n        </div>\n\n\n      </div>\n    </>\n  )\n}\n","import React from 'react'\nimport { AboutContent } from './../components/AboutContent'\n\nexport function About(): JSX.Element {\n\n  return (\n    <>\n      <AboutContent />\n    </>\n  )\n}\n\n// for lazy loading:\n// const RoundButton = React.lazy<any>(() => import('../components/RoundButton')\n// <React.Suspense\n//   fallback={\n//     <div>loading...</div>\n//   }\n// >\n// </React.Suspense>\n","import {\n  I_Domain,\n  I_TX,\n  I_UTXO,\n  I_Checked_Action\n} from './../helpers/bns/types/'\n\n/**\n * All the interfaces & enums\n */\n\nexport * from './../helpers/bns/types/'\n\n// for global state \"Store\" action creators\nexport enum ActionTypes {\n  STORE_SEARCH_RESULTS = 'STORE_SEARCH_RESULTS',\n  STORE_SEARCH_RESULTS_FAIL = 'STORE_SEARCH_RESULTS_FAIL',\n  TYPING = 'TYPING',\n  NEW_WALLET = 'NEW_WALLET',\n  CHANGE_PAGE_INFO = 'CHANGE_PAGE_INFO',\n  UPDATE_WALLET = 'UPDATE_WALLET',\n  UPDATE_DOMAIN = 'UPDATE_DOMAIN',\n  ACTION_FAIL = 'ACTION_FAIL',\n  LOAD_STATE = 'LOAD_STATE',\n  CHOICES_BNS_ACTION = 'CHOICES_BNS_ACTION'\n}\n\n// for global state reducer\nexport type Dispatch = React.Dispatch<I_Action>\n\n// for global state \"Store\" actions\nexport interface I_Action {\n  type: ActionTypes\n  payload: any\n}\n\nexport interface I_State {\n  network: string\n  alias: string\n  extension: string\n  domain: I_Domain\n  wallet: {\n    address: string\n    mnemonic: string\n    WIF: string\n    txHistory:  Array<I_TX>\n    utxoList: Array<I_UTXO>\n  }\n  chain: {\n    height: number\n  }\n  choices: {\n    apiPath: {\n      [network: string]: string\n    }\n    action: I_Checked_Action | {}\n    feeRate: number\n    txHex: string\n    embedString: string\n  }\n  pageInfo: {\n    current: number\n    checkedDomain: boolean\n    checkedWallet: boolean\n    checkedLightSearch: boolean\n  }\n  lastTimeStamp: number\n}\n","import { I_State, I_Action, ActionTypes } from '../../interfaces'\nimport { initialState } from './../index.js'\nconst {\n  STORE_SEARCH_RESULTS_FAIL,\n  STORE_SEARCH_RESULTS,\n  TYPING,\n  NEW_WALLET,\n  CHANGE_PAGE_INFO,\n  UPDATE_WALLET,\n  UPDATE_DOMAIN,\n  ACTION_FAIL,\n  LOAD_STATE,\n  CHOICES_BNS_ACTION\n} = ActionTypes\n\n/**\n * Reducer edits global state via information in payload.\n * Action is object { payload, type }.\n * type describes what type of changes to global state to make.\n * payload contains data provided to make those changes.\n */\nexport default function reducer (state: I_State, action: I_Action): I_State {\n  const { payload } = action\n\n  switch (action.type) {\n\n    case CHOICES_BNS_ACTION: {\n      // BNS action chosen\n      return {\n        ...state,\n        choices: {\n          ...state.choices,\n          ...payload\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case UPDATE_WALLET: {\n      // after full scan of the wallet address\n      return {\n        ...state,\n        wallet: {\n          ...state.wallet, // wif/mnemonic/address unchanged\n          txHistory: payload.wallet.txHistory,\n          utxoList: payload.wallet.utxoList\n        },\n        pageInfo: {\n          ...state.pageInfo,\n          checkedWallet: true\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case UPDATE_DOMAIN: {\n      return {\n        ...state,\n        domain: {\n          ...payload.domain\n        },\n        chain: {\n          height: payload.chain.height\n        },\n        pageInfo: {\n          ...state.pageInfo,\n          checkedDomain: true\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case CHANGE_PAGE_INFO:\n      // navigation info for controlling domains\n      return {\n        ...state,\n        pageInfo: {\n          ...state.pageInfo,\n          current: payload\n        }\n      }\n\n    case NEW_WALLET: {\n      // store totally new wallet object\n      return {\n        ...state,\n        wallet: {\n          ...initialState.wallet,\n          address: payload.address,\n          mnemonic: payload.mnemonic,\n          WIF: payload.WIF\n        },\n        pageInfo: {\n          ...state.pageInfo,\n          checkedWallet: false\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case STORE_SEARCH_RESULTS: {\n      // store results of looking up totally new alias\n      // update notifications and ownership information\n\n      return {\n        ...state,\n        alias: payload.alias,\n        domain: {\n          ...initialState.domain,\n          ...payload.domain\n        },\n        chain: {\n          height: payload.chain.height\n        },\n        pageInfo: {\n          ...state.pageInfo,\n          checkedDomain: false,\n          checkedLightSearch: true\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case STORE_SEARCH_RESULTS_FAIL: {\n      // store results of looking up totally new alias\n      // reset notifications and ownership information\n      return {\n        ...state,\n        alias: payload.alias,\n        domain: {\n          ...initialState.domain,\n          domainName: payload.domainName,\n          notificationAddress: payload.notificationAddress\n        },\n        pageInfo: {\n          ...state.pageInfo,\n          checkedDomain: false,\n          checkedLightSearch: false\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case TYPING: {\n      // change of alias part of domain name\n      // this change renders owner and notification information outdated\n      return {\n        ...state,\n        alias: payload,\n        domain: initialState.domain,\n        pageInfo: {\n          ...state.pageInfo,\n          current: 1,\n          checkedDomain: false,\n          checkedLightSearch: false\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case ACTION_FAIL: {\n      return {\n        ...state,\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case LOAD_STATE: {\n      return {\n        ...payload,\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    default: {\n      console.warn('Unknown action type')\n      return state\n    }\n  }\n}\n\n// can split maybe like this later if gets too long\n// https://dev.to/vanderleisilva/global-state-management-with-react-hooks-and-context-5f6h\n\n","import { I_State } from '../interfaces'\nimport { newState } from './../helpers/bns/initialState'\n\n/* -------------------------------------------------------------------------- */\n/*                                initial state                               */\n/* -------------------------------------------------------------------------- */\n\nexport const initialState: I_State = {\n  network: 'testnet',             // 'testnet' or 'bitcoin'\n  alias: 'satoshi',               // first half of domain name\n  extension: '.btc',              // last half of domain name\n  domain: newState.domain,        // using BNS equivalent domain object\n  wallet: {                       // wallet information & utxo for controlling domain names\n    address: '',                  // public address (p2wpkh)\n    mnemonic: '',                 // mnemonic for private key derivation\n    WIF: '',                      // wallet import format for private key derivation\n    txHistory: [],                // array of all tx for this address\n    utxoList: [],                 // array of all current utxo for this address\n  },\n  chain: {\n    height: 0                     // height of blockchain\n  },\n  pageInfo: {                     // user navigation information for controlling domain name\n    current: 1,\n    checkedDomain: false,         // current domain notification address was scanned\n    checkedWallet: false,         // current wallet address was scanned\n    checkedLightSearch: false     // if light search was done (no utxo / txhex scan)\n  },\n  choices: {                      // choices made by user via this app\n    apiPath: {\n      bitcoin: 'https://blockstream.info/api/',\n      testnet: 'https://blockstream.info/testnet/api/'\n    },\n    action: {},                   // choices and data for action to take\n    feeRate: 1.1,                 // fee rate to use in sat/bByte,\n    txHex: '',                    // hex of raw transaction, ideally ready for broadcast\n    embedString: ''               // string to embed in op_return\n  },\n  lastTimeStamp: Date.now(),      // last change timestamp, to detect any changes to state or time out\n}","import React from 'react'\nimport reducer from './reducers/Reducer'\nimport { initialState } from './initialState'\n\n/* -------------------------------------------------------------------------- */\n/*                            Change state process                            */\n/* -------------------------------------------------------------------------- */\n\n// 1. Component calls action from src/store/actions/\n// 2. Action does stuff (e.g. API calls) and dispatches results to reducer in src/store/reducer/\n// 3. Reducer modifies state based on dispatched payload and type of action.\n\n/* -------------------------------------------------------------------------- */\n/*                             Global state setup                             */\n/* -------------------------------------------------------------------------- */\n\n// returns object with .Provider and .Consumer\n// Provider makes context available to all child components no matter how deep\nexport const Store = React.createContext<any>(initialState)\n\n\n// creates wrapping element for global state\nexport function StoreProvider ({ children }: JSX.ElementChildrenAttribute): JSX.Element {\n  const [state, dispatch] = React.useReducer(reducer, initialState)\n\n  // dev mode only (npm run start mode only, not built version!)\n  // const TESTING = (process.env.NODE_ENV === 'development')\n  // if (TESTING) {\n  //   localStorage.setItem('tempstate', JSON.stringify(state))\n  // }\n\n  return (\n    <Store.Provider value={{ state, dispatch }}>\n      { children }\n    </Store.Provider>\n  )\n}\n\n\n","import { I_State, BnsBidType } from '../interfaces'\n\n/* -------------------------------------------------------------------------- */\n/*                         Helper functions for state                         */\n/* -------------------------------------------------------------------------- */\n\n/**\n * get owner based on state, or undefined\n */\nexport const getOwner = (st: I_State) => {\n  const ownerAddress = st.domain.currentOwner\n  return st.domain.users[ownerAddress]\n}\n\n/**\n * Undefined if no user, otherwise existing user.\n */\nexport const getUser = (st: I_State, address: string) => {\n  return st.domain.users[address]\n}\n\n/**\n * Get if bidding for ownership period is happening and bidding object.\n */\nexport const getBidding = (st: I_State) => {\n  const bidding = st.domain.bidding\n  return {\n    isBurn: bidding.type === BnsBidType.BURN,\n    bidding\n  }\n}\n\n// show BTC balance with styling and proper units based on network\nexport const unitsBTC = (st: I_State) => (st.network === 'testnet') ? 'tBTC' : 'BTC'\n\nexport const satsToBTC = (sats: number): string => (sats / 1e8).toFixed(8)\n\n// easier visually to count satoshi via spaces\n// 123.876 543 21\nexport const satsToBTCSpaced = (sats: number): string => {\n  let styling = (sats / 1e8).toFixed(8).split('')\n\n  // insert space 5 chars from end\n  styling = [...styling.slice(0, -5), '\\xa0', ...styling.slice(-5)]\n  // insert another space 2 char from end\n  styling = [...styling.slice(0, -2), '\\xa0', ...styling.slice(-2)]\n\n  return styling.join('')\n}","import React, { useEffect, useState } from 'react'\nimport styles from './CreateHeader.module.css'\nimport { Store } from '../../../store/'\nimport { useHistory } from 'react-router-dom'\n\n// restore backup or create new\nexport const CreateHeader = () => {\n  // global state\n  const { state } = React.useContext(Store)\n\n  const domainName = state.alias + state.extension\n\n  // navigation object\n  const history = useHistory()\n\n  // Make sure entire alias is always visible on top through\n  // resizing based on letter count.\n  //\n  // get window width in component instance state 'width'\n  // so can resize alias based on char count\n  const [ width, setWidth ] = useState(window.innerWidth)\n  useEffect(() => {\n    const resize = () => { setWidth(window.innerWidth) }\n    window.addEventListener('resize', resize);\n    return () => window.removeEventListener('resize', resize);\n  }, [])\n\n  // enforces max size to font size so 1 letter alias has same font as 19 letter alias\n  const fontScale = Math.min(\n      Math.floor(1.1 * width / domainName.length),\n      Math.floor(1.1 * width / 15)\n  )\n\n  const barHeight = { height: (0.13 * width + 0.4 * fontScale).toString() + 'px' }\n  const aliasMarginTop = { marginTop: (0.02 * width - 0.1 * fontScale).toString() + 'px' }\n  const aliasFontSize = { fontSize: fontScale.toString() + 'px' }\n\n  return (\n    <div className={ styles.wrapper }>\n      <div\n        className={ styles.cutOverflow }\n        style={ barHeight }\n      >\n        <div\n          className={ styles.bar }\n          style={ barHeight }\n        />\n      </div>\n      <div\n        className={ styles.domain }\n        style={ aliasMarginTop }\n        onClick={ () => {\n          history.push('/')\n        } }\n      >\n        <span\n          className={ styles.alias }\n          style={ aliasFontSize }\n        >{ state.alias }</span>\n        <span\n          className={ styles.ext }\n          style={ aliasFontSize }\n        >{ state.extension }</span>\n      </div>\n      <div className={ styles.spacer } />\n    </div>\n  )\n}\n\n","import React from 'react'\nimport styles from './RoundButton.module.css'\n\n/**\n * Standard button for this app.\n *\n * Pass the following props to customize it.\n *\n * next='true' to add next arrow at right (off if undefined or '').\n *\n * back='true' to add back arrow on left (off if undefined or '').\n *\n * show='true' to display element vs show='false' to set display to none (dom still exists).\n *\n * sizebutton='2.9' to make the button size 2.9x standard var(--s) size used (defined in global global.css).\n *\n * colorbutton='var(--colorBitcoinOrange)' to customize color.\n *\n * colorbuttonText='var(--colorButtonText)' to customize text color.\n *\n * Defaults (vars defined in global global.css):\n *\n * sizebutton = 2.5. ( means font size calc(2.5/2.9 * var(--s)) )\n *\n * colorbutton = var(--colorBitcoinOrange).\n *\n * colorbuttontext = var(--colorButtonText).\n */\nexport const RoundButton = (props:any): JSX.Element => {\n  return (\n    <div\n      // variables defined by string will be available to button & its children for scope\n      style={ {\n        display: (\n          (props?.show === 'false') ? 'none' : 'inline-block'\n        ) as React.CSSProperties,\n        '--colorThisButton': (\n          props.colorbutton ? props.colorbutton : `var(--colorBitcoinOrange)`\n        )  as React.CSSProperties,\n        '--colorThisButtonText': (\n          props.colorbuttontext ? props.colorbuttontext : `var(--colorButtonText)`\n        ) as React.CSSProperties,\n        '--sizeButton': (\n          props.sizebutton\n          // Button was designed at 2.9 * var(--s) scale font so\n          // this just lets user redefine font & everything else proportionally\n            ? `calc(${props.sizebutton}/2.9 * var(--s))`\n            : `calc(2.5/2.9 * var(--s))`\n        ) as React.CSSProperties\n      } }\n      {...props}\n      className={ [\n        styles.roundButtonWrap,\n        props.back ? styles.back : '',\n        props.className\n      ].join(' ') }\n    >\n      <div\n        className={ [\n          styles.roundButton,\n          props.back ? styles.backArrowPad : undefined,\n          props.next ? styles.nextArrowPad : undefined,\n        ].join(' ') }\n      >\n\n        { (props.back) && (\n          <div\n            className={ styles.backArrow }\n          />\n        ) }\n\n        { props.children }\n\n        { (props.next) && (\n          <div\n            className={ styles.nextArrow }\n          />\n        ) }\n\n        <div\n          className={ styles.overhead }\n        />\n      </div>\n    </div>\n  )\n}\n","/**\r\n * Takes in a string of interest inputString\r\n * and Array of strings or string describing filter.\r\n * Returns the string of interst with only characters present in filters selected.\r\n */\r\nexport default function  sanitize (inputString, stringOrArray) {\r\n  // get choice input into same form of array of string(s) of choices\r\n  let choices; // :string | Array<string>\r\n  if (Array.isArray(stringOrArray)) {\r\n    choices = stringOrArray;\r\n  }\r\n  if (typeof stringOrArray === 'string') {\r\n    choices = [stringOrArray];\r\n  }\r\n\r\n  // add each choice to filter selection\r\n  // (set object would be fastest but these are only a few letters)\r\n\r\n  // string mask\r\n  let filter = '';\r\n  // array of functions\r\n  const logicFilters = [];\r\n\r\n  choices.forEach(choice => {\r\n\r\n    // short masks\r\n    if (choice === 'numbers') {\r\n      filter += '0123456789';\r\n    }\r\n    if (choice === 'fractions' || choice === 'number') {\r\n      filter += '0123456789.';\r\n    }\r\n    if (choice === 'decimal_point') {\r\n      filter += '.';\r\n    }\r\n    if (choice === 'hex') {\r\n      filter += '0123456789abcdefABCDEF';\r\n    }\r\n    if (choice === 'lowcaps') {\r\n      filter += 'abcdefghijklmnopqrstuvwxyz';\r\n    }\r\n    if (choice === 'highcaps') {\r\n      filter += 'ABCDEFGHIJKLMNOPQRSTUVWYZ';\r\n    }\r\n    if (choice === 'spaces') {\r\n      filter += ' ';\r\n    }\r\n\r\n    // longer masks\r\n    if (choice === 'base58') {\r\n      // https://en.wikipedia.org/wiki/Base58#cite_note-3\r\n      filter += '12345689ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';\r\n    }\r\n    if (choice === 'basic') {\r\n      filter += '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\n    }\r\n    if (choice === 'oneline') {\r\n      filter += '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,./-_!`~[]{}|@#%^&()-=?$';\r\n    }\r\n    if (choice === 'url') {\r\n      //  RFC 3986 (Section 2: Characters) 84 total\r\n      filter += `0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ:/?#[]@!$&'()*+,;=-_.~`;\r\n    }\r\n\r\n    // ========================================================\r\n    // functions\r\n    // adds anon function to array of functions\r\n\r\n    if (choice === 'no_spaces') {\r\n      logicFilters.push(str =>\r\n        str.split('')\r\n          .filter(letter => letter !== ' ')\r\n          .join(''))\r\n    }\r\n\r\n    if (choice === 'single_space_width') {\r\n      logicFilters.push(str =>\r\n        // split by 2+ spaces and replace with single space\r\n        str.split(/  */).join(' ')\r\n      )\r\n    }\r\n\r\n    // keep only first decimal point\r\n    if (choice === 'decimal_point') {\r\n\r\n      logicFilters.push(str =>\r\n        (str\r\n          // splits to array between .\r\n          .split('.')\r\n          // join first 2 elements with ., others with empty string\r\n          // returns a string\r\n          .reduce((resultingString, numbers, index) => {\r\n            // real . goes b/w array's index 0 and 1, even if string had . first\r\n            const digits = (index === 0 && numbers === '') ? '0' : numbers\r\n            return (index === 1)\r\n              ? [ resultingString, digits ].join('.')\r\n              : [ resultingString, digits ].join('')\r\n          }, '')\r\n        )\r\n      )\r\n    }\r\n\r\n    if (choice === 'no_leading_zeros') {\r\n\r\n      logicFilters.push(str =>\r\n        (str\r\n          // splits to array between .\r\n          .split('.')\r\n          .map((numbers, index) => {\r\n            if (index === 0) {\r\n              return (parseInt(numbers, 10) || 0).toString()\r\n            } else {\r\n              return numbers\r\n            }\r\n          })\r\n          .join('.')\r\n        )\r\n      )\r\n    }\r\n\r\n  })\r\n\r\n  if (filter.length === 0 && logicFilters.length === 0) {\r\n    console.warning('sanitize used w/o any known filters', stringOrArray)\r\n  }\r\n\r\n  let outputString = '';\r\n\r\n  // apply string mask to only keep characters within filter string\r\n  outputString = inputString\r\n    .split('')\r\n    .filter(letter => filter.indexOf(letter) > -1)\r\n    .join('');\r\n\r\n  // use every selected logic function on the outputString\r\n  logicFilters.forEach(fn => outputString = fn(outputString))\r\n\r\n  return outputString;\r\n}\r\n\r\n","import { I_State, Dispatch } from '../../interfaces'\nimport sanitize from '../../helpers/sanitize'\nimport { ActionTypes } from './../../interfaces'\nconst { TYPING } = ActionTypes;\n\n/**\n * Cleans up the entered string including removing next line characters\n */\nexport const changeAliasAction = async (state: I_State, dispatch: Dispatch, value: any) => {\n  // clean up the string\n  const newString = value\n  const sanitizedString = sanitize(newString, 'url')\n\n  return dispatch({\n    type: TYPING,\n    payload: sanitizedString\n  })\n}\n","import { I_Forward } from '../types'\n\n/**\n * Reads a single forward info object to interpret its values\n * as where the forwarding address should be used, what it is, and what link to use.\n * Returns {what: string, where: string, link: string, render: boolean}.\n */\nexport function interpretFw (fw: I_Forward, blockchain?: string) {\n  // blank address means it was removed\n  // ! at start means it's a command, not a network\n  if (fw.network === '' || fw.address === '' || fw.network.startsWith('!')) {\n    return {\n      render: false\n    }\n  }\n\n  // remove version modifier (anything after ! after network)\n  const onNetwork = fw.network.split('!')[0]\n\n  if (\n    onNetwork === 'p2wsh' ||\n    onNetwork === 'btc' ||\n    onNetwork === 'p2pkh' ||\n    onNetwork === 'p2wpkh' ||\n    onNetwork === 'p2sh'\n  ) {\n    return {\n      where: 'btc:',\n      what: (fw.address),\n      link: (\n        `https://blockstream.info/${blockchain === 'testnet' ? 'testnet/' : ''}address/` + (fw.address)\n      ),\n      render: true\n    }\n  }\n\n  if (\n    onNetwork === 'http' ||\n    onNetwork === 'https' ||\n    onNetwork === 'url' ||\n    onNetwork === 'web'\n  ) {\n    return {\n      where: 'https://',\n      what: (fw.address),\n      link: 'https://' + (fw.address),\n      render: true\n    }\n  }\n\n  if (onNetwork === 'twitter') {\n    return {\n      where: 'twitter.com/',\n      what: (fw.address),\n      link: 'https://twitter.com/' + (fw.address),\n      render: true\n    }\n  }\n\n  if (onNetwork === 'github') {\n    return {\n      where: 'github.com/',\n      what: (fw.address),\n      link: 'https://github.com/' + (fw.address),\n      render: true\n    }\n  }\n\n  if (onNetwork === 'youtube') {\n    return {\n      where: 'youtu.be/',\n      what: (fw.address),\n      link: 'https://www.youtube.com/watch?v=' + (fw.address),\n      render: true\n    }\n  }\n\n  return {\n    where: (onNetwork) + ' :',\n    what: ' ' + (fw.address),\n    link: undefined,\n    render: true\n  }\n}\n","import {\n  I_BnsState,\n  BnsActionType,\n  I_BNS_Action,\n  I_BNS_Auto_Action,\n  I_Condition,\n  I_TX,\n  BnsBidType,\n  BnsSuggestionType\n} from './../types/'\nimport {\n  MIN_NOTIFY,\n  MIN_BURN,\n  CHALLENGE_MIN_MULTIPLY\n} from './../constants'\nimport {\n  existsCurrentOwner,\n  isOwnerExpired,\n  clearOwner,\n  getParsedHeight,\n  atLeastTwoOutputs,\n  isNotify,\n  isOpreturnOutput0,\n  didNotifyMin,\n  didBurnMin,\n  setOwner,\n  getOwner,\n  getUser,\n  getTxInput0SourceUserAddress,\n  getTxHeight,\n  getTxTimestamp,\n  isAddressTheCurrentOwner,\n  burnedPreviousRateMin,\n  readEmbeddedData,\n  getLastOwnerBurnedValue,\n  isSenderTheCurrentOwner,\n  updateUtxoFromTx,\n  noUnspentUserNotificationsUtxo,\n  getNotificationAddress,\n  isCommandCalled,\n  getCommandCalled,\n  existsUser,\n  createNewUser,\n  addBid,\n  isBiddingOver,\n  endBidding,\n  isBiddingOngoing,\n  isSenderACurrentBidder,\n  isAddressACurrentBidder,\n  subtractRefunds,\n  unrefundedAmounts\n} from './../formathelpers'\n\n\n\n/* -------------------------------------------------------------------------- */\n/*                          Conditoins / Permissions                          */\n/* -------------------------------------------------------------------------- */\n\n// const NONE = (args: any): I_Condition => ({\n//   status: () => true,\n//   info: { describe: 'No requirements', warning: 'Placeholder only' }\n// })\n\nconst OUTS_2 = ({ tx=undefined }: any = {}): I_Condition => ({\n  status: () => atLeastTwoOutputs(tx),\n  info: { describe: 'Must have 2+ outputs' }\n})\n\nconst OUT_0 = ({ tx=undefined }: any = {}): I_Condition => ({\n  status: () => isOpreturnOutput0(tx),\n  info: { describe: 'Must have OP_RETURN @ output[0]' }\n})\n\nconst OUT_1 = ({ st, tx=undefined }: any = {}): I_Condition => ({\n  status: () => isNotify(st, tx),\n  info: { describe: 'Must have notification address @ output[1]' }\n})\n\nconst NOTIFIED_MIN = ({ tx=undefined }: any = {}): I_Condition => ({\n  status: () => didNotifyMin(tx),\n  info: {\n    describe: `Notification output amount must not be lower than the BNS minimum`,\n    set: { value: MIN_NOTIFY, name: 'Notification minimum', units: 'satoshi' }\n  }\n})\n\nconst BURNED_MIN = ({ tx=undefined }: any = {}): I_Condition => ({\n  status: () => didBurnMin(tx),\n  info: {\n    describe: `Must burn (i.e. bid) at least the BNS minimum amount`,\n    set: { value: MIN_BURN, units: 'satoshi', name: 'Bid burn amount' }\n  }\n})\n\nconst NO_OWNER = ({ st }: any = {}): I_Condition => ({\n  status: () => !existsCurrentOwner(st),\n  info: { describe: 'There must not be an existing owner' }\n})\n\nconst EXISTS_OWNER = ({ st }: any = {}): I_Condition => ({\n  status: () => existsCurrentOwner(st),\n  info: { describe: 'There must be existing owner' }\n})\n\nconst BURN_LAST_WIN = ({ st, tx=undefined }: any = {}): I_Condition => ({\n  status: () => burnedPreviousRateMin(st, tx),\n  info: {\n    describe: 'Tx must burn the last ownership winning burn amount',\n    set: { value: getLastOwnerBurnedValue(st), name: 'Bid burn amount', units: 'satoshi' }\n  }\n})\n\n// calculated based on tx if available, otherwise address\nconst USER_IS_OWNER = ({ st, address, tx=undefined }: any = {}): I_Condition => ({\n  status: () => tx ? isSenderTheCurrentOwner(st, tx) : isAddressTheCurrentOwner(st, address),\n  info: { describe: `User's address must match owner's address` }\n\n})\n\nconst USER_IS_BIDDER = ({ st, address, tx=undefined }: any = {}): I_Condition => ({\n  status: () => tx ? isSenderACurrentBidder(st, tx) : isAddressACurrentBidder(st, address),\n  info: { describe: `User's address must match one of bidder's addresses` }\n\n})\n\nconst IS_OWNER_EXPIRED = ({ st }: any = {}): I_Condition => ({\n  status: () => isOwnerExpired(st),\n  info: { describe: 'Ownership must be expired at current parsed height' }\n\n})\n\nconst NO_UNSPENT_USER_NOTIFICATIONS_UTXO = ({ st, tx=undefined }: any = {}): I_Condition => ({\n  status: () => noUnspentUserNotificationsUtxo(st, tx),\n  info: { describe: 'There must not be any remaining notification address utxo created by sender' }\n})\n\n// easy mistake to make\nconst USER_ADDRESS_NOT_NOTIFICATION_ADDRESS = ({ st, tx=undefined }: any = {}): I_Condition => ({\n  status: () => (getNotificationAddress(st) !== getTxInput0SourceUserAddress(tx)),\n  info: { describe: 'Do not accidentally send from notification address at input[0]' }\n})\n\nconst IS_COMMAND_CALLED = ({ st, command, tx=undefined }: any = {}): I_Condition => ({\n  status: () => (isCommandCalled(st, tx as I_TX, command)),\n  info: { describe: 'Checks forwards for a specific command issued at this height' }\n})\n\nconst IS_BIDDING_ONGOING = ({ st }: any = {}): I_Condition => ({\n  status: () => (isBiddingOngoing(st)),\n  info: { describe: 'The domain is undergoing a bidding period' }\n})\n\nconst IS_BIDDING_OVER = ({ st }: any = {}): I_Condition => ({\n  status: () => (isBiddingOver(st)),\n  info: { describe: 'The bidding period must be over but not resolved' }\n})\n\n/* -------------------------------------------------------------------------- */\n/*              Suggestions (e.g. values to set or get from user)             */\n/* -------------------------------------------------------------------------- */\n\nconst SUGGESTION_SUBMIT_NEW_ADDRESS = ({ command }: any = {}): I_Condition => ({\n  status: () => true,\n  info: {\n    describe: 'Submit your new address (forwards are kept)',\n    get: { value: '', name: 'Your new address' },\n    command\n  }\n})\n\nconst SUGGESTION_SUBMIT_NEW_OWNER_ADDRESS = ({ command }: any = {}): I_Condition => ({\n  status: () => true,\n  info: {\n    describe: 'Submit new owner\\'s address (forwards are not copied)',\n    get: { value: '', name: 'New owner\\'s address' },\n    command\n  }\n})\n\nconst SUGGESTION_SUBMIT_BURN_AMOUNT = ({ st }: any = {}): I_Condition => {\n  const calcMin = (!st\n    // default\n    ? undefined\n    // but when state provided:\n    : (\n        // and there are existing bids\n        st.domain.bidding.bids.length > 0\n          // return the highest of the bids\n          ? Math.ceil(Math.max(...st.domain.bidding.bids.map((bid: any) => bid.value)) * CHALLENGE_MIN_MULTIPLY)\n          // otherwise return burn minimum\n          : MIN_BURN\n    )\n  )\n\n  return {\n    status: () => true,\n    info: {\n      describe: 'Submit your bid burn amount',\n      get: {\n        value: calcMin || 0,\n        name: 'Bid burn amount' ,\n        // good guess for min next bid is CHALLENGE_MIN_MULTIPLY x (highest known bid)\n        // assuming they all meet the rules  by end of bidding\n        min: calcMin,\n        units: 'satoshi'\n      }\n    }\n  }\n}\n\n/**\n * Need a way to suggest refunds and how much but not force it. Only suggests to set or get values if there are refunds to do.\n */\nconst SUGGESTION_REFUND_PAST_BIDDERS = ({ st, address=undefined }: any = {}): I_Condition => {\n\n  const describe = 'Must refund all prior bids for bid to count as valid at the end of the bidding period. Refunds can be done separately or during the bid'\n\n  let refunds = ''\n\n  if (st) {\n    const ignoreAddress = address // if provided, can ignore for refund suggestions\n\n    const leftAmounts = unrefundedAmounts(st)\n    for (let toAddress in leftAmounts) {\n      if (ignoreAddress && toAddress !== ignoreAddress) {\n        refunds += leftAmounts[toAddress] + ' ' + toAddress + '\\n'\n      }\n    }\n    refunds = refunds.slice(0, -1)\n  }\n\n  if (refunds === '') {\n\n    return {\n      status: () => true,\n      info: { describe }\n    }\n\n  } else {\n\n    return {\n      status: () => true,\n      info: {\n        describe,\n        type: BnsSuggestionType.REFUND_BIDDERS,\n        get: {\n          value: false,\n          name: 'Refund now?'\n        },\n        set: {\n          value: refunds,\n          name: 'Amount & address to refund',\n          units: 'satoshi address'\n        }\n      }\n    }\n  }\n}\n\n\n/* -------------------------------------------------------------------------- */\n/*               Warnings (if action is a bad idea but possible)              */\n/* -------------------------------------------------------------------------- */\n\n\nconst WARNING_POINTLESS_IF_NOT_OWNER = (args: any): I_Condition => ({\n  status: () => true,\n  info: {\n    describe: 'Action not recommended for non-owners',\n    warning: !USER_IS_OWNER(args)?.status() ? 'Useless unless you are the owner or will be owner in future' : undefined\n  }\n})\n\nconst WARN_IF_NOT_BIDDER = (args: any): I_Condition => ({\n  status: () => true,\n  info: {\n    describe: 'Action not recommended for non-bidders',\n    warning: !USER_IS_BIDDER(args)?.status() ? 'Useless unless you are a bidder or will be bidder in this period later' : undefined\n  }\n})\n\n/* -------------------------------------------------------------------------- */\n/*                           User's possible actions                          */\n/* -------------------------------------------------------------------------- */\n\n/**\n * One of requirements for bids is to refund past bidders by the time bidding period is over. This action allows doing that separately.\n */\nexport const refundOtherBidders = (st: I_BnsState | null, address: string = '', tx: any = undefined): I_BNS_Action => {\n\n  const args = { st, tx, address }\n\n  const type = BnsActionType.REFUND_OTHER_BIDS\n\n  const info = 'Refund other bidders for bids to count.'\n\n  const permissions = [\n    IS_BIDDING_ONGOING,\n\n    // suggestions\n    WARN_IF_NOT_BIDDER\n  ]\n\n  const conditions = [\n    NOTIFIED_MIN,\n    NO_UNSPENT_USER_NOTIFICATIONS_UTXO,\n    USER_ADDRESS_NOT_NOTIFICATION_ADDRESS\n  ]\n\n  const execute = !st ? () => {} : () => {\n    console.assert(!!tx, 'Must not execute action without tx')\n    subtractRefunds(st, tx)\n  }\n\n  return {\n    permissions: st ? permissions.map(permission => permission(args)) : permissions,\n    conditions: st ? conditions.map(condition => condition(args)) : conditions,\n    args, info, type, execute\n  }\n}\n\n\n// Describe: If no owner, sender can start process to claim ownership\n// Since autoChecks run before user action checks in calcBnsState,\n// after bidding ends owner will be set by time this is checked.\nexport const bidForOwnershipAction = (st: I_BnsState | null, address: string = '', tx: any = undefined): I_BNS_Action => {\n\n  const args = { st, tx, address }\n\n  const type = BnsActionType.BID_FOR_OWNERSHIP\n\n  const info = 'Bid for ownership of a domain'\n\n  const permissions = [\n    // this means no more bids when there's a winner\n    NO_OWNER,\n\n    // suggestions\n    SUGGESTION_SUBMIT_BURN_AMOUNT,\n    SUGGESTION_REFUND_PAST_BIDDERS\n  ]\n\n  const conditions = [\n    // minimum rules to counting tx still apply for bids\n    OUTS_2,\n    OUT_0,\n    OUT_1,\n    NOTIFIED_MIN,\n    NO_UNSPENT_USER_NOTIFICATIONS_UTXO,\n    USER_ADDRESS_NOT_NOTIFICATION_ADDRESS,\n\n    // at very least minimum is burnt, the rest is derived\n    BURNED_MIN\n  ]\n\n  const execute = !st ? () => {} : () => {\n    // have to start or add to bidding\n    // ownership will be derived through automatic check based on bidding started here\n    addBid(st, tx, BnsBidType.BURN)\n  }\n\n  return {\n    permissions: st ? permissions.map(permission => permission(args)) : permissions,\n    conditions: st ? conditions.map(condition => condition(args)) : conditions,\n    args, info, type, execute\n  }\n\n  // need to get user input on burn amount possible minimum (general action guidance)\n  // also needs some guidance for refunds necessary to win (general action guidance)\n\n}\n\n/**\n * Change address. (similar to send ownership, but keeps forwards)\n * network: '!ca'\n * address: 'newaddress'\n */\nexport const changeAddressAction = (st: I_BnsState | null, address: string = '', tx: any = undefined): I_BNS_Action => {\n\n  const command = '!ca'\n\n  const args = { st, address, tx, command }\n\n  const type = BnsActionType.CHANGE_ADDRESS\n\n  const info = 'Update your ownership address'\n\n  const permissions = [\n    USER_IS_OWNER,\n\n    // suggestions\n    SUGGESTION_SUBMIT_NEW_ADDRESS\n  ]\n\n  const conditions = [\n    OUTS_2,\n    OUT_0,\n    OUT_1,\n    NOTIFIED_MIN,\n    NO_UNSPENT_USER_NOTIFICATIONS_UTXO,\n    USER_ADDRESS_NOT_NOTIFICATION_ADDRESS,\n\n    IS_COMMAND_CALLED\n  ]\n\n  const execute = !st ? () => {} : () => {\n    const thisCommand = getCommandCalled(st, tx, command)\n    const newAddress = thisCommand?.address;\n    if (!newAddress) {\n      console.log('ownership transfer detected, but no address found')\n    } else {\n      // quite possible user doesn't exist so create blank one\n      if (!existsUser(st, newAddress)) createNewUser(st, newAddress)\n\n      // new owner is created and given old owner's ownership data\n\n      const oldOwner = getOwner(st)\n      setOwner(st, newAddress)\n      // one of conditions is USER_IS_OWNER so there is owner\n      getUser(st, newAddress).winHeight = oldOwner!.winHeight\n      getUser(st, newAddress).winTimestamp = oldOwner!.winTimestamp\n      getUser(st, newAddress).burnAmount = oldOwner!.burnAmount\n      // clone forwards\n      getUser(st, newAddress).forwards = JSON.parse(JSON.stringify(oldOwner!.forwards))\n      // for new user, no changes to updateHeight, nonce\n\n      // old owner loses ownership data\n      oldOwner!.winHeight = 0\n      oldOwner!.winTimestamp = 0\n      oldOwner!.burnAmount = 0\n      // nonce, forwards (not active now), update height are not touched\n      console.log('ownership transfered from', oldOwner!.address, 'to', newAddress)\n    }\n  }\n\n  return {\n    permissions: st ? permissions.map(permission => permission(args)) : permissions,\n    conditions: st ? conditions.map(condition => condition(args)) : conditions,\n    args, info, type, execute\n  }\n}\n\n/**\n * Send ownership to another address. Forwards are not kept.\n * network: '!so'\n * address: 'newaddress'\n */\nexport const sendOwnershipAction = (st: I_BnsState | null, address: string = '', tx: any = undefined): I_BNS_Action => {\n\n  const command = '!so'\n\n  const args = { st, address, tx, command }\n\n  const type = BnsActionType.SEND_OWNERSHIP\n\n  const info = 'Give up ownership to another address'\n\n  const permissions = [\n    USER_IS_OWNER,\n\n    // suggestions\n    SUGGESTION_SUBMIT_NEW_OWNER_ADDRESS,\n  ]\n\n  const conditions = [\n    OUTS_2,\n    OUT_0,\n    OUT_1,\n    NOTIFIED_MIN,\n    NO_UNSPENT_USER_NOTIFICATIONS_UTXO,\n    USER_ADDRESS_NOT_NOTIFICATION_ADDRESS,\n\n    IS_COMMAND_CALLED\n  ]\n\n  const execute = !st ? () => {} : () => {\n    const thisCommand = getCommandCalled(st, tx, command)\n    const newAddress = thisCommand?.address;\n    if (!newAddress) {\n      console.log('ownership transfer detected, but no address found')\n    } else {\n      // quite possible user doesn't exist so create blank one\n      if (!existsUser(st, newAddress)) createNewUser(st, newAddress)\n\n      // new owner is created and given old owner's ownership data\n\n      const oldOwner = getOwner(st)\n      setOwner(st, newAddress)\n      // one of conditions is USER_IS_OWNER so there is owner\n      getUser(st, newAddress).winHeight = oldOwner!.winHeight\n      getUser(st, newAddress).winTimestamp = oldOwner!.winTimestamp\n      getUser(st, newAddress).burnAmount = oldOwner!.burnAmount\n      // for new user, no changes to updateHeight, nonce, or forwards\n\n      // old owner loses ownership data\n      oldOwner!.winHeight = 0\n      oldOwner!.winTimestamp = 0\n      oldOwner!.burnAmount = 0\n      // nonce, forwards (not active now), update height are not touched\n\n      console.log('ownership transfered from', oldOwner!.address, 'to', newAddress)\n    }\n  }\n\n  return {\n    permissions: st ? permissions.map(permission => permission(args)) : permissions,\n    conditions: st ? conditions.map(condition => condition(args)) : conditions,\n    args, info, type, execute\n  }\n\n}\n\n\n// Describe: If from current owner & burned past winning minimum, extend ownership.\nexport const currentOwnerRenewAction = (\n  st: I_BnsState | null,\n  address: string = '',\n  tx: any = undefined\n): I_BNS_Action => {\n\n  const args = { st, address, tx }\n\n  const type = BnsActionType.RENEW\n\n  const info = 'Extend ownership of this domain'\n\n  const permissions = [\n    USER_IS_OWNER\n  ]\n\n  const conditions = [\n    OUTS_2,\n    OUT_0,\n    OUT_1,\n    NOTIFIED_MIN,\n    NO_UNSPENT_USER_NOTIFICATIONS_UTXO,\n    USER_ADDRESS_NOT_NOTIFICATION_ADDRESS,\n\n    BURNED_MIN,\n    BURN_LAST_WIN\n  ]\n\n  const execute = !st ? () => {} : () => {\n    const owner = getOwner(st)\n    // set owner's win height to current tx height therefore updating ownership\n    owner && (owner.winHeight = getTxHeight(tx))\n    owner && (owner.winTimestamp = getTxTimestamp(tx))\n    console.log(\n      `${ st.domain.domainName } : ${ getTxHeight(tx) } height: owner extended ownership ${ owner?.address }`\n    )\n  }\n\n  return {\n    permissions: st ? permissions.map(permission => permission(args)) : permissions,\n    conditions: st ? conditions.map(condition => condition(args)) : conditions,\n    args, info, type, execute\n  }\n}\n\n// Describe: update forwarding information.\nexport const updateForwardingInfoAction = (\n  st: I_BnsState | null,\n  address: string = '',\n  tx: any = undefined\n): I_BNS_Action => {\n\n  const args = { st, address, tx }\n\n  const type = BnsActionType.ONLY_FORWARDS\n\n  const info = 'Only update forwarding information'\n\n  const permissions = [\n    // suggestions\n    WARNING_POINTLESS_IF_NOT_OWNER\n  ]\n\n  const conditions = [\n    OUTS_2,\n    OUT_0,\n    OUT_1,\n    NOTIFIED_MIN,\n    NO_UNSPENT_USER_NOTIFICATIONS_UTXO,\n    USER_ADDRESS_NOT_NOTIFICATION_ADDRESS\n  ]\n\n  const execute = !st ? () => {} : () => {\n    readEmbeddedData(st, tx)\n  }\n\n  return {\n    permissions: st ? permissions.map(permission => permission(args)) : permissions,\n    conditions: st ? conditions.map(condition => condition(args)) : conditions,\n    args, info, type, execute\n  }\n}\n\n/* -------------------------------------------------------------------------- */\n/*                              Automatic Actions                             */\n/* -------------------------------------------------------------------------- */\n\n// Describe: if OWNERSHIP_DURATION_BY_BLOCKS blocks since ownership update, no owner again\nexport const autoCheckForOwnerExpiredAction = (st: I_BnsState): I_BNS_Auto_Action => {\n  const args = { st }\n  return {\n    info: 'Existing ownerships that expire are removed',\n\n    conditions: [\n      EXISTS_OWNER(args),\n      IS_OWNER_EXPIRED(args)\n    ],\n\n    execute: () => {\n      clearOwner(st)\n      console.log(st.domain.domainName, getParsedHeight(st), 'ownership expired')\n    }\n  }\n}\n\n// Describe: always uses this tx to update derivedUtxoList of the domain notificatin address\nexport const updateUtxoFromTxAction = (st: I_BnsState, tx: I_TX): I_BNS_Auto_Action => {\n  return {\n    info: 'Update derivedUtxoList from new tx',\n\n    conditions: [],\n\n    execute: () => {\n      updateUtxoFromTx(st, tx)\n    }\n  }\n}\n\n// Describe: update bidding winner and owner\nexport const autoCheckForBiddingWinnerNewOwnerAction = (st: I_BnsState): I_BNS_Auto_Action => {\n  const args = { st }\n  return {\n    info: 'Derive the new owner from bidding period',\n\n    conditions: [\n      NO_OWNER(args),\n      IS_BIDDING_OVER(args)\n    ],\n\n    execute: () => {\n      endBidding(st)\n\n      console.log('bidding period is over')\n    }\n  }\n}\n","import {\n  currentOwnerRenewAction,\n  bidForOwnershipAction,\n  autoCheckForOwnerExpiredAction,\n  updateForwardingInfoAction,\n  updateUtxoFromTxAction,\n  sendOwnershipAction,\n  changeAddressAction,\n  autoCheckForBiddingWinnerNewOwnerAction\n} from './actions'\nimport { I_BnsState, I_TX, I_Condition } from './../types/'\n\n\n\n\n/**\n * Returns what actions are available for specific user address at current state.\n */\nexport const runAllActionPermissionChecks = (st: I_BnsState, address: string) => {\n  console.log('currentOwnerRenewAction running:')\n\n  // Edit this list to include more actions for checks\n  // (address here only at best, tx not necessary or possible)\n  const allActions = [\n    updateForwardingInfoAction(st, address),\n    currentOwnerRenewAction(st, address),\n    bidForOwnershipAction(st, address),\n\n    sendOwnershipAction(st, address),\n    changeAddressAction(st, address)\n  ]\n\n  // check which actions are doable\n  const checkedActions: any[] = []\n  allActions.forEach(action => {\n\n    // check each permission in each action\n    const checkedPermissions: any[] = []\n    action.permissions.forEach((permission: any) => {\n      const isAllowed = permission.status()\n\n      // add to list of permissions checked in this action & their display info\n      checkedPermissions.push({\n        isAllowed,\n        ...permission\n      })\n    })\n\n    // grab every condition (for info)\n    const actionSuggestions: any[] = []\n    action.permissions.forEach((permission: any) => {\n      actionSuggestions.push(permission)\n    })\n    action.conditions.forEach((condition: any) => {\n      actionSuggestions.push(condition)\n    })\n\n\n    // add to list of all actions with summary of all their permissions checks\n    checkedActions.push({\n      type: action.type,\n      info: action.info,\n      isUsable: checkedPermissions.every(permission => permission.isAllowed),\n      permissionList: checkedPermissions,\n      suggestions: actionSuggestions\n    })\n  })\n\n  // return array of doable actions\n  return checkedActions\n}\n\n/****************************************************************************************\n * Executes all actions possible by user that sent tx.\n * Nothing returned.\n */\nexport const runAllUserActions = (st: I_BnsState, tx: I_TX): void => {\n\n  // edit this list (tx here, address not necessary)\n  const allUserActions = [\n    updateForwardingInfoAction(st, undefined, tx),  // reads embedded data\n    currentOwnerRenewAction(st, undefined, tx),     // renew ownership\n    bidForOwnershipAction(st, undefined, tx),                   // new ownership\n\n    // giving up ownership should go last in case user state needs to be edited first\n    sendOwnershipAction(st, undefined, tx),         // give up ownership to another\n    changeAddressAction(st, undefined, tx)          // change your ownership address\n  ]\n\n  allUserActions.forEach((action: any) => {\n\n    // check that all conditions & permissions are true\n    const okConditions = action.conditions.reduce(\n      (areAllConditionsMet: boolean, eaCondition: any) => areAllConditionsMet && eaCondition.status()\n    , true)\n\n    const okPermissions = action.permissions.reduce(\n      (areAllPermissionsMet: boolean, eaPermission: any) => areAllPermissionsMet && eaPermission.status()\n    , true)\n\n    if (okConditions && okPermissions) action.execute()\n  })\n}\n\n/****************************************************************************************\n * Executes non-user actions like ownership expiration over time or deriving new UTXO.\n * Nothing returned.\n */\nexport const runAllAutomaticActions = (st: I_BnsState, tx: I_TX | undefined): void => {\n\n  // list of all automatic actions\n  const allAutoChecks = [\n    autoCheckForOwnerExpiredAction(st),\n    tx ? updateUtxoFromTxAction(st, tx) : undefined,\n    autoCheckForBiddingWinnerNewOwnerAction(st)\n  ]\n\n  allAutoChecks.forEach(action => {\n    if (!!action) {\n      // check that all conditions are true\n      const ok = action.conditions.reduce(\n        (areAllConditionsMet: boolean, eaCondition: I_Condition ) => (\n          areAllConditionsMet && eaCondition.status()\n        ), true)\n      if (ok) action.execute()\n    }\n  })\n}\n\n/****************************************************************************************\n * Simply returns all user actions without any fed parameters\n */\nexport const scanEveryActionForCommand = () => {\n  // list of all actions to check\n  const actions = [\n    updateForwardingInfoAction(null),\n    currentOwnerRenewAction(null),\n    bidForOwnershipAction(null),\n\n    sendOwnershipAction(null),\n    changeAddressAction(null)\n  ]\n  return actions\n}\n\n// (TODO) rewrite so don't have to list same user actiosn 5 times w/ diff arguments, more generalized","import { calcP2WSH } from './calcP2WSH'\nimport { newState } from './initialState'\nimport * as actions from './actions'\nimport { EARLIEST_NOTIFICATION_HEIGHT } from './constants'\nimport { I_BnsState } from './types'\nimport {\n  setParsedHeight,\n  updateSourceUserFromTx,\n  getTxHeight,\n  updateOwnerHistory\n } from './formathelpers'\n\n/**\n * Returns ownership and notification information objects.\n * @param   {Array<any>}  notificationsHistory  - Array of any tx with notificationsAddress.\n * @param   {string}      domainName            - Full domainName to use (e.g. 'satoshi.btc').\n * @param   {number}      currentHeight         - Current blockheight of the network chain selected.\n * @param   {string}      networkChoice         - 'testnet' or 'bitcoin' (matches bitcoinjs-lib).\n * @returns {I_BnsState}                         - BNS state describing object.\n */\nexport const calcBnsState = (\n  notificationsHistory: Array<any>,\n  domainName: string,\n  currentHeight: number,\n  networkChoice: string\n): I_BnsState => {\n\n  // initialize temporary derivation state\n  const st = JSON.parse(JSON.stringify(newState)); // deep object clone\n  st.domain.domainName = domainName\n  st.chain && (st.chain.currentHeight = currentHeight)\n  st.domain.notificationAddress = calcP2WSH(domainName, networkChoice)?.notificationsAddress || ''\n\n  // Sorting history from earliest to latest\n  // reversing should speed it up if not complete it\n  st.domain.txHistory = (notificationsHistory\n    .slice().reverse()\n    .filter((tx: any) => getTxHeight(tx) >= EARLIEST_NOTIFICATION_HEIGHT)\n    .sort((prev, next) => {\n      const prevBlockHeight = prev.status.block_height\n      const nextBlockHeight = next.status.block_height\n      return prevBlockHeight - nextBlockHeight\n    })\n\n  )\n\n  // iterate with blockheights of relevant tx to derive st state\n  // Each tx blockheight serves as reference time\n  st.domain.txHistory.forEach((tx: any) => {\n\n    // update current chain's parsed height based on tx confirmed height\n    setParsedHeight(st, getTxHeight(tx))\n\n    // update or create new basic user info based on source address @ input0\n    // this includes user's NONCE set to height of the user's tx prior to this one\n    updateSourceUserFromTx(st, tx)\n\n    // check if owner expired & update derivedUtxo\n    actions.runAllAutomaticActions(st, tx)\n\n    // run all possible actions\n    // starting with reading embedded data\n    actions.runAllUserActions(st, tx)\n\n    // update nonce\n    // after this tx, this tx height is the last tx height, so the new nonce\n    updateSourceUserFromTx(st, tx)\n\n    // update ownership history each tx even if not owner\n    updateOwnerHistory(st)\n  })\n\n  // final check for current block height\n  setParsedHeight(st, currentHeight)\n\n  // check if owner expired\n  actions.runAllAutomaticActions(st, undefined)\n\n  return st\n}\n\n","import { I_Forward } from '../types'\n/**\n * Returns array with only latest forwards from array of all forwards.\n * Removes actions, ones that start with \"!\" and ones that are blank addresses.\n */\nexport const findLatestForwards = (forwards: Array<I_Forward>): Array<I_Forward> => {\n  // simplest would be to go through object where keys of cloned network would overwrite\n  // sort first for simplicity\n  const sortedForwards = [...forwards].sort((prev, next) => {\n    // sorts by index proportional to block height and time\n    const prevHeight = prev.updateHeight\n    const nextHeight = next.updateHeight\n    return prevHeight - nextHeight\n  })\n  // now just overwrite values for same networks in order of sorted array\n  const currentNetworks: {[key: string]: I_Forward} = {}\n  sortedForwards.forEach(eaForward => {\n    // add all networks that are not commands or blank network name\n    const isNotCommand = !eaForward.network.startsWith('!')\n    const isNotEmptyNetwork = !(eaForward.network === '')\n    if (isNotCommand && isNotEmptyNetwork) {\n      currentNetworks[eaForward.network] = eaForward\n    }\n    // if the final address is blank, delete it from object\n    const isDeleted = eaForward.address === ''\n    if (isDeleted) {\n      delete currentNetworks[eaForward.network]\n    }\n  })\n\n  // return just array of values, networks still part of values as well\n  return [...Object.values(currentNetworks)]\n}\n","import { scanEveryActionForCommand } from './../actions/batch'\n\n/**\n * Can grab simple words that explain what command does/did for visualization if found.\n * Only useful to grab text not dependent on any state.\n * Otherwise, returns undefined.\n */\nexport const interpretCommand = (key: string, value: string) => {\n\n  // grab all basic action objects\n  const allActions = scanEveryActionForCommand()\n\n\n  // scan each for matching commmand\n  let action\n  for (let i = 0; i < allActions.length; i++) {\n    if (key.startsWith(allActions[i].args.command)) {\n      action = allActions[i]\n      break\n    }\n  }\n\n  if (!action) return undefined\n\n  // scan for getters within\n  let getterName\n  for (let i = 0; i < action.permissions.length; i++) {\n    if ('get' in action.permissions[i]().info) {\n      console.log(action.permissions[i]())\n      getterName = action.permissions[i]().info.get.name\n      break\n    }\n  }\n\n  if (!getterName) return undefined\n\n  return {\n    info: action.info,\n    getterName,\n    value\n  }\n\n}","import { encrypt } from './cryptography'\n\n/**\n * Returns number of bytes the string has after encryption.\n * Encryption is used directly to measure result accurately\n * even if cryption method changes in the future.\n */\nexport const stringByteCount = (data: string): number => {\n  const cipher: Buffer = encrypt(data, 'arbitrary key and iv seeding string')\n  // returns buffer, so length should be bytesize\n  return cipher.length;\n}","\nimport { I_Checked_Action, I_Condition } from './types'\n\n/**\n * Return all \"get\" suggestions of a checked action.\n * get = seeking input from user.\n * Within array, each getter is at suggestion.info.get.\n */\nexport const getGetters = (action: I_Checked_Action): Array<I_Condition> => {\n  const getters = action.suggestions.filter((thisSuggestion:any) => {\n    return ('get' in thisSuggestion.info)\n  })\n  return getters\n}\n\n/**\n * Return all \"set\" suggestions of a checked action.\n * set = already know what the value is & necessary to set.\n * Within array, each setter is at suggestion.info.set.\n */\nexport const getSetters = (action: I_Checked_Action): Array<I_Condition> => {\n  const setters = action.suggestions.filter((thisSuggestion:any) => {\n    return ('set' in thisSuggestion.info)\n  })\n  return setters\n}","import axios from 'axios'\n\n// Documentation\n// https://github.com/Blockstream/esplora/blob/esplora_v2.00/API.md\n// https://github.com/Blockstream/esplora/blob/master/API.md#post-tx\n\n// const API_PATH_TESTNET = 'https://blockstream.info/testnet/api/'\n// const API_PATH_BITCOIN = 'https://blockstream.info/api/'\n\nconst API_RATE_LIMIT = 0.5    // guessing calls per second cap\n\n// (TODO) a single instance of async task executing loop per API to ensure rate limit holds per API\n// Meanwhile calling function can use its own busy flag to ensure promises are resolved before repeats.\n// RawTx requests and multipage history (length > 25) are main risks.\n\nexport async function getFeeEstimatesAPI (strNetwork: string, path: { [network: string]: string }) {\n  const API_PATH = path[strNetwork] + 'fee-estimates'\n  console.warn(API_PATH)\n\n  try {\n\n    const res = await axios.get(API_PATH)\n    console.warn('Blockstream.info API getFeeEstimates', res.data)\n\n    return res.data\n\n  } catch (e) {\n\n    console.warn(e)\n    await rateLimit()\n    throw new Error('Blockstream.info API getFeeEstimates failed')\n  }\n\n}\n\n\nexport async function getHeightAPI (strNetwork: string, path: { [network: string]: string }) {\n  const API_PATH = path[strNetwork] + 'blocks/tip/height'\n  console.warn(API_PATH)\n\n  try {\n\n    const res = await axios.get(API_PATH)\n    console.warn('Blockstream.info API getHeight', res.data)\n\n    return res.data\n\n  } catch (e) {\n\n    console.warn(e)\n    await rateLimit()\n    throw new Error('Blockstream.info API height get failed')\n  }\n\n}\n\n/**\n * API request for each UTXO in array to get the raw tx necessary for psbt.\n * @param     {Array}     arrayUtxo       Array of UTXO.\n * @param     {string}    strNetwork      Network type: 'bitcoin' or 'testnet'.\n * @returns   {object}                    { arrayTx: arrayTx w/ .hex, error: string, fails: number }\n */\nexport async function addRawTxToArrayAPI (utxoList: Array<any>, strNetwork: string, path: { [any: string]: string }) {\n  if (utxoList === undefined) throw new Error('undefined utxoList when addRawTxToArray was called')\n\n  // to track failures indecies\n  let erroredOutputs = ''\n\n  // abort if empty array\n  if (utxoList?.length === 0) {\n    return { utxoList, error: 'no utxo' }\n  }\n\n  // iterate through original utxo and add hex onto clone, 2 tries max each\n  for (let [indexString, utxo] of Object.entries(utxoList)) {\n    // indexString is a string so convert for array index use\n    const index = parseInt(indexString, 10)\n\n    let tries = 2\n    while (tries-- > 0) {\n      try {\n        const { txid } = utxo\n\n        // raw tx hex path on API\n        const API_PATH = path[strNetwork] + 'tx/' + txid + '/hex'\n        console.warn(API_PATH)\n\n        const res = await axios.get(API_PATH)\n        console.warn('Blockstream.info API addRawTxToArray:', index, 'index utxo has raw hex of', res.data)\n\n        // add hex data into cloned utxo array\n        utxoList[index].hex = res.data\n\n        // break while loop if got data, don't need more tries\n        break\n\n      } catch(e) {\n        // keeping track of failures\n        console.warn('fail detected', indexString, utxo, tries, erroredOutputs, e)\n        // keep track of indecies missing hex\n        erroredOutputs += indexString + ' '\n      }\n\n      await rateLimit()\n    }\n  }\n\n  // return summary object\n  return { utxoList, erroredOutputs }\n}\n\n/**\n * API request for all utxo for this address.\n * Blockstream utxo do not have addresses that created them!\n * @param     {string}    address       Bitcoin address.\n * @param     {string}    strNetwork    Network type: 'bitcoin' or 'testnet'.\n * @returns   {Array}                   Array of UTXO.\n */\nexport async function getUTXOListAPI (address: string, strNetwork: string, path: { [any: string]: string }) {\n  if (address === undefined || address === '') throw new Error('no address when getUTXOList called')\n\n\n  const API_PATH = path[strNetwork] + 'address/' + address + '/utxo'\n  console.warn(API_PATH)\n\n  try {\n    const res = await axios.get(API_PATH)\n    console.warn('Blockstream.info API getUTXOList', res.data)\n\n    await rateLimit()\n\n    // for now lets filter out the unconfirmed tx\n    return res.data.filter((utxo: any) => utxo.status.confirmed)\n\n  } catch (e) {\n\n    console.warn(e)\n    await rateLimit()\n    throw new Error('Blockstream.info API access failed')\n\n  }\n}\n\n/**\n * API request all transactions for a specific address.\n * parameters: (address, network).\n * @param   {string} address    - address on network.\n * @param   {string} network    - 'testnet' or 'bitcoin' to match bitcoinjs-lib.\n * @returns {Array<object>}     -  Array of tx objects.\n */\nexport async function getAddressHistoryAPI (address: string, strNetwork: string, path: { [any: string]: string }) {\n  if (address === undefined || address === '') throw new Error('no address when getAddressHistory called')\n  // https://blockstream.info/testnet/api/address/tb1qprkzdaqt5jkxrhy57ngvra8k0rvq63ulksz8cx85qwke3myhjrtq9s6nj3/txs/chain\n  // GET /address/:address/txs/chain[/:last_seen_txid]\n  // Get confirmed transaction history for the specified address/scripthash, sorted with newest first.\n  // Returns 25 transactions per page. More can be requested by specifying the last txid seen by the previous query.\n\n  const CONFIRMED_PAGES_ADDON = '/txs/chain'\n  const API_PATH = path[strNetwork] + 'address/' + address + CONFIRMED_PAGES_ADDON\n  console.warn(API_PATH)\n\n  try {\n    const res = await axios.get(API_PATH)\n    console.warn('blockstream.info API getAddressHistory', res)\n\n    return res.data\n\n  } catch (e) {\n    console.warn(e)\n    throw new Error('Blockstream.info API access failed')\n  }\n}\n\n/**\n * Broadcasts content onto the blockchain.\n * parameters: (content, network).\n * @param   {string}  content  - raw hex content of transaction.\n * @param   {string}  network  - 'testnet' or 'bitcoin' to match bitcoinjs-lib.\n * @returns {string}           - Successful broadcast returns txid, otherwise error reason.\n */\nexport async function txPushAPI (content: string, strNetwork: string, path: { [any: string]: string }) {\n  if (content === undefined || content === '') throw new Error('no content when txPush called')\n\n  const API_PATH = path[strNetwork] + 'broadcast'\n\n  try {\n    const res = await axios.get(API_PATH, {\n      params: {\n        tx: content\n      }\n    })\n\n    // console.warn(res)\n    console.warn('blockstream.info API txPush', res, ' Broadcasted on', strNetwork)\n\n    // returns txid on success\n    return { txid: res.data }\n\n  } catch (e) {\n    console.warn('Failed pushtx', strNetwork, e.response.data )\n\n    throw new Error('Blockstream.info API access failed\\n' + e.response.data)\n  }\n}\n\n// Slow down based on rate limit.\n// Convert hz to time in milliseconds.\nasync function rateLimit () {\n  return new Promise(r => setTimeout(r, 1000.0 / API_RATE_LIMIT))\n}\n","import React, { useState } from 'react'\nimport { RoundButton } from '../../general/RoundButton'\nimport styles from './P1RestoreOrBackup.module.css'\nimport { createNewWalletAction, changePageInfoAction } from '../../../store/actions/'\nimport sanitize from './../../../helpers/sanitize'\nimport { Store } from '../../../store/'\nimport { Details } from './../../general/Details'\n\nenum pages {\n  ROOT,\n  NEW_WALLET,\n  LOAD_BACKUP\n}\n\n// restore backup or create new\nexport const P1RestoreOrBackup = () => {\n  const { state, dispatch } = React.useContext(Store) // global state\n  const [ page, setPage ] = useState(pages.ROOT) // local state\n  const [ backup, setBackup ] = useState('') // local state\n\n  // count non empty string strings separated by spaces\n  const wordCount = backup.split(' ').filter(v => v !== '').length\n\n  return (\n    <div className={ styles.wrapper }>\n\n\n\n      {/* ROOT PAGE */}\n      <div\n        style={{ display: page === pages.ROOT ? 'block' : 'none' }}\n      >\n        <div\n          className={ styles.title }\n        >\n          { state.wallet.address ? (<>\n            Your <span className={ styles.orange }>BTC</span> wallet for interacting<br />\n            with the domains\n          </>) : (<>\n            Need a <span className={ styles.orange }>BTC</span> wallet for interacting<br />\n            with the domains\n          </>) }\n        </div>\n        <div\n          className={ styles.contentWrapper }\n        >\n          <Details\n            description={ 'Explain' }\n          >\n            <p>\n              <span>This wallet has the built-in unique functionality to create transactions with custom scripts, inputs, and outputs necessary for this application.</span>\n\n              <span>The wallet's address is how users and owners of the domains are identified and should only be used for this purpose.</span>\n\n              <span>1. BIP39 mnemonic is used from backup or generated</span>\n              <span>2. BIP32 master seed is derived from the mnemonic</span>\n              <span>3. Key pair is derived at the m/44'/0'/0'/0/0 path from master seed</span>\n              <span>4. The p2wpkh (pay-to-witness-public-key-hash) address is derived from key pair</span>\n            </p>\n          </Details>\n        </div>\n        <div\n          className={ styles.buttonWrapper }\n        >\n          <RoundButton\n            show={ (state.wallet.mnemonic.length > 0) ? 'false' : 'true' }\n            onClick={() => {\n              setPage(pages.NEW_WALLET)\n              createNewWalletAction(state, dispatch)\n            }}\n          >\n            I need a new wallet\n          </RoundButton>\n          <RoundButton\n            show={ (state.wallet.mnemonic.length > 0) ? 'true' : 'false' }\n            onClick={() => {\n              setPage(pages.NEW_WALLET)\n            }}\n          >\n            Current mnemonic\n          </RoundButton>\n          <RoundButton\n            onClick={() => {\n              setPage(pages.LOAD_BACKUP)\n            }}\n          >\n            Restore from backup\n          </RoundButton>\n          <RoundButton\n            show={ (!!state.wallet?.address).toString() }\n            onClick={() => {\n              changePageInfoAction(state, dispatch, 2)\n            }}\n            next='true'\n          >\n            Don't change wallet\n          </RoundButton>\n        </div>\n      </div>\n\n      {/* NEW_WALLET PAGE */ }\n      <div\n        className={ styles.title }\n        style={{ display: page === pages.NEW_WALLET ? 'inline-block' : 'none' }}\n      >\n        Randomly generated mnemonic backup for <span className={ styles.orange }>BTC</span> wallet\n      </div>\n      <div\n        className={ styles.contentWrapper }\n        style={{ display: page === pages.NEW_WALLET ? 'flex' : 'none' }}\n      >\n        <div className={ styles.describe }>\n          Backup this private phrase\n          or you will lose access!\n        </div>\n        <div\n          id='divBackup'\n          spellCheck={ false }\n          className={ [styles.backup, 'selectable'].join(' ') }\n          onClick={ () => {\n            // select div entire contents\n            // const thisDiv = document?.getElementById('divBackup')\n            // if (thisDiv) {\n            //   window.getSelection()?.selectAllChildren(thisDiv)\n            // }\n          }}\n        >\n          { state.wallet.mnemonic }\n        </div>\n      </div>\n      <div\n        className={ styles.buttonWrapper }\n        style={{ display: page === pages.NEW_WALLET ? 'flex' : 'none' }}\n      >\n        <RoundButton\n          onClick={() => {\n            setPage(pages.ROOT)\n          }}\n          back='true'\n        >\n          Back\n        </RoundButton>\n        <RoundButton\n          onClick={() => {\n            setPage(pages.NEW_WALLET)\n            createNewWalletAction(state, dispatch)\n          }}\n        >\n          New\n        </RoundButton>\n        <RoundButton\n          next='true'\n          onClick={() => {\n            changePageInfoAction(state, dispatch, 2)\n          }}\n        >\n          I'm done with backup\n        </RoundButton>\n      </div>\n\n      {/* LOAD_BACKUP PAGE */ }\n\n      <div\n        style={{ display: page === pages.LOAD_BACKUP ? 'block' : 'none' }}\n      >\n        <div className={ styles.title }>\n          Type or paste your backup here\n        </div>\n\n        <div className={ styles.contentWrapper }>\n          { (wordCount).toString() + ' words now. 12 minimum.' }\n        </div>\n\n        <textarea\n          className={ styles.restoreBackup }\n          cols={ 30 }\n          rows={ 3 }\n          spellCheck={ false }\n          placeholder={ 'mnemonic backup' }\n          onChange={ e => {\n            // lowcaps, spaces, single space max, only one space on left while typing\n            const cleanString = sanitize(\n              e.target.value.toLowerCase(),\n              'lowcaps spaces single_space_width'.split(' ')\n            ).trimLeft()\n            setBackup(cleanString.trim()) // store without trailing space\n            e.target.value = cleanString // quick update\n          } }\n        ></textarea>\n        <div className={ styles.buttonWrapper } >\n          <RoundButton\n            onClick={() => {\n              setPage(pages.ROOT)\n            }}\n            back='true'\n          >\n            Back\n          </RoundButton>\n          <RoundButton\n            // 12 words minimum separated by spaces (TODO): proper checks\n            show={ (wordCount >= 12) ? 'true' : 'false' }\n            next='true'\n            onClick={() => {\n              createNewWalletAction(state, dispatch, backup)\n              changePageInfoAction(state, dispatch, 2)\n            }}\n          >\n            Done\n          </RoundButton>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n","import { I_State, Dispatch, ActionTypes } from '../../interfaces'\nimport { calcP2WSH, calcBnsState } from '../../helpers/bns'\nimport { getAddressHistoryAPI, getHeightAPI } from './../../api/blockstream'\nconst { STORE_SEARCH_RESULTS_FAIL, STORE_SEARCH_RESULTS } = ActionTypes;\n\n/**\n * Get address,\n * tx with notification address,\n * calculate owner,\n * find current owner's forwarding info,\n * send/dispatch to reducer to store important data found\n * (No UTXO nor raw TX scan for speed in front page search necessary yet)\n */\nexport const searchAction = async (state: I_State, dispatch: Dispatch, router: any = undefined) => {\n  const domainName = state.alias + state.extension\n  // stop if no alias submitted, nothing to save to state\n  if (!state.alias) return undefined\n\n  // find address for this alias\n  const { notificationsAddress } = calcP2WSH(domainName, state.network)\n\n  try {\n\n    // 1. Get current blockheight from API so ownership is using latest possible info\n\n    const currentHeight = await getHeightAPI(state.network, state.choices.apiPath)\n\n    // 2. Get API response for all tx history of this address\n    // This will grab all tx that \"notified\" this address by sending to it\n    // Upon failure error should be caught in this function\n    const notificationsTxHistory = await getAddressHistoryAPI(notificationsAddress, state.network, state.choices.apiPath)\n\n    // calculate bns data from this history via helper functions\n    const { domain } = calcBnsState(\n      notificationsTxHistory,\n      domainName,\n      currentHeight,\n      state.network\n    )\n\n    // 3. if navigated via id, use router to navigate home w/o id in url\n    if (router) { router?.push('/') }\n\n    // store data\n    return dispatch({\n      type: STORE_SEARCH_RESULTS,\n      payload: {\n        alias: state.alias,\n        domain,\n        chain: {\n          height: currentHeight\n        }\n      }\n    })\n\n  } catch (e) {\n    console.log('searchAction issue found:', e)\n\n    // if navigated via url id, use router to navigate home w/o id in url\n    // even if api call failed, should navigate away or will be stuck in a loop\n    if (router) { router?.push('/') }\n\n    // still updating the notification address\n    return dispatch({\n      type: STORE_SEARCH_RESULTS_FAIL,\n      payload: {\n        alias: state.alias,               // can save alias\n        domainName,\n        notificationsAddress              // can save this easy derivation\n      }\n    });\n  }\n}\n","import { I_State, Dispatch } from '../../interfaces'\nimport { ActionTypes } from './../../interfaces'\n\nimport { createNewWallet, loadWallet } from '../../helpers/bns/bitcoin'\n\nconst { NEW_WALLET } = ActionTypes;\n\n/**\n * Create new wallet address & backup.\n * If mnemonic is provided, wallet is generated from that.\n */\nexport const createNewWalletAction = async (\n  state: I_State, dispatch: Dispatch, strMnemonic: string = ''\n) => {\n\n  // load all the wallet info from mnemonic or generate new random mnemonic to do it\n  const { mnemonic, WIF, address } = (\n    (strMnemonic === '')\n      ? createNewWallet(state.network)\n      : loadWallet(strMnemonic, state.network)\n  )\n\n  return dispatch({\n    type: NEW_WALLET,\n    payload: { mnemonic, WIF, address }\n  })\n}","import { I_State, Dispatch, ActionTypes } from '../../interfaces'\nconst { CHANGE_PAGE_INFO } = ActionTypes;\n\n\n/**\n * Request to change page info that's checked for validity here\n */\nexport const changePageInfoAction = async (state: I_State, dispatch: Dispatch, page: number) => {\n  // for now no checks\n\n  return dispatch({\n    type: CHANGE_PAGE_INFO,\n    payload: page\n  })\n}","import { I_State, Dispatch, ActionTypes } from '../../interfaces'\nimport { calcP2WSH, calcBnsState } from '../../helpers/bns'\nimport { getAddressHistoryAPI, getUTXOListAPI, addRawTxToArrayAPI, getHeightAPI } from '../../api/blockstream'\nconst { UPDATE_WALLET, UPDATE_DOMAIN, ACTION_FAIL } = ActionTypes\n\n/**\n * Scans the address for utxo on a given network (w/ API).\n * Add hex of each tx that created utxo (for psbt).\n * addressType is one of enums ActionTypes that's either UPDATE_WALLET or UPDATE_NOTIFICATION.\n * If scanning wallet, then update wallet state.\n * If scanning notification address, then update notification state.\n * Notification scan will reproduce address scan first before getting details.\n */\nexport const scanAddressFullyAction = async (\n  state: I_State,\n  dispatch: Dispatch,\n  addressType: ActionTypes\n) => {\n  const domainName = state.alias + state.extension\n\n  // wallet address scan\n  if (addressType === UPDATE_WALLET) {\n    // wallet address\n\n    try {\n\n      // 1. get address TX history\n\n      const walletAddress = state.wallet.address\n      const walletTxHistory = await getAddressHistoryAPI(walletAddress, state.network, state.choices.apiPath)\n\n      // 2. get address UTXO list (could also calculate from tx history or API)\n\n      const utxoListWalletAddress = await getUTXOListAPI(walletAddress, state.network, state.choices.apiPath)\n\n      // 3. get raw tx for each UTXO (psbt requirement for creating new tx later)\n\n      const { utxoList, erroredOutputs } = await addRawTxToArrayAPI(utxoListWalletAddress, state.network, state.choices.apiPath)\n\n      !!erroredOutputs && console.log('API had issues during hex utxo scan:', erroredOutputs)\n\n      return dispatch({\n        type: UPDATE_WALLET,\n        payload: {\n          wallet: {\n            txHistory: walletTxHistory,\n            utxoList: utxoList\n          }\n        }\n      })\n\n    } catch (e) {\n      console.log('Wallet address scan failed')\n      console.log(e)\n      // abort\n      return dispatch({\n        type: ACTION_FAIL,\n        payload: {}\n      });\n    }\n  }\n\n  // notification address scan\n  if (addressType === UPDATE_DOMAIN) {\n\n\n    try {\n\n      // 1. get current blockheight from API so ownership is using latest possible info\n\n      const currentHeight = await getHeightAPI(state.network, state.choices.apiPath)\n\n      // 2. get address TX history\n\n      const { notificationsAddress } = calcP2WSH(domainName, state.network)\n      const notificationsTxHistory = await getAddressHistoryAPI(notificationsAddress, state.network, state.choices.apiPath)\n\n\n      // 3. derive new BNS domain state & utxo\n      const { domain: newDomain } = calcBnsState(\n        notificationsTxHistory,\n        domainName,\n        currentHeight,\n        state.network\n      )\n\n\n      // 4. get raw tx for each UTXO (psbt requirement for creating new tx later)\n\n      const { erroredOutputs } = await addRawTxToArrayAPI(\n        newDomain.derivedUtxoList,\n        state.network,\n        state.choices.apiPath\n      )\n\n      !!erroredOutputs && console.log('API had issues during hex utxo scan:', erroredOutputs)\n\n      return dispatch({\n        type: UPDATE_DOMAIN,\n        payload: {\n          domain: newDomain,\n          chain: {\n            height: currentHeight\n          }\n        }\n      })\n\n    } catch (e) {\n      console.log('Notification address scan failed')\n      console.log(e)\n      // abort\n      return dispatch({\n        type: ACTION_FAIL,\n        payload: {}\n      });\n    }\n\n  }\n\n  throw new Error('unexpected address type')\n}","import { I_State, Dispatch, ActionTypes } from '../../interfaces'\nconst { CHOICES_BNS_ACTION } = ActionTypes;\n\n/**\n * Cleans up the entered string including removing next line characters\n */\nexport const changeChoicesBNSAction = async (\n  state: I_State,\n  dispatch: Dispatch,\n  choices: any\n) => {\n\n  return dispatch({\n    type: CHOICES_BNS_ACTION,\n    payload: choices\n  })\n}\n\n","import React from 'react'\nimport styles from './Details.module.css'\n\n/**\n * Create details expanding/collapsing button.\n * Optional props:\n * title={ 'random text' } to change text shown on the hide/show toggle button\n * show={ 'true } to show initially *\n * Background is automatically styled if <p></p> is used directly inside.\n * If so, <span></span> can be used inside <p></p> to separate\n * paragraphs and indent the wrap as well.\n */\nexport const Details = (props: any) => {\n  // local state for showing or hiding details\n  const [ showDetails, setShowDetails ] = React.useState(props?.show === 'true' || false)\n\n  return (\n    <div className={ styles.wrapper }>\n\n      {/* button that toggles whether details are shown or not */}\n      <div\n        className={ styles.buttonWrapper }\n        onClick={ () => {\n          setShowDetails(!showDetails)\n        } }\n      >\n        <div\n          className={ styles.toggleDetails }\n\n        >\n          {/* the text on button coems from title prop */}\n          { props.title || props.description || 'Show details' }\n          </div>\n        {/* the arrow that rotates on click */}\n        <div\n          className={ [styles.arrow, showDetails ? styles.down : '' ].join(' ') }\n        />\n        </div>\n\n\n      {/* the details that is rendered when showDetails = true */}\n      <div\n        className={ styles.details }\n        style={ {\n          display: (\n            showDetails ? 'block' : 'none'\n          )\n        } }\n      >\n        {/* any arbitrary content surrounded by this component brackets */}\n        {/* if <p></p> tags are used, they will be formated */}\n        { props.children }\n      </div>\n    </div>\n  )\n}\n","import React, { useState, useEffect } from 'react'\nimport { RoundButton } from '../../general/RoundButton'\nimport styles from './P2LoadWallet.module.css'\nimport { Store } from '../../../store/'\nimport { changePageInfoAction } from '../../../store/actions'\nimport qr from 'qrcode'\nimport { useHistory } from 'react-router-dom'\n\n\n/**\n * Load wallet page, including faucet link for testnet users\n */\nexport const P2LoadWallet = () => {\n  const { state, dispatch } = React.useContext(Store) // global state\n\n  // load QR code into local state\n  const [ qrCode, setQrCode] = useState()\n  useEffect(() => {\n    qr.toDataURL(state.wallet.address, {\n      type: 'image/jpeg', color: { dark: '#111133ff'}\n    }, (err: any, url: any) => {\n      if (!err) { setQrCode(url) }\n    })\n  }, [state.wallet.address])\n\n  // url changer\n  const history = useHistory()\n\n  return (\n    <div className={ styles.wrapper }>\n      <div\n        className={ styles.title }\n      >\n        Fund your <span className={ styles.orange }>BTC</span> wallet to interact with domains\n      </div>\n\n      <div className={ styles.contentWrapper }>\n        <div\n          className={ styles.imgQr }\n        >\n          {/* downloadable */}\n          <img src={qrCode} alt={'QR Code'} />\n        </div>\n\n        <div className={ [styles.address, 'selectable'].join(' ') }>\n          { state.wallet.address }\n        </div>\n      </div>\n      <div className={ styles.buttonWrapper }>\n\n        <div className={ styles.backAndReady }>\n          <RoundButton\n            className={ styles.button }\n            back='true'\n            onClick={ () => {\n              changePageInfoAction(state, dispatch, 1)\n            }}\n          >\n            Back\n          </RoundButton>\n\n          <RoundButton\n            className={ styles.button }\n            next='true'\n            onClick={ () => {\n              changePageInfoAction(state, dispatch, 3)\n            }}\n          >\n            Ready\n          </RoundButton>\n        </div>\n\n\n        <RoundButton\n          className={ styles.button }\n          show={ (!!state.wallet?.address).toString() }\n          onClick={() => {\n            history.push('/wallet')\n          }}\n          colorbutton={'var(--colorHighlightDark)'}\n        >\n          Withdraw\n        </RoundButton>\n\n        <RoundButton\n          className={ styles.button }\n          colorbutton={'var(--colorHighlightDark)'}\n          show={ (state.network === 'testnet').toString() }\n          onClick={ () => {\n            // open faucet page in new window\n            window.open('https://bitcoinfaucet.uo1.net/', '_blank')\n          }}\n        >\n          Testnet faucet #1\n        </RoundButton>\n\n        <RoundButton\n          className={ styles.button }\n          colorbutton={'var(--colorHighlightDark)'}\n          show={ (state.network === 'testnet').toString() }\n          onClick={ () => {\n            // open faucet page in new window\n            window.open('https://testnet-faucet.mempool.co/', '_blank')\n\n          }}\n        >\n          Testnet faucet #2\n        </RoundButton>\n\n        <RoundButton\n          className={ styles.button }\n          colorbutton={'var(--colorHighlightDark)'}\n          onClick={ () => {\n            // open blockstream explorer for address in new window/tab\n            const pathEdit = (state.network === 'testnet') ? 'testnet/' : ''\n            window.open(\n              `https://blockstream.info/${pathEdit}address/${state.wallet.address}`\n            , '_blank')\n          }}\n        >\n          Open explorer\n        </RoundButton>\n\n      </div>\n    </div>\n  )\n}\n\n","import React from 'react'\nimport { RoundButton } from '../../general/RoundButton'\nimport styles from './P3DomainAndWallet.module.css'\nimport { Store } from '../../../store/'\nimport { changePageInfoAction } from '../../../store/actions'\nimport { scanAddressFullyAction } from './../../../store/actions'\nimport { ActionTypes } from './../../../interfaces'\nimport { getUnspentSum } from '../../../helpers/bns/bitcoin'\n\n/**\n * Bid on network\n */\nexport const P3DomainAndWallet = () => {\n  // global state\n  const { state, dispatch } = React.useContext(Store)\n\n  // Local state: keep track if API is busy\n  const [ apiStatus, setApiStatus ] = React.useState('ok')\n\n  // on state update detected by timestamp, reset api status\n  React.useEffect(() => { setApiStatus('ok') }, [ state.lastTimeStamp ])\n\n  // most important for domain notificaiton address is the transaction history to know ownership\n  // but also the current utxo in case we want to control the domain\n  const domainInfo = () => {\n    if (state.pageInfo.checkedDomain) {\n      return ('✓')\n    } else {\n      return ('needs scan')\n    }\n  }\n\n  // wallet needs utxo info including raw tx & tx history for nonce\n  const walletInfo = () => {\n    if (state.pageInfo.checkedWallet) {\n      return ( '✓' )\n    } else {\n      return ('needs scan')\n    }\n  }\n\n  // Conditions to enable next pages.\n  const readyStatus = () => {\n    if (!state.pageInfo.checkedDomain && !state.pageInfo.checkedWallet) {\n      return { isReady: false,    info: 'Scan both to move on' }\n    }\n    if (!state.pageInfo.checkedDomain && state.pageInfo.checkedWallet) {\n      return { isReady: false,    info: 'Scan domain to move on' }\n    }\n    if (state.pageInfo.checkedDomain && !state.pageInfo.checkedWallet) {\n      return { isReady: false,    info: 'Scan wallet to move on' }\n    }\n    if (state.pageInfo.checkedDomain && state.pageInfo.checkedWallet) {\n      return { isReady: true,     info: '' }\n    }\n    return { isReady: false,      info: 'Unknown status' }\n  }\n\n  return (\n    <div className={ styles.wrapper }>\n      <div className={ styles.title }>\n        Wallet and domain history needed\n      </div>\n      <div className={ styles.domainInfo }>\n        { (apiStatus !== 'domain')  && 'Domain ' + domainInfo() }\n        { (apiStatus === 'domain')  && 'Domain scanning...' }\n      </div>\n      <div className={ styles.domainButton }>\n        <RoundButton\n          onClick={ () => {\n            if (apiStatus === 'ok') {\n              setApiStatus('domain')\n              scanAddressFullyAction(state, dispatch, ActionTypes.UPDATE_DOMAIN)\n            }\n          }}\n        >\n          API Scan\n        </RoundButton>\n      </div>\n      <div className={ styles.walletInfo }>\n        { (apiStatus !== 'wallet')  && 'Wallet ' + walletInfo() }\n        { (apiStatus === 'wallet') && 'Wallet scanning...' }\n      </div>\n      <div className={ styles.walletButton }>\n        <RoundButton\n          onClick={ () => {\n            if (apiStatus === 'ok') {\n              setApiStatus('wallet')\n              scanAddressFullyAction(state, dispatch, ActionTypes.UPDATE_WALLET)\n            }\n          }}\n        >\n          API Scan\n        </RoundButton>\n      </div>\n      <div className={ styles.unspent }>\n        <div className={ styles.balance }>\n          { state.pageInfo.checkedWallet? (getUnspentSum(state.wallet.utxoList) / 1e8).toFixed(8) : 'n/a' }\n        </div>\n        { (state.network === 'testnet') ? ' tBTC' : ' BTC' }\n      </div>\n      <div className={ styles.ownership }>\n        { readyStatus().info }\n      </div>\n      <div className={ styles.buttonWrapper }>\n        <RoundButton\n          back='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 2)\n          }}\n        >\n          Back\n        </RoundButton>\n        <RoundButton\n          show={ readyStatus().isReady ? 'true' : 'false' }\n          next='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 4)\n          }}\n        >\n          Ready\n        </RoundButton>\n      </div>\n    </div>\n  )\n}\n\n","import React from 'react'\nimport styles from './InputForm.module.css'\nimport { RoundButton } from './../../general/RoundButton'\nimport sanitize from '../../../helpers/sanitize'\n\n/**\n * Reusable and styled form, label, textarea.\n * Component is internally a controlled component, but externally uncontrolled.\n * value is kept in text form, but can provide thisInputOnChange to optionally store it in another form elsewhere.\n * value is read internally, but initial value can be set with thisInitialValue\n */\nexport const InputForm = (props: any) => {\n  // local state so can edit / store textbox content without having\n  // to read from final state which might be a number or further sanitized\n  const [textValue, setTextValue] = React.useState()\n\n  if (textValue === undefined){\n    if (props.thisInputOnChange) props.thisInputOnChange({ target: { value: props.thisInitialValue || '' } })\n  }\n\n\n  React.useEffect(() => {\n    setTextValue(props.thisInitialValue || '')\n  }, [props.thisInitialValue] )\n\n  return (\n    <div\n      className={ [styles.wrapper, props.className].join(' ') }\n      style={ props.style }\n    >\n      <div className={ styles.shiftRight }>\n        <aside className={ styles.label }>\n          { props.thisInputLabel || '' }\n        </aside>\n        <textarea\n          className={ styles.textarea }\n          spellCheck={ false }\n          value={\n            // read what we see in the textarea\n            textValue\n            // props.thisInputValue\n          }\n\n          onChange={ (e?: any) => {\n\n            // set what we see in the textarea after removing unwanted chars like nextline\n            const cleanedValue = sanitize(e.target.value, (props.sanitizeFilters || ['oneline']))\n            setTextValue(cleanedValue)\n            // update value so it's single line for custom change function below if any\n            e.target.value = cleanedValue\n\n            // furthermore, run user provided setter\n            if (props.thisInputOnChange) props.thisInputOnChange(e)\n\n          } }\n        ></textarea>\n        <RoundButton\n          className={ [\n            styles.button,\n            props.showButton === 'false' ? styles.invisible : ''\n          ].join(' ') }\n          next={ 'true' }\n          onClick={ (e: any) => {\n            props.thisSubmitButtonOnClick ? props.thisSubmitButtonOnClick(textValue) : (()=>{})()\n          } }\n        >\n          OK\n        </RoundButton>\n        { (!!props.showBonusInformation) && (\n          <div className={ styles.bonusInformation }>\n            { props.children }\n          </div>\n        ) }\n      </div>\n    </div>\n  )\n}\n","import React from 'react'\nimport styles from './Switch.module.css'\n\n/**\n * Selection menu.\n * choices - Array of selection choices to choose from\n * initialIndex - index of the initially selected choice (1st by default, or 0) *\n * onClick - pass clicking event to use\n */\nexport const Switch = (props: any) => {\n\n  const [ selection, setSelection ] = React.useState()\n\n  const defaultChoices = [\n    { value: true,    display: 'yes',   do: () => { console.log('default true chosen') } },\n    { value: false,   display: 'no',    do: () => { console.log('default false chosen') } }\n  ]\n  const choices: Array<any> = props.choices || defaultChoices\n\n  if (selection === undefined) {\n    const initialIndex = props.initialIndex || 0\n    setSelection(initialIndex)\n    const initialValue = choices[initialIndex].value\n    console.log(initialIndex, initialValue, choices)\n    if (choices[initialIndex].do) choices[initialIndex].do(initialValue)\n  }\n\n  return (\n    <div\n      className={ [styles.wrapper, props.className].join(' ') }\n    >\n      <div className={ styles.shiftRight }>\n        <div className={ styles.label }>\n          { props.thisInputLabel || ''}\n        </div>\n        <div className={ styles.choiceArea }>\n          { choices.map((thisChoice: any, index: number) => (\n\n            <div\n              key={ index }\n\n              className={ [\n                styles.choice,\n                selection === index ? styles.selected : ''\n              ].join(' ') }\n\n              onClick={ (e) => {\n                // change local state of selection\n                setSelection(index)\n                // do the corresponding action\n                if (thisChoice.do) thisChoice.do(thisChoice.value)\n                // do other stuff passed in onClick\n                if (props.onClick) props.onClick(e)\n\n                console.log('', thisChoice.display || String(thisChoice.value), 'chosen')\n              } }\n            >\n\n              { thisChoice.display || String(thisChoice.value) }\n\n            </div>\n          )) }\n        </div>\n      </div>\n    </div>\n  )\n}\n","import React from 'react'\nimport { RoundButton } from '../../general/RoundButton'\nimport styles from './P4ActionChoice.module.css'\nimport { Store } from '../../../store/'\nimport { changePageInfoAction, changeChoicesBNSAction } from '../../../store/actions'\nimport { Details } from './../../general/Details'\nimport { runAllActionPermissionChecks, calcBnsState, getGetters, getSetters } from './../../../helpers/bns/'\nimport { I_Checked_Action } from './../../../helpers/bns/types'\nimport { InputForm } from './../../general/InputForm'\nimport { Switch } from './../../general/Switch'\nimport sanitize from '../../../helpers/sanitize'\n\n/**\n * Bid on network.\n */\nexport const P4ActionChoice = () => {\n  // global state\n  const { state, dispatch } = React.useContext(Store)\n\n  // local state for special cases where form is attempting to get data from user\n  const [extraFormData, setExtraFormData] = React.useState()\n  // local state for permission scan so can be used directly and becomes reactive\n  const [checkActions, setCheckActions] = React.useState()\n\n  // calculate and get all permissions (once)\n  if (!checkActions) {\n    // simulate bns state once again just in case\n    // up to current block height\n    const bns = calcBnsState(\n      state.domain.txHistory,\n      state.domain.domainName,\n      state.chain.height,\n      state.network\n    )\n    setCheckActions(runAllActionPermissionChecks(bns, state.wallet.address) as Array<I_Checked_Action>)\n  }\n\n  // help with understanding a get suggestion\n  const getSuggestInfo = (getSuggestion: any) => {\n    const get = getSuggestion.info.get\n    const network = state.network\n    const units = get.units\n    const min = get.min\n    const type = typeof get.value\n\n\n    if (type === 'number') {\n\n      // if satoshi, convert to btc\n      const btcMin = min ? (units === 'satoshi' ? (min / 1.0e8) : min) : 0\n      const btcUnits = network === 'testnet' ? 'tBTC' : 'BTC'\n      const btcValue = units === 'satoshi' ? (get.value / 1.0e8) : get.value\n\n\n      return {\n        value: get.value,                           // raw value\n        btcMin: '' + btcMin,                        // min in BTC\n        btcMinFull: btcMin.toFixed(8),              // ^ with 8 decimal places\n        type,                                       // typeof on min\n        units,                                      // original units\n        btcUnits,                                   // btc units tBTC or BTC\n        btcValue,                                   // btc value\n        btcValueFull: btcValue.toFixed(8)           // btc value with 8 decimal places\n      }\n    }\n\n    // if a string\n    return {\n      type,\n      value: get.value\n    }\n  }\n\n  // render suggestion data\n  const renderSetSuggestion = (setSuggestion: any, settings: any) => {\n    const set = setSuggestion.info.set\n    const value = setSuggestion.info.set.value\n\n    let valueToReturn = ['']\n    const valueArray = String(value).split(/ |\\n/)\n    const unitsArray = set.units.split(' ')\n\n    for (let i = 0; i < valueArray.length; i++) {\n      const thisValue = valueArray[i]\n      const units = unitsArray[i % unitsArray.length]\n\n      // if this is not the first set of values, add next line char\n      if (i % unitsArray.length === 0 && i !== 0) {\n        valueToReturn = [...valueToReturn, '\\n']\n      }\n\n      if (i % unitsArray.length === 0) {\n        if (settings.bullets) {\n          valueToReturn = [...valueToReturn, ' + ']\n        }\n      }\n\n\n      if (!isNaN(Number(thisValue))) {\n        // if value can be a number\n\n        // assume it's in bitcoin form already unless units are satoshi\n\n        // show btc value to 8 decimal spaces\n        if (settings.btcValueFull) {\n          if (units === 'satoshi') {\n            valueToReturn = [...valueToReturn, (parseInt(thisValue, 10) / 1.0e8).toFixed(8)]\n          } else {\n            valueToReturn = [...valueToReturn, parseFloat(thisValue).toFixed(8)]\n          }\n        }\n\n        // show correct btc units\n        if (settings.btcUnits) {\n          valueToReturn = [...valueToReturn, state.network === 'testnet' ? ' tBTC' : ' BTC']\n        }\n\n      } else {\n        // if not a number\n\n        // if function for strings was provided\n        if (settings.strings) {\n          valueToReturn = [...valueToReturn, ' ', ...settings.strings(thisValue), ' ']\n        }\n      }\n    }\n\n    return (\n      <>\n        { valueToReturn }\n      </>\n    )\n  }\n\n  // initializes extra form status from permission checks\n  React.useEffect(() => {\n    // only do if undefined local state (once)\n    if (!extraFormData) {\n      // go through each action, set key to .info and set show status to false\n      const showStatus: { [key: string]: { show: boolean } } = {}\n      checkActions.forEach((action: any) => {\n        showStatus[action.info] = { show: false }\n      })\n      setExtraFormData(showStatus)\n    }\n  }, [checkActions, extraFormData])\n\n  // list available actions for render\n  const listAvailableActions = () => (\n    !!checkActions && checkActions.map((action: any) => {\n      // usable actions only\n      if (action.isUsable) {\n        // abort if it has even 1 warning as well\n        if (action.suggestions.some((suggestion: any) => suggestion.info.warning)) return ''\n        // check if there's data needed from user for this action\n        const suggestionsToGet = action.suggestions.filter((suggestion: any) => ('get' in suggestion.info)) || []\n\n        console.log('action:', action.info)\n        console.log('getters:', getGetters(action))\n        console.log('setters:', getSetters(action))\n\n        const haveGettersOrSetters = (\n          suggestionsToGet.length > 0 || getSetters(action).length > 0\n        )\n\n        return (\n\n          // action div start\n          <div key={ action.info }>\n            {/* change what action button does based on if there's data to get */}\n            {/* missing data (~ get suggestion) means it has to be requested first before moving on */}\n            <RoundButton\n              next={ !haveGettersOrSetters ? 'true' : undefined }\n              onClick={ () => {\n                if (!haveGettersOrSetters) {\n\n                  // if regular action without extra data needed\n                  // set this action as the chosen action\n                  changeChoicesBNSAction(state, dispatch, {\n                    action: JSON.parse(JSON.stringify(action))\n                  })\n                  // change page\n                  changePageInfoAction(state, dispatch, 5)\n\n                } else {\n\n                  // if special action with extra data needed,\n                  // toggle form showing instead based on action info as key\n                  if (extraFormData) {\n                    const { show } = extraFormData[action.info]\n                    setExtraFormData({ ...extraFormData, [action.info]: { show: !show } })\n                  }\n\n                }\n              }}\n            >\n              { action.info }{\n                (haveGettersOrSetters)\n                  ? (<>&nbsp;...</>)\n                  : ''\n              }\n            </RoundButton>\n\n            {/* create input forms if shown */}\n\n            { (extraFormData && extraFormData[action.info].show) && (\n              <>\n                { suggestionsToGet.map((suggestionToGet: any) => {\n                  if (typeof suggestionToGet.info.get.value === 'boolean') {\n\n                    const onChangeFunction = (value: boolean) => {\n                      console.log(value)\n                      // find and change action setting\n                      checkActions\n                        .find((thisAction: any) => thisAction.type === action.type )\n                        .suggestions\n                        .find((thisSuggestion: any) =>\n                          thisSuggestion.info.describe === suggestionToGet.info.describe\n                        ).info.get.value = value\n                      // update local state with edited object\n                      setCheckActions([...checkActions])\n                    }\n\n                    return <Switch\n                      key={ suggestionToGet.info.describe }\n\n                      thisInputLabel={\n                        suggestionToGet.info.describe + ': \\n  ' +\n                        suggestionToGet.info.get.name\n                      }\n\n                      initialIndex={\n                        suggestionToGet.info.get.value ? 1 : 0\n                      }\n\n                      choices={[\n                        { value: false,   display: 'No',    do: onChangeFunction },\n                        { value: true,    display: 'Yes',   do: onChangeFunction }\n                      ]}\n                    />\n\n                  } else {\n\n                    return <InputForm\n                      key={ suggestionToGet.info.describe }\n\n                      showButton={ 'false' }\n\n                      className={ styles.inputForms }\n\n                      thisInputLabel={\n                        // show minimum if available in bitcoin units\n                        suggestionToGet.info.describe + (\n                          !suggestionToGet.info.get.min ? '' : (\n                            // if has a min\n                            '\\n' +\n                            '(at least ' +\n                            getSuggestInfo(suggestionToGet).btcMinFull + ' ' +\n                            getSuggestInfo(suggestionToGet).btcUnits + ' to get a winning ' +\n                            'valid bid )'.replace(/ /g, '\\xa0')\n                          )\n                        )\n                      }\n\n                      thisInitialValue={\n                        // if number, show in BTC and to 8 digits intially\n                        (typeof suggestionToGet.info.get.value === 'number')\n                          ? getSuggestInfo(suggestionToGet).btcValueFull\n                          // if not number just show the actual value\n                          : suggestionToGet.info.get.value\n                      }\n\n                      sanitizeFilters={ [typeof suggestionToGet.info.get.value] }\n\n                      thisInputOnChange={ (e: any) => {\n                        // type in bitcoin units\n                        // store into memory in expected units (depending on .units)\n\n                        // sanitize text\n                        let cleanInput: number | string\n\n                        if (\n                          typeof suggestionToGet.info.get.min === 'number' ||\n                          typeof suggestionToGet.info.get.value === 'number'\n                        ) {\n                          // if number\n                          cleanInput = sanitize(e.target.value, ['no_spaces', 'fractions', 'no_leading_zeros', 'decimal_point'])\n\n                          if (suggestionToGet.info.get.units === 'satoshi') {\n                            // convert to satoshi and then number\n                            cleanInput = Math.round(parseFloat(cleanInput) * 1.0e8)\n                          } else {\n                            // just convert to number\n                            cleanInput = Math.round(parseFloat(cleanInput))\n                          }\n\n                        } else {\n                          // if string, just make sure no spaces\n                          cleanInput = sanitize(e.target.value, ['no_spaces'])\n                        }\n\n                        // add changed value to checkActions current object\n                        // find and edit the value\n                        checkActions\n                          .find((thisAction: any) => thisAction.type === action.type )\n                          .suggestions\n                          .find((thisSuggestion: any) =>\n                            thisSuggestion.info.describe === suggestionToGet.info.describe\n                          ).info.get.value = cleanInput\n\n                        // update local state with edited object\n                        setCheckActions([...checkActions])\n                      } }\n                    />\n                  }\n                }) }\n                { (getSetters(action).length > 0) &&\n                  <Details description={ 'Details...' } show={ 'false' }>\n                    <p>\n                      { getSetters(action).map((setSuggestion: any, index: number) => {\n\n                        const setDescription = setSuggestion.info.describe || ''\n                        const setName = setSuggestion.info.set.name || ''\n\n                        return (\n                          <span key={ setDescription }>\n                            { index + 1 }. { setDescription }: { '\\n' }\n\n                            { renderSetSuggestion(setSuggestion, {\n                                btcValueFull: true,\n                                btcUnits: true,\n                                bullets: true,\n                                strings: (content: string) => ([\n                                  'for ',\n                                  <span\n                                    key={ setDescription + content }\n                                    className={ styles.breakable }\n                                  >\n                                    { content }\n                                  </span>\n                                ])\n                            }) }\n\n                            { ' ' + ('(' + setName + ')').replace(/ /g, '\\xa0') }\n                          </span>\n                        )\n\n                      } ) }\n                    </p>\n                  </Details>\n                }\n              </>\n            )}\n\n            { (extraFormData && extraFormData[action.info].show) && (\n              <RoundButton\n                className={ styles.okButton }\n                next={ 'true' }\n                onClick={ () => {\n\n\n                  // place the customized action object entirely into the global state\n                  changeChoicesBNSAction(state, dispatch, {\n                    action: action // JSON.parse(JSON.stringify( needed?\n                  })\n\n                  // change page\n                  changePageInfoAction(state, dispatch, 5)\n\n                  // const isNotEmpty = suggestionToGet.info.get.value !== ''\n                  // const meetsMinRequirement = (typeof suggestionToGet.info.get.min === 'number')\n                  //     ? (suggestionToGet.info.get.value >= suggestionToGet.info.get.min)\n                  //     : true\n\n                  // // if input is not blank\n                  // if (isNotEmpty && meetsMinRequirement) {}\n\n                } }\n              >\n                OK\n              </RoundButton>\n            ) }\n          </div>\n        )\n      } else {\n        return ''\n      }\n    })\n  )\n\n  // list unavailable actions for render\n  const listUnavailableActions = () => (\n    !!checkActions && checkActions.map((action: any) => {\n      if (!action.isUsable) {\n        return (\n          <div\n            className={\n              styles.unavailableActions__actionList__action\n            }\n            key={ action.info }\n          >\n            <div\n              className={\n                styles.unavailableActions__actionList__action__title\n              }\n            >\n              { action.info }\n            </div>\n            <div\n              className={\n                styles.unavailableActions__actionList__action__permissionList\n              }\n            >\n              { action.permissionList.map((permission: any) => {\n                if (!permission.isAllowed) {\n                  return (\n                    <div\n                      className={\n                        styles.unavailableActions__actionList__action__permissionList__permission\n                      }\n                      key={ permission.info.describe }\n                    >\n                      - { permission.info.describe }\n                    </div>\n                  )\n                } else { return '' }\n              })}\n            </div>\n          </div>\n        )\n      } else {\n        return ''\n      }\n    })\n  )\n\n\n\n\n  return (\n    <div className={ styles.wrapper }>\n      <div className={ styles.title }>\n        Available <span className={ styles.orange }>BNS</span> <br />actions\n      </div>\n      <div className={ styles.availableActions }>\n        {\n          listAvailableActions()\n        }\n      </div>\n      <div className={ styles.unavailableActions }>\n        <Details\n          description={ 'Show unavailable actions' }\n          className= { styles.unavailableActions__title }\n        >\n          <div className={ styles.unavailableActions__actionList }>\n            {\n              listUnavailableActions()\n            }\n          </div>\n        </Details>\n      </div>\n      <div className={ styles.buttonWrapper }>\n        <RoundButton\n          back='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 3)\n          }}\n        >\n          Back\n        </RoundButton>\n      </div>\n    </div>\n  )\n}","import React from 'react'\nimport { RoundButton } from '../../general/RoundButton'\nimport { Details } from './../../general/Details'\nimport styles from './P5CustomForwards.module.css'\nimport { Store, getOwner } from '../../../store/'\nimport { changePageInfoAction, changeChoicesBNSAction } from '../../../store/actions'\nimport { stringByteCount, BYTES_MAX, findLatestForwards, interpretCommand } from '../../../helpers/bns'\nimport sanitize from '../../../helpers/sanitize'\n\ntype Planned_Changes = { [key: string]: string }\n\n/**\n * Component to edit custom forwards information.\n * state - global state.\n * textboxContent - text content inside the network and address textareas.\n */\nexport const P5CustomForwards = () => {\n  // global state\n  const { state, dispatch } = React.useContext(Store)\n  // string to embed located at state.choices.embedString\n\n  // local state for content in textboxes for new network address changes\n  const [textboxContent, setTextboxContent] = React.useState({network: '', address: '' })\n\n\n  // Check if the main action requires space in the embed string.\n  // Return necessary string. No extra spaces.\n  // e.g. returns: '', '!ca 234', '!abc '\n  const getActionEmbedRequirements = (): string => {\n    const chosenAction = state.choices.action\n    let stringFromCommands = ''\n    // Go through all action's suggestions and combine any commands found.\n    // This is compatible with 0, 1, or multiple commands being used at same time.\n    chosenAction.suggestions.forEach((thisSuggestion: any) => {\n      if ('command' in thisSuggestion.info) {\n        // command setting found,\n        // so add its contents to string and add value in getter as command match\n        stringFromCommands += thisSuggestion.info.command + ' '\n        stringFromCommands += thisSuggestion.info.get.value + ' '\n      }\n    })\n\n    // remove extra space from end ('' stays '')\n    stringFromCommands = stringFromCommands.slice(0, -1)\n\n    // console.log('after checking', chosenAction.suggestions)\n    // console.log('getActionEmbedRequirements returned', stringFromCommands)\n    return stringFromCommands\n  }\n\n  // set global state's string to embed from an object of planned changes\n  const setPlannedChanges = (objForwards: Planned_Changes  = {}) => {\n    let forwardsString = ''\n    Object.keys(objForwards).forEach(fwNetwork => {\n      forwardsString += fwNetwork + ' ' + objForwards[fwNetwork] + ' '\n    })\n    // remove extra space from end ('' stays '')\n    forwardsString = forwardsString.slice(0, -1)\n\n    // to avoid useless rerenders, only change state\n    // if it current state string doesn't match calculated string\n    const needsChanging = forwardsString !== state.choices.embedString\n\n    if (needsChanging) {\n      changeChoicesBNSAction(state, dispatch, {\n        embedString: forwardsString\n      })\n    }\n  }\n\n  // Object of planned changes derived from\n  // global state embedString and action choice\n  const getPlannedChanges = () => {\n    // this is string that's going to be embedded\n    let forwardsString = state.choices.embedString\n\n    // get required by actions string as well\n    let actionRequirementsString = getActionEmbedRequirements()\n\n    // combine (later string values are given priority)\n    const finalString = (\n      forwardsString\n      // if either are blank, no need to separate with space\n      + ((actionRequirementsString === '' || forwardsString === '') ? '' : ' ')\n      + actionRequirementsString\n    )\n\n    // convert all changes to object so same networks overwrite themselves as keys.\n    const changesObject = finalString.split(' ').reduce(\n      (\n        // add each planned change into plannedChangesSoFar\n        plannedChangesSoFar: Planned_Changes,\n        // from each word\n        word: string,\n        index: number,\n        // out of this array of words\n        words: Array<string>\n      ): Planned_Changes => {\n\n        if (index % 2 === 1) {\n          return { ...plannedChangesSoFar, [words[index - 1]]: word }\n        } else {\n          return plannedChangesSoFar\n        }\n\n      },\n      {} // initial value for plannedChangesSoFar\n    )\n    return changesObject\n  }\n\n\n  // If embed string is empty (to minimize calculations per render), call setPlannedChanges to initialize it\n  // since it doesn't update state unless it's necessary, no refresh is triggered each render\n  if (state.choices.embedString === '') setPlannedChanges(getPlannedChanges())\n\n  // Array of past {[network]:forwardingAddress} objects.\n  // Display only active ones with latest higher.\n  const pastForwards = findLatestForwards(getOwner(state)?.forwards || []).reverse()\n\n  // count # of bytes in string\n  const bytesOfChanges = stringByteCount(state.choices.embedString)\n  // count # of bytes left for storage\n  const bytesLeft = BYTES_MAX - bytesOfChanges\n  // if no more space\n  const isSpaceFull = bytesLeft < 0\n\n\n\n  /**\n   * Render explanation of the change with submitted forwards network name\n   */\n  const explainForwards = (fwNetwork: string) => {\n    const value = getPlannedChanges()[fwNetwork]\n\n    // display byte cost (including separator)\n    const bytes = stringByteCount(fwNetwork + ' ' + value)\n    const thisByteCostEstimate = (\n      <i>\n        {' '}({ bytes }-{ bytes + 1 }B)\n      </i>\n    )\n\n    // return first match for explanation content\n    const interpretation = () => {\n\n      // if it was a command\n      if (fwNetwork.startsWith('!')) {\n        const cmd = interpretCommand(fwNetwork, value)\n        return {\n          content: (\n            <>\n              { cmd ? (\n                <>\n                 { cmd.info } user action. { cmd.getterName } is set to <span>{ cmd.value }</span>.\n                </>\n               ) : 'User action' }\n              { thisByteCostEstimate }\n            </>\n          ),\n          allowRemoval: false\n        }\n      }\n\n      // regular forwarding: network's forwarding address was provided\n      if (value !== '') {\n        return {\n          content: (\n            <>\n              Updating forwarding on <span>{ ' ' + fwNetwork + ' ' }</span>\n              network to address of <span>{ ' ' + value + ' ' }</span>\n              { thisByteCostEstimate }\n            </>\n          ),\n          allowRemoval: true\n        }\n      }\n\n      // regular forwarding: if network's forwarding address was set blank\n      if (value === '') {\n        return {\n          content: (\n            <>\n              Deleting previously set forwarding information for\n              <span>{ ' ' + fwNetwork + ' '}</span> network\n              { thisByteCostEstimate }\n            </>\n          ),\n          allowRemoval: true\n        }\n      }\n\n      return { content: '' }\n   }\n\n\n    return (\n      <div\n        className={ styles.updateItem }\n        key={ fwNetwork }\n        onClick={ () => {\n          // fill in the edit field with these values in case\n          setTextboxContent({ network: fwNetwork, address: value })\n        } }\n      >\n        <div\n          className={ styles.updateInfo }\n        >\n          {\n            interpretation().content\n          }\n        </div>\n        {/* removal button. only render removal button if allowed */}\n        { (interpretation().allowRemoval) && (\n          <div\n            className={ ['btnCircle', styles.updateCancel, 'addTooltipRight'].join(' ') }\n            onClick={ (e) => {\n              const newData = { ...getPlannedChanges() }\n              delete newData[fwNetwork]\n              setPlannedChanges(newData)\n              // block event from also clicking onto the updateItem\n              e.stopPropagation()\n            } }\n          >\n            <span>×</span>\n            <aside>Remove from planned changes</aside>\n          </div>\n        ) }\n      </div>\n    )\n  }\n\n\n  console.log('bytes to embed', bytesOfChanges)\n\n  return (\n    <div className={ styles.wrapper }>\n\n      <div className={ styles.title }>\n        Update forwarding information\n      </div>\n\n      <div\n          className={ styles.subtitle }\n        >\n        BNS action: { state.choices.action.info }\n      </div>\n\n      <div className={ styles.changes }>\n\n        {/* bytes info */ }\n        { (Object.keys(getPlannedChanges()).length === 0) && 'No forwarding updates' }\n        { (!isSpaceFull) &&\n          <div className={ styles.bytesLeft }>\n            { bytesLeft } Bytes left\n          </div>\n        }\n        { (isSpaceFull) &&\n          <div className={ styles.bytesOver }>\n            Too much by { Math.abs(bytesLeft) } Bytes\n          </div>\n        }\n\n        {/* Show, explain, and allow editing and removing of each added key/value pair to embed */}\n        { Object.keys(getPlannedChanges()).map((fwNetwork: any) => explainForwards(fwNetwork)) }\n\n      </div>\n\n      <div className={ styles.editor } >\n        { (textboxContent.network.length > 0) &&\n          <div\n            className={ [styles.btnDelete, 'canPress'].join(' ') }\n            onClick={ () => {\n              setPlannedChanges({\n                ...getPlannedChanges(),\n                [textboxContent.network]: ''\n              })\n              setTextboxContent({ network: '', address: '' })\n            } }\n          >\n            delete old\n          </div>\n        }\n        <div\n          className={ styles.editorNetwork }\n        >\n          <aside>Network</aside>\n          <textarea\n            spellCheck={ false }\n            value={ textboxContent.network }\n            placeholder={ 'e.g. btc' }\n            onChange={ (e) => {\n              const cleanText = sanitize(e.target.value, ['oneline', 'no_spaces'])\n              setTextboxContent({ ...textboxContent, network: cleanText })\n            } }\n          ></textarea>\n        </div>\n        <div\n          className={ styles.editorAddress }\n        >\n          <aside>Forwarding address</aside>\n          <textarea\n            spellCheck={ false }\n            value={ textboxContent.address }\n            placeholder={ 'e.g. your btc address' }\n            onChange={ (e) => {\n              const cleanText = sanitize(e.target.value, ['oneline', 'no_spaces'])\n              setTextboxContent({ ...textboxContent, address: cleanText })\n              console.log('forwarding satnitized:', '\"' + cleanText + '\"')\n            } }\n          ></textarea>\n        </div>\n        <div\n          className={ ['btnCircle', styles.btnAdd, 'canPress', 'addTooltip'].join(' ') }\n          onClick={ () => {\n            if (textboxContent.network !== '') {\n              setPlannedChanges({\n                ...getPlannedChanges(),\n                [textboxContent.network]: textboxContent.address\n              })\n              setTextboxContent({ network: '', address: '' })\n            }\n          } }\n        >\n          <span>+</span>\n          <aside>Add to planned changes</aside>\n        </div>\n      </div>\n      <div className={ styles.pastList } >\n        <Details\n          description={ 'What\\'s this?' }\n        >\n          <p>\n            Enter the forwarding addresses you want to use (e.g. long bitcoin address) and specify on which network that address should be used (e.g. btc) when someone wants to reach you after looking up your domain alias.<br />\n            <br />\n            Submit new updates by hitting [+] button. Remove updates by hitting [x] buttons.<br />\n            <br />\n            Below, the currently active forwarding addresses are shown, if any.<br />\n            <br />\n            Edit them by reusing the exact same network or remove by setting forwarding address to nothing or hitting [no address] button under network name text.\n          </p>\n        </Details>\n        { pastForwards.map((fw: any, i: number) => {\n          return (\n            <div\n              className={ styles.pastPair }\n              key={ i }\n              onClick={ () => {\n                setTextboxContent({ network: fw.network, address: fw.address })\n              } }\n            >\n              <div className={ styles.pastNetwork } >\n                { fw.network }\n              </div>\n              <div className={ styles.pastAddress } >\n                { fw.address }\n              </div>\n            </div>\n          )\n        }) }\n      </div>\n      <div className={ styles.buttonWrapper }>\n        <RoundButton\n          back='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 4)\n          }}\n        >\n          Back\n        </RoundButton>\n        <RoundButton\n          next='true'\n          show={ bytesOfChanges > BYTES_MAX ? 'false' : 'true' }\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 6)\n          }}\n        >\n          Ready\n        </RoundButton>\n      </div>\n    </div>\n  )\n}\n\n","import React from 'react'\nimport styles from './FeesSelection.module.css'\nimport { Store } from '../../../store/'\nimport { RoundButton } from './../../general/RoundButton'\nimport sanitize from './../../../helpers/sanitize'\nimport {\n  changeChoicesBNSAction\n} from './../../../store/actions'\nimport { getFeeEstimatesAPI } from './../../../api/blockstream'\n\n/**\n * Fees selection dialogue.\n * Modifies global state.choices.feeRate.\n */\nexport const FeesSelection = () => {\n  // global state\n  const { state, dispatch } = React.useContext(Store)\n\n  // local states to track fees and suggestions\n  const [ feeText, setFeeText ] = React.useState(state.choices.feeRate)\n  const [ feeSuggestions, setFeeSuggestions ] = React.useState({\n    showSuggestions: false,\n    apiSuccess: false,\n    min20: 1,\n    min40: 1,\n    min60: 1,\n  })\n\n\n  // get new suggestions if never got them through api\n  // otherwise show previous\n  const tryFees = async () => {\n    // if haven't already got api results\n    if (!feeSuggestions.apiSuccess) {\n      try {\n        // get fee estimates from API\n        const apiSuggest = await getFeeEstimatesAPI(state.network, state.choices.apiPath)\n        setFeeSuggestions({\n          min20: apiSuggest['2'],\n          min40: apiSuggest['4'],\n          min60: apiSuggest['6'],\n          apiSuccess: true,\n          showSuggestions: true\n        })\n\n      } catch (e) {}\n    } else {\n      // show the previous values\n      setFeeSuggestions({\n        ...feeSuggestions,\n        showSuggestions: !feeSuggestions.showSuggestions\n      })\n    }\n  }\n\n\n  return (\n    <div className={ styles.fees }>\n      <div className={ styles.fees__rate }>\n        <aside>Fee rate (sat / vByte):</aside>\n        <textarea\n          spellCheck={ false }\n          value={ feeText }\n          placeholder={ 'e.g. 1.2' }\n          onChange={ (e) => {\n            const cleanText = sanitize(e.target.value, [\n              'numbers', 'decimal_point', 'no_leading_zeros'\n            ])\n            setFeeText(cleanText)\n            // 123. works in parseFloat and outputs 123 so safe\n            const cleanNumber = parseFloat(cleanText)\n            changeChoicesBNSAction(state, dispatch, { feeRate: cleanNumber })\n          } }\n        ></textarea>\n      </div>\n      <div className= { styles.fees__apicall }>\n        <RoundButton\n          onClick={ () => {\n            tryFees()\n          } }\n        >\n          Check online\n        </RoundButton>\n        { (feeSuggestions.showSuggestions) && (\n          <div className={ styles.fees__feeSelection }>\n            <div\n              className= { styles.fees__feeSelection__choice }\n              onClick={ () => {\n                setFeeText(feeSuggestions.min20)\n                changeChoicesBNSAction(state, dispatch, {\n                  feeRate: feeSuggestions.min20\n                })\n                setFeeSuggestions({...feeSuggestions, showSuggestions: false})\n              } }\n            >\n              { '< ' }20 min ( { feeSuggestions.min20.toFixed(1) } sat / vByte )\n            </div>\n            <div\n              className= { styles.fees__feeSelection__choice }\n              onClick={ () => {\n                setFeeText(feeSuggestions.min40)\n                changeChoicesBNSAction(state, dispatch, {\n                  feeRate: feeSuggestions.min40\n                })\n                setFeeSuggestions({...feeSuggestions, showSuggestions: false})\n              } }\n            >\n              { '< ' }40 min ( { feeSuggestions.min40.toFixed(1) } sat / vByte )\n            </div>\n            <div\n              className= { styles.fees__feeSelection__choice }\n              onClick={ () => {\n                setFeeText(feeSuggestions.min60)\n                changeChoicesBNSAction(state, dispatch, {\n                  feeRate: feeSuggestions.min60\n                })\n                setFeeSuggestions({...feeSuggestions, showSuggestions: false})\n              } }\n            >\n              { '< ' }60 min ( { feeSuggestions.min60.toFixed(1) } sat / vByte )\n            </div>\n          </div>\n        ) }\n      </div>\n    </div>\n  )\n}\n","import React from 'react'\nimport { Store } from '../../../store/'\nimport { RoundButton } from '../../general/RoundButton'\nimport styles from './P6Broadcast.module.css'\nimport { changePageInfoAction } from '../../../store/actions'\nimport { calcTx } from './../../../helpers/bns/'\nimport { txPushAPI } from './../../../api/blockstream'\nimport { getUnspentSum } from '../../../helpers/bns/bitcoin'\nimport { Details } from './../../general/Details'\nimport { FeesSelection } from './../../wallet/FeesSelection'\n\n/**\n * Broadcast tx page.\n * Fee selection.\n * Transaction summary/status. *\n */\nexport const P6Broadcast = () => {\n  // global state\n  const { state, dispatch } = React.useContext(Store)\n\n  // tx calculation\n  let tx: any;\n  let txIssue: string = ''\n  try {\n    tx = calcTx(\n      state.wallet,\n      state.domain,\n      state.choices,\n      state.network\n    )\n  } catch (e) {\n    txIssue = String(e.message)\n    if (txIssue.endsWith('has no matching Script')) {\n      txIssue += ' \\n(address provided seems invalid)'\n    }\n    console.log('error details if necessary:', e)\n  }\n\n  // summarize number of updates in the embeded string\n  const numberOfUpdates = (state\n    .choices\n    .embedString\n    .split(' ')\n    .reduce((countSoFar: number, word: string, index: number, words: Array<string>) =>\n      (index % 2 === 1) ? countSoFar + 1 : countSoFar\n    , 0)\n  )\n\n  // keep track of broadcast\n  const [ broadcastStatus, setBroadcastStatus ] = React.useState({\n    ok: false,\n    txid: '123',\n    reason: ''\n  })\n\n  // show BTC balance with styling and proper units based on network\n  const unitBTC = (state.network === 'testnet') ? ' tBTC ' : ' BTC '\n  const showBTC = (sats: number = 0): JSX.Element => (\n    <>\n      <span className={ styles.balance }>\n        { (sats / 1e8).toFixed(8) }\n      </span>\n      { unitBTC }\n    </>\n  )\n\n  const finalCost = tx ? (\n    // No point confusing user if the cost is negative.\n    // Possible with enough anyone-can-spend utxo found.\n    Math.max(tx.gatheredFromWallet - tx.change, 0)\n  ) : undefined\n\n  return (\n    <div className={ styles.wrapper }>\n      <div className={ styles.title }>\n        Finalize transaction details\n      </div>\n      <div className={ styles.fees }>\n        <FeesSelection />\n      </div>\n      <div className={ styles.totalCost }>\n        { (!!tx) ? <>Your final cost: { showBTC(finalCost) }</> : ' ' }\n      </div>\n      <div className={ styles.txSummary }>\n        { (!!tx) && (\n          <>\n            <Details>\n              <table><tbody>\n                <tr>\n                  <td>Action:</td>\n                  <td>{ state.choices.action.info }</td>\n                </tr>\n                <tr>\n                  <td>Updates:</td>\n                  <td>{ numberOfUpdates }</td>\n                </tr>\n                <tr>\n                  <td>Wallet:</td>\n                  <td>\n                    <p>{ showBTC(getUnspentSum(state.wallet.utxoList)) } total\n                    across { state.wallet.utxoList.length } utxo</p>\n                  </td>\n                </tr>\n                <tr>\n                  <td>Inputs:</td>\n                  <td>\n                    <p>{ showBTC(tx.gatheredFromWallet) } from\n                    {' '}{ tx.nInputsFromWallet } wallet utxo</p>\n                    <p>{ showBTC(tx.gatheredFromOther) } from\n                    {' '}{ tx.nInputsFromOther } notification utxo</p>\n                    <p>{ showBTC(tx.totalGathered) } total ({ tx.nInputsFromWallet + tx.nInputsFromOther } inputs)</p>\n                  </td>\n                </tr>\n                <tr>\n                  <td>Outputs:</td>\n                  <td>\n                    <p>Burning { showBTC(tx.burnAmount) } at #0</p>\n                    <p>Sending { showBTC(tx.notifyAmount) } at #1 (notification)</p>\n                    <p>Change of { showBTC(tx.change) } sent back at #2</p>\n                    <p>Refunds of { showBTC(tx.refundsAmount) } total</p>\n                    <p>{ showBTC(tx.totalGathered - tx.fee) } total ({ tx.nOutputs } outputs)</p>\n                  </td>\n                </tr>\n                <tr>\n                  <td>Miner fee:</td>\n                  <td>\n                    <p>{ showBTC(tx.fee) }{' '}\n                    ({(tx.fee / tx.valueNeeded * 100.0).toFixed(1)}%)</p>\n                  </td>\n                </tr>\n                <tr>\n                  <td>Size:</td>\n                  <td>{ tx.thisVirtualSize } vBytes</td>\n                </tr>\n                <tr>\n                  <td>Cost:</td>\n                  <td>\n                    <p>+ Transaction requires { showBTC(tx.valueNeeded) }</p>\n                    <p>- Using { showBTC(tx.gatheredFromOther) } from anyone-can-spend utxo</p>\n                  </td>\n                </tr>\n                <tr>\n                  <td>Net user cost:</td>\n                  <td>{ showBTC(tx.gatheredFromWallet - tx.change) }</td>\n                </tr>\n              </tbody></table>\n            </Details>\n          </>\n        )}\n        { (!tx) && (\n          <div className={ styles.txSummary }>\n            calculation failed <br />\n            { txIssue }\n          </div>\n        ) }\n      </div>\n      <div className={ styles.status }>\n        { (broadcastStatus.ok) ? (\n          <>\n            <div\n              className={ [styles.status__button, 'canPress'].join(' ') }\n              onClick={ () => {\n                const PATH = `https://blockstream.info/` +\n                `${ state.network === 'testnet' ? 'testnet/' : '' }tx/` +\n                `${ broadcastStatus.txid }`\n                window.open(PATH, '_blank')\n              } }\n            >\n              Success! Open in explorer\n            </div>\n          </>\n        ) : (broadcastStatus.reason.length > 0) ? (\n          <div className={ styles.status__failed }>\n            { broadcastStatus.reason }\n          </div>\n        ) : ''\n      }\n      </div>\n      <div className={ styles.buttonWrapper }>\n        <RoundButton\n          back={ 'true' }\n          onClick={ () => { changePageInfoAction(state, dispatch, 5) } }\n        >\n          Back\n        </RoundButton>\n        <RoundButton\n          show={ tx?.hex !== '' ? 'true' : 'false' }\n          onClick={ async () => {\n            if (tx && tx.hex) {\n              try {\n                const res = await txPushAPI(tx.hex, state.network, state.choices.apiPath)\n                setBroadcastStatus({ok: true, txid: res.txid, reason: '' })\n              } catch (e) {\n                setBroadcastStatus({ok: false, txid: '', reason: e.message })\n              }\n            } else {\n              setBroadcastStatus({ok: false, txid: '', reason: '' })\n            }\n          } }\n        >\n          Broadcast\n        </RoundButton>\n      </div>\n\n    </div>\n  )\n}","import React from 'react'\nimport { Store } from '../../store/'\nimport { CreateHeader } from './../CreateSteps/CreateHeader'\nimport { P1RestoreOrBackup } from '../CreateSteps/P1RestoreOrBackup'\nimport { P2LoadWallet } from '../CreateSteps/P2LoadWallet'\nimport { P3DomainAndWallet } from '../CreateSteps/P3DomainAndWallet'\nimport { P4ActionChoice } from '../CreateSteps/P4ActionChoice'\nimport { P5CustomForwards } from '../CreateSteps/P5CustomForwards'\nimport { P6Broadcast } from './../CreateSteps/P6Broadcast'\nimport styles from './CreateNavigator.module.css'\n\n/**\n * Handle navigation of alias manipulation\n */\nexport const CreateNavigator = () => {\n  // global state\n  const { state } = React.useContext(Store)\n\n  const page = state.pageInfo?.current\n\n  !page && console.log('Unknown Page')\n\n  return (\n    <>\n      <CreateHeader />\n      <div className={ [styles.wrapper, 'scrollbar'].join(' ') }>\n        <div className={ styles.horizontalScaler } >\n          { (page === 1) && <P1RestoreOrBackup /> }\n          { (page === 2) && <P2LoadWallet /> }\n          { (page === 3) && <P3DomainAndWallet /> }\n          { (page === 4) && <P4ActionChoice /> }\n          { (page === 5) && <P5CustomForwards /> }\n          { (page === 6) && <P6Broadcast /> }\n        </div>\n      </div>\n    </>\n  )\n}\n","import React from 'react'\nimport { CreateNavigator } from './../components/CreateNavigator'\n\nexport function Create () {\n  return (\n    <>\n      <CreateNavigator />\n    </>\n  )\n}\n","\n/**\n * Difference between timestampMsec timestamp relative to current time or another reference referenceTimestampMsec timestamp.\n * Returns days-hours-minutes string, days-hours string, if expired, and ms of difference.\n * @param   {number}  timestampMsec               Timestamp of interest (milliseconds).\n * @param   {number}  [referenceTimestampMsec=]   Reference timestamp (milliseconds).\n * @returns {object}                              { dhm, dh, isExpired, msDiff, ... }.\n */\nexport default function timeDiff(\n  timestampMsec: number, referenceTimestampMsec: number = Date.now()\n): {\n  dhm: string\n  dh: string\n  isExpired: boolean\n  msDiff: number\n  timestampMsec: number\n  referenceTimestampMsec: number\n} {\n  let diff = timestampMsec - referenceTimestampMsec\n  // note sign\n  const isExpired = (diff <= 0)\n  // mod away higher time frames\n  diff = Math.abs(diff)\n  const d = Math.floor(diff / (1000 * 60 * 60 * 24))\n  // remove days\n  diff -= d * (1000 * 60 * 60 * 24)\n  const h = Math.floor(diff / (1000 * 60 * 60)) % 24\n  // remove hours\n  diff -= h * (1000 * 60 * 60)\n  const m = Math.floor(diff / (1000 * 60)) % 60\n  return {\n    dhm: `${d} days ${h} hours ${m} min`,\n    dh: `${d} days ${h} hours`,\n    isExpired,        // time difference is to the past of now? (boolean)\n    msDiff: diff,\n    timestampMsec,\n    referenceTimestampMsec\n  };\n}","import React from 'react'\nimport { Store, getOwner, getBidding } from '../../store/'\nimport { Link } from 'react-router-dom'\nimport styles from './SearchResults.module.css'\nimport timeDiff from './../../helpers/timediff'\nimport { OWNERSHIP_DURATION_BY_BLOCKS, CHALLENGE_PERIOD_DURATION_BY_BLOCKS, interpretFw, findLatestForwards } from '../../helpers/bns/'\nimport { Details } from './../general/Details'\n\nexport const SearchResults = () => {\n  // global state\n  const { state } = React.useContext(Store)\n\n  // calc time left in ownership via block heights\n  // temp object to keep track of timers\n  let diff = { isExpired: true, dh: '', msDiff: 0 }\n  const owner = getOwner(state)\n  if (owner) {\n    const heightOfExpiration = owner.winHeight + OWNERSHIP_DURATION_BY_BLOCKS\n    const blocksUntilExpires = (heightOfExpiration - state.chain.height)\n    const msUntilExpires = blocksUntilExpires * 10.0 * 60.0 * 1000.0\n    diff = timeDiff(msUntilExpires, 0)\n  }\n\n  // show BTC balance with styling and proper units based on network\n  const unitBTC = (state.network === 'testnet') ? ' tBTC ' : ' BTC '\n  const showBTC = (sats: number = 0): JSX.Element => (\n    <>\n      <span className={ styles.balance }>\n        { (sats / 1e8).toFixed(8) }\n      </span>\n      { unitBTC }\n    </>\n  )\n\n  const notificationLink = (\n    <span\n      className={ [styles.breakable, styles.linkable].join(' ') }\n      key={'notify1'}\n      onClick={ ()=> {\n        const pathEdit = (state.network === 'testnet') ? 'testnet/' : ''\n        window.open(\n          `https://blockstream.info/${pathEdit}address/${state.domain.notificationAddress}`\n          , '_blank'\n        )\n      } }\n    >\n      { state.domain.notificationAddress }\n    </span>\n  )\n\n  let nAddress = 0\n  const addressLink = (address: string) => (\n    <span\n      className={ [styles.breakable, styles.linkable].join(' ') }\n      key={ address + nAddress++ }\n      onClick={ ()=> {\n        const pathEdit = (state.network === 'testnet') ? 'testnet/' : ''\n        window.open(\n          `https://blockstream.info/${pathEdit}address/${address}`\n          , '_blank'\n        )\n      } }\n    >\n      { address }\n    </span>\n  )\n\n  // get ownership info\n  const tabledOwnershipData = owner ? [\n    [['Owner'],               [[\n                                addressLink(owner.address)\n                              ]]\n    ],\n    [['Notifications'],       [[\n                                notificationLink\n                              ]]\n    ],\n    [['Ownership extended'],  [\n                                [owner.winHeight + ' block height'],\n                                [new Date(owner.winTimestamp * 1000).toUTCString()],\n                                [timeDiff(owner.winTimestamp * 1000).dh + ' ago'],\n                                [\n                                  <React.Fragment\n                                    key={ 'ownership1' }\n                                  >\n                                    { showBTC(owner.burnAmount) } winning bid\n                                  </React.Fragment>\n                                ]\n                              ]\n    ],\n    [['Ownership expires'],   [\n                                [(owner.winHeight + OWNERSHIP_DURATION_BY_BLOCKS) + ' block height'],\n                                [\n                                  '≈ ' + new Date(\n                                    (OWNERSHIP_DURATION_BY_BLOCKS * 10.0 * 60.0 + owner.winTimestamp) * 1000\n                                  ).toUTCString()\n                                ],\n                                ['in ≈ ' + diff.dh]\n                              ]\n    ]\n  ] : []\n\n  // get burning info\n  const { isBurn, bidding } = getBidding(state)\n  const tabledBiddingData = isBurn ? [\n    [['Owner'],             [['Owner will be determined when bidding period ends']]],\n    [['Notifications'],    [[\n                              notificationLink\n                            ]]\n    ],\n    [['Bidding start'],     [\n                              [bidding.startHeight + ' block height'],\n                              // first bid is one that starts it so unix time stamp accurate\n                              [new Date(bidding.bids[0].timestamp * 1000.0).toUTCString()],\n                              [timeDiff(bidding.bids[0].timestamp * 1000.0).dh + ' ago']\n                            ]\n    ],\n    [['Bidding ends'],      [\n                              [bidding.endHeight + ' block height'],\n                              [\n                                '≈ ' + new Date(\n                                  bidding.bids[0].timestamp * 1000.0 + (CHALLENGE_PERIOD_DURATION_BY_BLOCKS * 10.0 * 60.0 * 1000.0)\n                                ).toUTCString()\n                              ],\n                              [\n                                'in ≈ ' + timeDiff(\n                                  bidding.bids[0].timestamp * 1000.0 + (CHALLENGE_PERIOD_DURATION_BY_BLOCKS * 10.0 * 60.0 * 1000.0)\n                                ).dh\n                              ]\n                            ]\n    ],\n    [['Bidders'],           [\n                              ...(bidding.bids.map((thisBid: any, bidIndex: number) => (\n                                [\n                                  <React.Fragment\n                                    key={ 'bidding' + bidIndex }\n                                  >\n                                    { showBTC(thisBid.value) } burned by\n                                    {' '}<span className={ styles.breakable }>{ thisBid.address }</span>\n                                  </React.Fragment>\n                                ]\n                              )))\n                            ]\n    ]\n  ] : []\n\n  // get most basic available domain info\n  const tabledAvailableDomainData = [\n    [['Owner'],             [['No owner. No bids.']]],\n    [['Notifications'],     [[\n                              notificationLink\n                            ]]\n    ]\n  ]\n\n  // display data in styled table format\n  const expandableTable = (inputData: Array<any>, inputDescription: string) => {\n    if (inputData.length === 0) return ''\n    return (\n      <div className={ styles.ownershipDetails }>\n        <Details\n          description={ inputDescription }\n        >\n\n          <table><tbody>\n            { inputData.map((rows: any, index: number) => (\n              <tr\n                key={ rows[0][0] }\n              >\n                <td>{ rows[0][0] }</td>\n                <td>\n                  {\n                    rows[1].map((dataRows: any, dataRowIndex: number) => (\n                      <p\n                        key={ [index,dataRowIndex].join(' ') }\n                      >\n                        { dataRows }\n                      </p>\n                    ))\n                  }\n                </td>\n              </tr>\n            )) }\n          </tbody></table>\n\n        </Details>\n      </div>\n    )\n  }\n\n  // calculate latest forwards\n  const latestForwards = owner ? findLatestForwards(owner.forwards) : []\n\n  return (\n    <div className={ styles.wrapper }>\n\n      {/* summarize search */}\n      <div className={ styles.matches } >\n        <div>\n          { state.domain.txHistory.length } transaction{ state.domain.txHistory.length === 1 ? '' : 's' } found on { state.network }\n        </div>\n        <div>\n          {\n            latestForwards.length\n          } current forward{\n            latestForwards.length === 1\n              ? ''\n              : 's'\n          }\n        </div>\n      </div>\n\n      <div className={ [styles.scrollbars, 'scrollbar'].join(' ') }>\n\n        {/* scrollable search results */}\n        <div className={ styles.listContainer } >\n\n          <div\n            className={ styles.describe }\n          >\n\n            {/* no wonder but bidding period started */}\n            { (!!isBurn) && (\n                expandableTable(tabledBiddingData, 'Bidding period domain details')\n            ) }\n\n            {/* if no owner and no bidding - totally available */}\n            { (!isBurn && !owner) && (\n              expandableTable(tabledAvailableDomainData, 'Unowned domain details')\n            ) }\n\n            {/* owner exists - ownership details */}\n            { (!!owner) && (\n              expandableTable(tabledOwnershipData, 'Owned domain details')\n            ) }\n\n          </div>\n\n          {/* general search results */}\n          {\n            latestForwards.map((fw: any) => {\n              const ifw = interpretFw(fw)\n              if (ifw.render) {\n                return (\n                  <a\n                    key={ fw.network }\n                    className={ styles.listItem }\n                    href={ (ifw?.link || '') || undefined }\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                  >\n                    <span className={ styles.key }>{ ifw.where }</span>\n                    { ifw.what }\n                  </a>\n                )\n              } else {\n                return ('')\n              }\n            })\n          }\n\n          { (!!owner) && (\n            <a\n              className={ styles.listItem }\n              href={ interpretFw({\n                network: 'btc',\n                address: state.domain.currentOwner,\n                updateHeight: 0,\n                updateTimestamp: 0\n              }, state.network).link || undefined }\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              <span className={ styles.key }>control address: </span>\n              { state.domain.currentOwner }\n          </a>\n          ) }\n\n          {/* show if domain is available */}\n          <div className={ styles.avaiability }>\n            {(!owner) && (\n              <Link\n                to='/create'\n                className={ styles.createLink }\n              >\n                { isBurn ? 'Join bidding' : 'Domain available!' }\n              </Link>\n            )}\n          </div>\n\n        </div>\n      </div>\n    </div>\n  )\n}\n\n\n\n","import React, { useEffect, useRef } from 'react'\nimport { RoundButton } from './../general/RoundButton'\nimport { Store } from '../../store/'\nimport { searchAction, changeAliasAction } from './../../store/actions/'\nimport { SearchResults } from './../SearchResults'\nimport styles from './HomeContent.module.css'\n\n/**\n * Root landing page.\n */\nexport const HomeContent = (props: any): JSX.Element => {\n  const { state, dispatch } = React.useContext(Store)\n\n  // if page is loaded with #/id/:alias format\n  // this will change alias to that one\n  // then it will navigate to '/'\n  // and then it will do search with new alias\n  // http://localhost:3000/#/id/satoshi\n  const alias = props?.match?.params?.alias\n  if (alias) {\n    searchAction({...state, alias}, dispatch, props.history)\n  }\n\n  // is serach done\n  const isSearchDone = () => state.pageInfo.checkedLightSearch\n\n  // put the textarea (by ref) into focus on mount and move caret to end\n  const inputEl = useRef<HTMLTextAreaElement>(null)\n  useEffect(() => {\n    if (inputEl && inputEl.current) {\n      inputEl.current.selectionEnd = inputEl.current.value.length\n      inputEl.current.selectionStart = inputEl.current.value.length\n      inputEl.current.focus()\n    }\n  }, [])\n\n  return (\n    <div className={ styles.wrapper }>\n      <div className={\n        !isSearchDone()\n          ? [styles.lblMainTitle].join(' ')\n          : [styles.lblMainTitle, styles.lblMainTitleAfter].join(' ')\n      }>\n        <span>Bitcoin</span> Name System\n      </div>\n      <div className={\n        !isSearchDone()\n          ? styles.divSearch\n          : [styles.divSearch, styles.divSearchAfter].join(' ')\n      }>\n        <textarea\n          id=\"txtSearch\"\n          className={ styles.txtSearch }\n          cols={ 30 }\n          rows={ 1 }\n          spellCheck={ false }\n          value={ state.alias }\n          placeholder={ 'e.g. satoshi' }\n          ref={ inputEl }\n          onChange={ e => changeAliasAction(state, dispatch, e?.target?.value) }\n          onKeyPress={ e => { e.key === 'Enter' && searchAction(state, dispatch) } }\n        ></textarea>\n        <RoundButton\n          sizebutton='2.6'\n          onClick={ () => searchAction(state, dispatch) }\n        >\n          .btc\n        </RoundButton>\n      </div>\n      <div\n        className={ styles.results }\n        style={{ display: isSearchDone() ? 'block' : 'none' }}\n      >\n        <SearchResults />\n      </div>\n    </div>\n  )\n}\n","import React from 'react'\nimport { HomeContent } from './../components/HomeContent'\n\nexport const Home = (props: any): JSX.Element => {\n  return (\n    <>\n      <HomeContent { ...props } />\n    </>\n  )\n}\n","import React from 'react'\nimport { Switch } from './../components/general/Switch'\nimport { InputForm } from './../components/general/InputForm'\nimport { Store } from '../store/'\nimport { ActionTypes } from './../interfaces/'\n\n/**\n * Settings path page. (temporarily used for testing)\n */\nexport const Settings = (props: any): JSX.Element => {\n  // global state\n  const { state, dispatch } = React.useContext(Store)\n\n  return (\n    <>\n    <br /><br />\n      <div>Settings</div>\n      <br />\n      <div>(todo)</div>\n      <br />\n      subject to changes until launch\n      <br />\n      high chance of bugs and losses, especially until reviewed\n      <br /><br />\n\n      <div>\n        Network:\n        <Switch\n          choices={ [\n            { value: 'testnet', do: () => { dispatch({ type: ActionTypes.LOAD_STATE, payload: { ...state, network: 'testnet' } }) }},\n            { value: 'mainnet', do: () => { dispatch({ type: ActionTypes.LOAD_STATE, payload: { ...state, network: 'bitcoin' } }) } }\n          ] }\n        />\n      </div>\n\n      <br />\n\n      <InputForm\n        style={ { width: '80%' } }\n        thisInputLabel={ 'Path for full node with esplora API' }\n\n        thisInitialValue={ state.choices.apiPath[state.network] }\n\n        showBonusInformation={ 'true' }\n        sanitizeFilters={ ['url'] }\n\n        thisSubmitButtonOnClick={ (textValue: string) => {\n          state.choices.apiPath[state.network] = textValue\n          console.log('click set value to ', textValue)\n          dispatch({\n            type: ActionTypes.LOAD_STATE,\n            payload: { ...state}\n          })\n        } }\n      >\n        { state.network } : { state.choices.apiPath[state.network] }\n      </InputForm>\n\n      <br /><br />\n\n      <div>\n        Automatically save data to browser (local storage) ? (todo)<br />\n        <Switch\n          choices={ [\n            { value: 'not allow' },\n            { value: 'allow' }\n          ] }\n        />\n      </div>\n      <div>\n        (if yes) Provide a password to encrypt local storage <br />with to hide it from other applications (todo)\n        <br /> [todo textbox form]\n      </div>\n    </>\n  )\n}","import React from 'react'\nimport styles from './Logo.module.css'\n\n/**\n * Bitcoin Logo\n */\nexport const Logo = (props: any) => {\n  return (\n    <div {...props}>\n      <div className={ styles.wrapper }>\n        <div\n          className={ styles.logo }\n        >\n          <span>₿</span>\n        </div>\n      </div>\n    </div>\n  )\n}\n","import React from 'react'\nimport { Logo } from './../Logo'\nimport styles from './LogoBackground.module.css'\n\n/**\n * Turn logo into background.\n */\nexport const LogoBackground = (props: any) => {\n  return (\n    <div className={ styles.wrapper }>\n      <Logo\n        className={ styles.logo }\n      />\n    </div>\n  )\n}","import React from 'react'\nimport { Store, unitsBTC, satsToBTCSpaced } from '../../../store/'\nimport styles from './Withdraw.module.css'\nimport { RoundButton } from './../../general/RoundButton'\nimport { ActionTypes } from './../../../interfaces'\nimport {\n  scanAddressFullyAction,\n  // changePageInfoAction\n} from './../../../store/actions'\n// import { useHistory } from 'react-router-dom'\nimport { getUnspentSum } from '../../../helpers/bns/bitcoin'\nimport { FeesSelection } from './../FeesSelection'\nimport { LogoBackground } from './../../general/LogoBackground'\n\n/**\n * Allow withdrawals\n */\nexport const Withdraw = () => {\n  // global state\n  const { state, dispatch } = React.useContext(Store)\n\n  // Local state: keep track if API is busy\n  const [ apiStatus, setApiStatus ] = React.useState('ok')\n\n  const showBTC = (sats: number = 0): JSX.Element => (\n    <>\n      <span className={ styles.balance }>\n        { satsToBTCSpaced(sats) }\n      </span>\n      { ' ' + unitsBTC(state) + ' ' }\n    </>\n  )\n\n  // const history = useHistory()\n  // if wallet is not loaded, send to create page 1\n  // if (!state.wallet.mnemonic) {\n  //   changePageInfoAction(state, dispatch, 1)\n  //   history.push('/create')\n  // }\n\n  return (\n    <div className={ styles.wrapper }>\n\n      <LogoBackground />\n\n      (NOT DONE)\n\n      <div className={ styles.title }>\n        Withdraw from wallet\n      </div>\n\n      <div className={ styles.request }>\n        { !state.pageInfo.checkedWallet && (\n          <>\n            <RoundButton\n              onClick={ () => {\n                if (apiStatus === 'ok') {\n                  setApiStatus('wallet')\n                  scanAddressFullyAction(state, dispatch, ActionTypes.UPDATE_WALLET)\n                }\n              }}\n            >\n              Scan wallet\n            </RoundButton>\n          </>\n        ) }\n      </div>\n\n      { state.pageInfo.checkedWallet && (\n        <div className={ styles.fees }>\n          <FeesSelection />\n        </div>\n      ) }\n\n      { state.pageInfo.checkedWallet && (\n        <div className={ styles.total }>\n          { showBTC(\n            getUnspentSum(state.wallet.utxoList)\n          ) }\n        </div>\n      ) }\n      <div>\n        to address\n      </div>\n      <div>\n        to amount\n      </div>\n      <div>\n        returned amount\n      </div>\n      <div>\n        broadcast button\n      </div>\n    </div>\n  )\n}\n","import React from 'react'\nimport { Withdraw } from './../components/wallet/Withdraw'\n\nexport const Wallet = (props: any): JSX.Element => {\n  return (\n    <>\n      <Withdraw { ...props } />\n    </>\n  )\n}\n","import React from 'react'\nimport styles from './Wallet.module.css'\n// import { psbt } from './psbt'\n\n\n\n\n\n\n/**\n * Reusable component for creating a wallet.\n * Let's pass obvious data via props.\n * Simulates behavior of browser wallet plugins without needing them. *\n */\nexport const Wallet = (props: any): JSX.Element => {\n  // stores and initializes tx builder from initial state and passed props\n  const [txBuilder, setTxBuilder]: [I_TxBuilder | null, any] = React.useState(null)\n  if (txBuilder === null) setTxBuilder({\n    ...initialTxBuilder,\n    ...(!!props.txBuilder ? props.txBuilder : {})\n  })\n\n\n  // stores fed params\n  const [params, setParams]: [any, (args: any) => void] = React.useState({})\n\n  // run methods to handle detection and processing of parameters after '#' in URL\n  React.useEffect(() => handleParamsChanges(params, setParams), [params])\n\n  return (\n    <div className={ styles.wrapper }\n      onClick={ () => {\n        console.log({ params, txBuilder })\n      } }\n    >\n      { (TESTING) && (\n        <>\n          log state\n        </>\n      ) }\n    </div>\n  )\n}\n\n\n/* -------------------------------------------------------------------------- */\n/*                              helpers (for now)                             */\n/* -------------------------------------------------------------------------- */\n\n// run methods to handle detection and processing of parameters after '#' in URL\nconst handleParamsChanges = (params: any, setParams: any) => {\n\n  // event to detect url change\n  window.addEventListener('hashchange', handleHashChange(params, setParams))\n  return () => {\n    // clean up function is returned to run if component is removed (or changed)\n    window.removeEventListener('hashchange', handleHashChange(params, setParams))\n    // clean up url as well\n    resetUrl()\n  }\n}\n\n// curried url change handler\nconst handleHashChange = (params: any, setParams: any) => (e: any): void => {\n  // convert url string starting with # into key/value pair object\n  // #/ok/?a=b&c=d becomes { a:b, c:d }\n  const fedValues = window.location.hash\n    .split('#')\n    .slice(1) // removes all before 1st # and 1st #\n    .join('')\n    .split('?')\n    .slice(1) // removes all before 1st ? and 1st ?\n    .join('')\n    .split('&') // split between sets of key-value pairs\n    .reduce((finalParamObject: any, thisKeyValue: string) => {\n      // assume values were passed through encodeURIComponent() so only '=' are from standard format\n      const splitKeyValue = thisKeyValue.split('=')\n      const thisKey = splitKeyValue[0]\n      const thisValue = decodeURIComponent(splitKeyValue[1])\n      if (thisKey === '') {\n        // no change\n        return finalParamObject\n      } else {\n        // check if key/value already exist within params\n        if ((thisKey in params) && (params[thisKey] === thisValue)) {\n          // if so, no need to add\n          return finalParamObject\n        } else {\n          // add changes\n          return { ...finalParamObject, [thisKey]: thisValue }\n        }\n      }\n    }, {})\n\n  // only update state if there are new values, avoid pointless rerenders\n  if (Object.keys(fedValues).length > 0) {\n    const newParams = { ...params, ...fedValues }\n    console.log('new wallet params added:', newParams)\n    setParams(newParams)\n  }\n}\n\n// remove params from URL\nconst resetUrl = () => {\n  window.history.pushState({}, '', `${ window.location.href.split('?')[0] }`)\n  // emit event if param or url change needs to be detected\n  // window.dispatchEvent(new HashChangeEvent(\"hashchange\"));\n}\n\n// if development mode\nconst TESTING = (process.env.NODE_ENV === 'development')\n\n\n/* -------------------------------------------------------------------------- */\n/*                               Initial values                               */\n/* -------------------------------------------------------------------------- */\n\nconst initialTxBuilder: I_TxBuilder = {\n  network: null,\n  setVersion: null,\n  setLocktime: null,\n  feeRate: null,\n\n  minFeeRate: 1.0,\n  maxFeeRate: 1000.0,\n  minOutputValue: 500,\n\n  result: {\n    tx: null,\n    hex: null,\n    virtualSize: 0\n  },\n\n  inputs: {},\n  fillInputs: null,\n\n  outputs: {},\n  changeAddress: null\n}\n\n\n/* -------------------------------------------------------------------------- */\n/*                                    Types                                   */\n/* -------------------------------------------------------------------------- */\n\n// everything I need to build any tx\n// matching as close as possible to bitcoinjs psbt design\ninterface I_TxBuilder {\n  network: 'bitcoin' | 'testnet' | null\n  setVersion: number | null\n  setLocktime: number | null\n  feeRate: number | null\n\n  // some safety things to check\n  minFeeRate: number | null         // sat/vByte\n  maxFeeRate: number | null         // sat/vByte\n  minOutputValue: number | null     // sats\n\n  result: {\n    tx: ObjectOrNull\n    hex: string | null\n    virtualSize: number | null\n  }\n\n  // MUST USE / USED inputs as exact input info object with input index as keys\n  // so specific indexes can be set by user, the rest filled in automiatcally.\n  inputs: {\n    [inputIndex: string]: I_Input\n  }\n\n  // OPTIONAL INPUTS:\n  // array of other possible inputs to use,\n  // used in exact order of this array,\n  // priority given to defined inputs always.\n  // (TODO) if only address + keys given, wallet could get missing info\n  // to create 1-multiple inputs from 1 address\n  // adds to inputs if used\n  fillInputs: Array<I_Input> | null\n\n  // MUST use outputs\n  outputs: {\n    [outputIndex: string]: {\n      address: string | null // standard tx to address that will generate output at that addrss\n\n      // for OP_RETURN that has no address can be fed for with data to embed\n      // bitcoin.payments.embed({ data: [bufferOfDataToEmbed] }).output\n      script: Buffer | null\n\n      value: number | null  // sats we need to pay\n    }\n  }\n\n  changeAddress: string | null      // where left over change goes, adds to outputs if used\n\n}\n\ntype ObjectOrNull = Exclude<\n  { [any: string]: any } | null, undefined\n>\n\ninterface I_Input {\n  // to create input\n\n  hash: string | null                       // txid (32B, 64 char hex) (dislike little endian buffer)\n  index: number | null                      // vout (integer)\n  sequence: number | null                   // e.g. 0xfffffffe\n  nonWitnessUtxo: Buffer | null             // raw tx buffer, only 1 that works for all types\n  witnessScript: Buffer | null              // original script, via bitcoin.script.compile([opcodes, ...])\n  redeemScript: Buffer | null               // original script, via bitcoin.script.compile([opcodes, ...])\n\n\n  // to sign and finalize:\n\n  // ONLY spenders values for script, same format as scripts,\n  // since these can have signatures, have to submit a function that returns script buffer.\n  // key pairs + sighashTypes will become sigs[0+] if needed\n  // e.g. inputScript: {sigs} => { return bitcoin.script.compile([OP_TRUE, sigs[0]]) }\n  // ((TODO): psbt.getHashForSig , .hashForSignature , hashForWitnessV0 , keypair.sign(hash))\n  inputScript: (({ sigs }: { sigs: ObjectOrNull[] | null }) => Buffer) | null\n\n  // ( (TODO):\n  //  canJustSign:\n  //    true means wallet just use\n  //      psbt.signInput(vin, keyPair); psbt.finalizeInput(vin);\n  //    false means it is fancy script so have to feed it\n  //      psbt.finalizeInput(vin, getFinalScripts({ inputScript, network }))\n  // )\n  canJustSign: boolean | null\n  keyPairs: ObjectOrNull[] | null\n  sighashTypes: number[] | null\n\n  // to explain to user each value when waiting for confirmation\n  address: string | null\n  value: number | null\n  confirmed: boolean | null\n  info: string | null\n}\n\n/* -------------------------------------------------------------------------- */\n/*                                 Temp notes                                 */\n/* -------------------------------------------------------------------------- */\n\n/**\n *\n * what's best for passing data?\n * - querry strings\n *    - users can accidentally edit or on purpose (I like that it's visible and customizable)\n *    - works cross origin (just put in confirmation checks)\n *    - needs unique path or could be confusing to other components\n *    - confusing url for user (needs cleanup after read imo)\n *    - much less data can be passed (so have to get your own data)\n *    - if pass ? after #, not querry string so no forced rerender\n *      and separate from querry string search links\n *\n * - local storage\n *    - cross origin safe\n *    - harder to accidentally edit but also harder to customize\n *    - invisible to user\n *    - persistent across browser sessions\n *    - significant size, more than block size!\n *\n * - session storage\n *    - same as local storage but erased between browser sessions*\n *\n */\n\n\n// url parameters after #:\n\n// value could have base58 or similar so it's encoded\n// keys are kept simple\n// encodeURIComponent() escapes all characters except: A-Z a-z 0-9 - _ . ! ~ * ' ( )\n// e.g. const randomDataFed1 = 'who1=' + encodeURIComponent('878b8=ABCD-=+_`' + Math.random().toFixed(2))\n\n// window.origin is url up to but not including '/' before the '#'\n// search params are found after '?' but before the '#'\n// window.location.pathname is path after window.origin but before #\n// then the rest is window.hash that includes # and everything after\n// '?' after # are not search params so can be separate\n\n\n// other way to update url:\n// window.history.replaceState({}, '', `${location.pathname}?${params}`);","import React from 'react'\nimport { Store } from '../../store/'\nimport { useHistory } from 'react-router-dom'\nimport styles from './Navbar.module.css'\nimport { Wallet } from './../wallet/Wallet'\n\nconst MAX_BUTTONS_TO_SHOW_UNCOLLAPSED = 4\n\nexport const Navbar = (): JSX.Element => {\n  // global state\n  const { state } = React.useContext(Store)\n  // url changer\n  const history = useHistory()\n\n  // references for objects of interest\n  const searchButton = React.useRef<HTMLDivElement>(null)\n  const toggleMenuButtonDiv = React.useRef<HTMLDivElement>(null)\n  const overflowMenuDiv = React.useRef<HTMLDivElement>(null)\n\n  // local state for navbar\n  const [ nav, setNav ] = React.useState({\n    buttonWidth: (!!searchButton.current)\n      ? searchButton.current.offsetWidth\n      : undefined,\n    showCollapsed: false,\n    resizeTimer: 0\n  })\n\n  // initialize nav bar measurements\n  if (!nav.buttonWidth) {\n    window.setTimeout(() => {\n      window.dispatchEvent(new Event('resize'));\n    }, 200);\n  }\n\n  // selection rules for buttons\n  const isCreatePage = useHistory().location.pathname === '/create'\n  const isHomePage = useHistory().location.pathname === '/'\n  const isAboutPage = useHistory().location.pathname === '/about'\n  const isSettingsPage = useHistory().location.pathname === '/settings'\n  const isWalletPage = useHistory().location.pathname === '/wallet'\n\n\n  React.useEffect(() => {\n    // place overflow menu and show it\n    const updateMenuPosition = () => {\n      if (toggleMenuButtonDiv.current && overflowMenuDiv.current) {\n        const menu = overflowMenuDiv.current.getBoundingClientRect()\n        const button = toggleMenuButtonDiv.current.getBoundingClientRect()\n\n        const menuLeft = Math.round(button.left + (0.5 * button.width) - (0.5 * menu.width))\n        const menuTop = Math.round(button.top - menu.height - button.height * 0.4)\n        overflowMenuDiv.current!.style.top = menuTop + 'px'\n        overflowMenuDiv.current!.style.left = menuLeft + 'px'\n        overflowMenuDiv.current!.style.opacity = 'var(--finalOpacity)'\n      }\n    }\n    window.setTimeout(updateMenuPosition, 200);\n\n    // resize event\n    const onResize = () => {\n      if (searchButton.current) {\n        document.body.classList.add(\"resize-animation-stopper\");\n        clearTimeout(nav.resizeTimer);\n        let resizeTimer = setTimeout(\n          () => {\n            document.body.classList.remove(\"resize-animation-stopper\")\n        }, 400)\n        setNav({\n          ...nav,\n          resizeTimer: (resizeTimer as any),\n          showCollapsed: false,\n          buttonWidth: searchButton.current.getBoundingClientRect().width\n        })\n      }\n    }\n    // handle resize event listeners\n    window.addEventListener('resize', onResize);\n    return () => window.removeEventListener('resize', onResize);\n  }, [nav])\n\n  // click closes menu, outside or inside menu\n  React.useEffect(() => {\n    const onClickAnywhere = (e: any) => {\n      if (nav.showCollapsed) {\n        setNav({ ...nav, showCollapsed: false })\n      }\n    }\n    document.addEventListener('click', onClickAnywhere)\n    return () => { document.removeEventListener('click', onClickAnywhere) }\n  }, [nav])\n\n\n  // all main buttons\n  const buttonsArray = [\n    [\n\n      <div\n        ref={ searchButton }\n        className={ [styles.button, isHomePage ? styles.selected : ''].join(' ') }\n        onClick={ () => {\n          history.push('/')\n        } }\n      >\n        search\n      </div>\n\n    ],[\n      <div\n        className={ [styles.button, isCreatePage ? styles.selected : ''].join(' ') }\n        onClick={ () => {\n          history.push('/create')\n        } }\n      >\n        owners\n      </div>\n    ],[\n      <div\n        className={ [styles.button].join(' ') }\n        onClick={ () => {\n          window.open('https://github.com/ildarmgt/BitcoinNameSystem', '_blank')\n        } }\n      >\n        &lt;{ 'source' }&gt;\n      </div>\n    ],[\n      <div\n        className={ [styles.button, isAboutPage ? styles.selected : ''].join(' ') }\n        onClick={ () => {\n          history.push('/about')\n        } }\n      >\n        about\n      </div>\n    ],[\n      <div\n        className={ [styles.button, isSettingsPage ? styles.selected : ''].join(' ') }\n        onClick={ () => {\n          history.push('/settings')\n        } }\n      >\n        settings\n      </div>\n    ],[\n      <div\n        className={ [styles.button, isWalletPage ? styles.selected : ''].join(' ') }\n        onClick={ () => {\n          history.push('/wallet')\n        } }\n      >\n        wallet\n      </div>\n    ],\n  ]\n\n  // using search button as metric, estimate how many buttons to show\n  const windowWidth = window.innerWidth\n  const stdSizer = 0.005 * (window.innerWidth + window.innerHeight)\n  const safeWidthFraction = 0.8;\n  const howManyButtonsFitSafely = nav.buttonWidth ? Math.min(\n    Math.max(\n      Math.floor(\n        (windowWidth - 18 * stdSizer) * safeWidthFraction / ( nav.buttonWidth + stdSizer)\n      ),\n      1\n    )\n    , MAX_BUTTONS_TO_SHOW_UNCOLLAPSED\n  ) : 1\n\n  const buttonsOnNavbar = buttonsArray.filter((btn: any, i: number) =>\n    (i <= howManyButtonsFitSafely - 1)\n  )\n  const buttonsOverflow = buttonsArray.filter((btn: any, i: number) =>\n    (i > howManyButtonsFitSafely - 1)\n  ) || []\n\n  const TESTING = (process.env.NODE_ENV === 'development')\n\n  return (\n    <>\n      <div\n        className={ styles.warning }\n      >\n        { state.network }<br />\n        {(TESTING) && (<>development mode <br /></>)}\n        not reviewed for use\n      </div>\n\n      <div className={ styles.wallet }>\n        <Wallet />\n      </div>\n\n      <div\n        className={ styles.nav }\n      >\n        {/* page numbers (on tx creating pages) */}\n        { isCreatePage && (\n          <div className={ styles.pageNum }>\n            { state.pageInfo.current }/6\n          </div>\n        ) }\n\n        {/* collapsed menu toggle button */}\n        { (!!buttonsOverflow.length) && (\n          <div\n            className={ [\n              styles.collapsitron,\n              // styles.button,\n              nav.showCollapsed ? styles.menuShown : ''\n            ].join(' ') }\n            ref= { toggleMenuButtonDiv }\n            onClick={ () => {\n              setNav({ ...nav, showCollapsed: !nav.showCollapsed })\n            } }\n          >\n            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n            <div className={ styles.dots }><div /></div>\n\n          </div>\n        ) }\n\n        {/* regular nav bar */}\n        { buttonsOnNavbar.map((thisButton: any, index: number) => {\n          return (\n            <React.Fragment\n              key={ 'nevbarbuttons' + index }\n            >\n              { thisButton[0] }\n            </React.Fragment>\n          )\n        }).reverse()}\n\n      </div>\n\n      {/* collapsed menu window */}\n      { (nav.showCollapsed) && (\n        <div\n          className={ styles.overflowMenu }\n          ref={ overflowMenuDiv }\n        >\n          <div>\n            { buttonsOverflow.map((thisButton: any, index: number) => {\n                return (\n                  <React.Fragment\n                    key={ 'overflowbuttons' + index }\n                  >\n                    { thisButton[0] }\n                  </React.Fragment>\n                )\n              }).reverse()\n            }\n          </div>\n        </div>\n      ) }\n\n    </>\n  )\n}\n\n// Hash history cannot PUSH the same path; a new entry will not be added to the history stack\n// Only issue is the warning in console, but that only exists in development mode so can be ignored.","import React from 'react';\nimport { Route, Switch } from 'react-router-dom'\nimport { Home, About, Create, Wallet, Settings } from './pages/'\nimport { Navbar } from './components/Navbar'\nimport './css/app.css'\n\n// using for routing\nconst App = (): JSX.Element => {\n\n  // forwarding from url?name:\n\n  // onbtc.me?satoshi can now forward to onbtc.me/#/id/satoshi which resets to onbtc.me after search\n\n  // redirect to auto searching path routed in return and remove query from url\n  const searchParam = (new URLSearchParams(window.location.search)).keys().next().value\n  searchParam && console.log('search param detected after ?', searchParam)\n  // no forward slash before # in string is vital\n  searchParam && window.history.pushState({}, '', window.location.pathname + '#/id/' + searchParam)\n\n  return (\n    <>\n      {/* switch only renders first match instead of all matches */}\n      <div className={ 'content' }>\n        <Switch>\n          <Route path='/id/:alias' component={Home} />\n          <Route exact path='/id/' component={Home} />\n          <Route path=\"/about\" component={About} />\n          <Route path=\"/create\" component={Create} />\n          <Route path=\"/wallet\" component={Wallet} />\n          <Route path=\"/settings\" component={Settings} />\n          <Route path='/:noise' component={Home} />\n          <Route exact path='/' component={Home} />\n        </Switch>\n      </div>\n      <Navbar />\n      {/* <Route exact path=\"/\" render={() => <Home />} /> */}\n    </>\n  );\n}\nexport default App;\n","import React, { useState, useEffect } from 'react'\nimport styles from './DevPanel.module.css'\nimport { Store } from '../../store/'\nimport { ActionTypes } from './../../interfaces/'\nconst json = require('./../../utils/test.json');\n\ninterface I_State {\n  blShow: boolean\n  setShow: React.Dispatch<React.SetStateAction<boolean>>\n}\n\nexport const DevPanel = (props: any): JSX.Element => {\n  // global state\n  const { state, dispatch } = React.useContext(Store)\n\n  // now can show dev panel whenever in npm run start instead of deployed build\n  const TESTING = (process.env.NODE_ENV === 'development')\n\n  // store if DevPanel is hidden\n  const [hidden, setHidden] = useState<boolean>(TESTING)\n\n  // reruns to reattach keyup event to toggle hidden class\n  useEffect(() => {\n    const onDevKey = (e: any) => {\n      if (e.key === '`') {\n        setHidden(!hidden)\n      } else {\n        // give focus back to the input bar\n        if (document.activeElement?.id !== 'txtSearch') {\n          const txtSearch = document.getElementById('txtSearch') as HTMLTextAreaElement\n          txtSearch?.focus()\n        }\n      }\n    }\n    document.addEventListener('keyup', onDevKey)\n    return () => {\n      document.removeEventListener('keyup', onDevKey)\n    }\n  }, [hidden])\n\n  const onOutlineClick = () => {\n    const id: string = 'outliner'\n    const sheet: HTMLElement | null = document.getElementById(id)\n    if (!sheet) {\n      const outlineCss = '* {box-shadow: 0 0 0 1px red;}'\n      const style = document.createElement('style')\n      style.type = 'text/css'\n      style.id = id\n      style.appendChild(document.createTextNode(outlineCss))\n      document.head.appendChild(style)\n    } else {\n      sheet.parentNode?.removeChild(sheet)\n    }\n  }\n\n  const dlState = () => {\n    let data = \"text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(state))\n    let a = document.createElement('a')\n    a.href = 'data:' + data\n    a.download = 'test.json'\n    a.innerHTML = 'download JSON'\n    let container = document.getElementById('container')\n    container?.appendChild(a)\n    a.click()\n    a.remove()\n  }\n\n  return (\n    <div\n      className={[\n        styles.divDev,\n        !hidden ? styles.hidden : ''\n      ].join(' ')}\n      { ...props }\n    >\n      <div><b>DevPanel</b></div>\n\n      <div\n        className={ styles.button }\n        onClick={ () => {\n          dlState()\n        } }\n      >\n        Save File State\n      </div>\n\n      <div\n        className={ styles.button }\n        onClick={ () => {\n          console.log(json)\n          dispatch({ type: ActionTypes.LOAD_STATE, payload: json })\n        } }\n      >\n        Load File State\n      </div>\n\n      <div\n        className={ [styles.btnOutline, styles.button].join(' ') }\n        onClick={ onOutlineClick }\n      >\n        Outline\n      </div>\n\n      <div\n        className={ [styles.button].join(' ') }\n        onClick={ () => { localStorage.setItem('state', JSON.stringify(state)) } }\n      >\n        Save localStorage\n      </div>\n\n      <div\n        className={ [styles.button].join(' ') }\n        onClick={ () => {\n          const state = localStorage.getItem('state')\n          if (state) { dispatch({ type: ActionTypes.LOAD_STATE, payload: JSON.parse(state) }) }\n        } }\n      >\n        Load localStorage\n      </div>\n\n      <div\n        className={ styles.button }\n        onClick={ () => {\n          console.log(state);\n        } }\n      >\n        Console State\n      </div>\n    </div>\n  )\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { HashRouter } from 'react-router-dom';\nimport './css/global.css';\nimport App from './App';\nimport { StoreProvider } from './store/'\nimport { DevPanel } from './components/DevPanel'\n\n// Using for store access and hash router base\nReactDOM.render(\n  <StoreProvider>\n    <HashRouter>\n      <App />\n    </HashRouter>\n    <DevPanel />\n  </StoreProvider>,\n  document.getElementById('root')\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.register();\n// import * as serviceWorker from './serviceWorker';","// extracted by mini-css-extract-plugin\nmodule.exports = {\"roundButtonWrap\":\"RoundButton_roundButtonWrap__2X50a\",\"roundButton\":\"RoundButton_roundButton__tfjmf\",\"overhead\":\"RoundButton_overhead__As9JW\",\"nextArrowPad\":\"RoundButton_nextArrowPad__20zeF\",\"nextArrow\":\"RoundButton_nextArrow__SS6Nl\",\"backArrowPad\":\"RoundButton_backArrowPad__3Epn7\",\"backArrow\":\"RoundButton_backArrow__2MJJm\",\"back\":\"RoundButton_back__3z3jD\"};","import crypto from 'crypto'\n\n/**\n * Encrypt - symmetric - aes-256-crt\n * @param   {string}  stringText      To be encrypted (up to 80 bytes)\n * @param   {string}  stringForKey    Derive Key from (not final Key).\n * @param   {string}  stringForIV     Derive IV from (not final IV). Defaults as stringForKey.\n * @returns {Buffer}                  Buffer to embed in tx.\n */\nexport const encrypt = (\n  stringText: string, stringForKey: string, stringForIV: string = stringForKey\n) => {\n  // aes-NUMBER-TYPE\n  // Must have key size matching NUMBER (in aes name) of bits (NUMBER/8 bytes)\n  // Must have IV matching encryption block size, 16 bytes for AES128-to-256-range in cbc mode\n  // sha256 can make 32 byte buffer out of anything and then .slice(0, N) can cut it to N bytes\n\n  const key = crypto.createHash('sha256').update(stringForKey).digest()             // 32 bytes\n  const iv = crypto.createHash('sha256').update(stringForIV).digest().slice(0, 16)  // 16 bytes\n\n  let cipher = crypto.createCipheriv('aes-256-ctr', key, iv)\n  let encrypted = cipher.update(Buffer.from(stringText))\n\n  encrypted = Buffer.concat([encrypted, cipher.final()])\n\n  return encrypted\n}\n\n /**\n * Decrypt - symmetric - aes-256-crt\n * @param   {Buffer}  stringText      Buffer to be decrypted.\n * @param   {string}  stringForKey    Derive Key from (not final Key).\n * @param   {string}  stringForIV     Derive IV from (not final IV). Defaults as stringForKey.\n * @returns {Buffer}                  Buffer to utf8 embeded in tx.\n */\nexport const decrypt = (\n  bufferCypher: Buffer, stringForKey: string, stringForIV: string = stringForKey\n) => {\n\n  const key = crypto.createHash('sha256').update(stringForKey).digest()             // 32 bytes\n  const iv = crypto.createHash('sha256').update(stringForIV).digest().slice(0, 16)  // 16 bytes\n\n  let decipher = crypto.createDecipheriv('aes-256-ctr', key, iv)\n\n  // first part\n  let decrypted = decipher.update(bufferCypher)\n\n  // the rest\n  decrypted = Buffer.concat([decrypted, decipher.final()])\n\n  return decrypted.toString('utf8')\n}\n\n","import { I_User, I_BnsState, BnsBidType } from './types/'\n\n/**\n * Initial values for BNS state\n */\nexport const newState: I_BnsState = {\n  domain: {\n    domainName:                   '',\n    notificationAddress:          '',\n    txHistory:                    [],\n    derivedUtxoList:              [],\n    utxoList:                     [],\n    users:                        {},\n    currentOwner:                 '',\n    bidding: {\n      startHeight:                0,\n      endHeight:                  0,\n      type:                       BnsBidType.NULL,\n      bids:                       []\n    },\n    ownersHistory:                []\n  },\n  chain: {\n    parsedHeight:                 0,\n    currentHeight:                0\n  }\n}\n\n/**\n * values to initialize users with\n */\nexport const newUser: I_User = {\n  address:        '',\n  forwards:       [],\n  burnAmount:     0,\n  winHeight:      0,\n  winTimestamp:   0,\n  nonce:          0,\n  updateHeight:   0\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"cutOverflow\":\"CreateHeader_cutOverflow__3s_72\",\"bar\":\"CreateHeader_bar__27ge1\",\"domain\":\"CreateHeader_domain__1TQ7L\",\"alias\":\"CreateHeader_alias__1dNdj\",\"ext\":\"CreateHeader_ext__17sc6\",\"spacer\":\"CreateHeader_spacer__3tstm\",\"wrapper\":\"CreateHeader_wrapper__3cPTN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"InputForm_wrapper__3RO9S\",\"shiftRight\":\"InputForm_shiftRight__16j42\",\"label\":\"InputForm_label__2VQbz\",\"textarea\":\"InputForm_textarea__3jY9y\",\"button\":\"InputForm_button__1gilQ\",\"bonusInformation\":\"InputForm_bonusInformation__J6QjS\",\"invisible\":\"InputForm_invisible__1fPsX\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"fees\":\"FeesSelection_fees__aYPBm\",\"fees__rate\":\"FeesSelection_fees__rate__ho27f\",\"fees__apicall\":\"FeesSelection_fees__apicall__14yZr\",\"fees__feeSelection\":\"FeesSelection_fees__feeSelection__26meY\",\"fees__feeSelection__choice\":\"FeesSelection_fees__feeSelection__choice__1Ba9j\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"Details_wrapper__32nmX\",\"buttonWrapper\":\"Details_buttonWrapper__12FS5\",\"toggleDetails\":\"Details_toggleDetails__2jgtb\",\"arrow\":\"Details_arrow__2N1IF\",\"down\":\"Details_down__2irBp\",\"details\":\"Details_details__1lwEd\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"Switch_wrapper__13KFe\",\"shiftRight\":\"Switch_shiftRight__1BAPW\",\"label\":\"Switch_label__ZC9Fh\",\"choiceArea\":\"Switch_choiceArea__2lIss\",\"choice\":\"Switch_choice__HlPt4\",\"selected\":\"Switch_selected__ynsKV\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"Withdraw_wrapper__3h_E8\",\"title\":\"Withdraw_title__1DTCX\",\"request\":\"Withdraw_request__2EjrZ\",\"request__total\":\"Withdraw_request__total__6UrOm\",\"balance\":\"Withdraw_balance__2xjDM\",\"fees\":\"Withdraw_fees__1uZhm\"};","import * as bitcoin from 'bitcoinjs-lib'\nconst op = bitcoin.opcodes;\nconst hash160 = bitcoin.crypto.hash160;\n\n\n/**\n * Get p2wsh notificaiton address from domainName and network.\n * @param   {string} domainName         - full domainName to use (e.g. 'satoshi.btc').\n * @param   {string} networkChoice      - 'testnet' or 'bitcoin' (matches bitcoinjs-lib).\n * @returns {object}                    - { notificationsAddress - p2wsh address derived from domainName }.\n */\nexport const calcP2WSH = (domainName: string, networkChoice: string) => {\n  const network = bitcoin.networks[networkChoice];\n\n  // convert domainName into buffer so it can be put into script\n  const bufferData = Buffer.from(domainName, 'utf8');\n\n  // easily spendable script for ACS notification output\n  // specific to this domainName\n  const witnessScript = bitcoin.script.compile([\n    hash160(bufferData),\n    op.OP_DROP\n  ]);\n\n  // calculate p2wsh address for this witnessScript & network\n  const p2wsh = bitcoin.payments.p2wsh({\n    redeem: {\n      output: witnessScript,\n      network\n    },\n    network\n  })\n  const notificationsAddress = p2wsh.address;\n\n  return {\n    notificationsAddress\n  };\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"AboutContent_wrapper__1kfnm\",\"title\":\"AboutContent_title__16tUj\",\"contentWrapper\":\"AboutContent_contentWrapper__2XHS2\",\"drawing\":\"AboutContent_drawing__1qDTH\"};"],"sourceRoot":""}